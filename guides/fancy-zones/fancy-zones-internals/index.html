<!DOCTYPE html><html class=no-js lang=en> <head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content="An architectural overview of the Microsoft PowerToys module, " fancy name=description zones&quot;.&quot;><meta content="Sumanth " name=author peddamatham&quot; sam&quot;><link href=https://samrambles.com/guides/fancy-zones/fancy-zones-internals/index.html rel=canonical><link href=../fancy-zones-development-environment-setup/index.html rel=prev><link href=../../home-diy/how-to-size-a-solar-battery-install/index.html rel=next><link href=../../../assets/images/favicon.png rel=icon><meta content="mkdocs-1.4.2, mkdocs-material-9.0.15" name=generator><title>Fancy Zones Internals - Sam Rambles</title><link href=../../../assets/stylesheets/main.113286f1.min.css rel=stylesheet><link href=../../../assets/stylesheets/palette.a0c5b2b5.min.css rel=stylesheet><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css?family=Noto+Sans:300,300i,400,400i,700,700i%7CIMB+Plex+Mono:400,400i,700,700i&display=fallback" rel=stylesheet><style>:root{--md-text-font:"Noto Sans";--md-code-font:"IMB Plex Mono"}</style><link href=../../../assets/stylesheets/extra.css rel=stylesheet><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-RZQGZXT3GC"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RZQGZXT3GC');
</script><link href=../../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src=../../../assets/javascripts/glightbox.min.js></script></head> <body data-md-color-accent=black data-md-color-primary=black data-md-color-scheme=slate dir=ltr> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox> <input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a class=md-skip href=#basic-concepts> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <button aria-label="Don't show this again" class="md-banner__button md-icon"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg> </button> <em><b>Migration in progress:</b> apologies for broken articles and links.</em> </div> <script>var content,el=document.querySelector("[data-md-component=announce]");el&&(content=el.querySelector(".md-typeset"),__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0))</script> </aside> </div> <header class=md-header data-md-component=header> <nav aria-label=Header class="md-header__inner md-grid"> <a aria-label="Sam Rambles" class="md-header__button md-logo" data-md-component=logo href=../../../index.html title="Sam Rambles"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Sam Rambles </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Fancy Zones Internals </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input aria-label="Switch to light mode" class=md-option data-md-color-accent=black data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary=black data-md-color-scheme=slate id=__palette_1 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_2 hidden title="Switch to light mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"></path></svg> </label> <input aria-label="Switch to dark mode" class=md-option data-md-color-accent=white data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary=white data-md-color-scheme=white id=__palette_2 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_1 hidden title="Switch to dark mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"></path></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input aria-label=Search autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=Search required spellcheck=false type=text> <label class="md-search__icon md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </label> <nav aria-label=Search class=md-search__options> <a aria-label=Share class="md-search__icon md-icon" data-clipboard data-clipboard-text data-md-component=search-share href=javascript:void(0) tabindex=-1 title=Share> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"></path></svg> </a> <button aria-label=Clear class="md-search__icon md-icon" tabindex=-1 title=Clear type=reset> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a class=md-source data-md-component=source href=https://github.com/peddamat/mkdocs-obsidian title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg> </div> <div class=md-source__repository> peddamat/mkdocs-obsidian </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav aria-label=Tabs class=md-tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a class=md-tabs__link href=../../../index.html> Home </a> </li> <li class=md-tabs__item> <a class=md-tabs__link href=../../../tags/index.html> Tags </a> </li> <li class=md-tabs__item> <a class="md-tabs__link md-tabs__link--active" href=../../index.html> Guides </a> </li> <li class=md-tabs__item> <a class=md-tabs__link href=../../../notes/index.html> Notes </a> </li> <li class=md-tabs__item> <a class=md-tabs__link href=../../../projects/index.html> Projects </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label=Navigation class="md-nav md-nav--primary md-nav--lifted" data-md-level=0> <label class=md-nav__title for=__drawer> <a aria-label="Sam Rambles" class="md-nav__button md-logo" data-md-component=logo href=../../../index.html title="Sam Rambles"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg> </a> Sam Rambles </label> <div class=md-nav__source> <a class=md-source data-md-component=source href=https://github.com/peddamat/mkdocs-obsidian title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg> </div> <div class=md-source__repository> peddamat/mkdocs-obsidian </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../index.html> Home </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../tags/index.html> Tags </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" id=__nav_3 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../index.html>Guides</a> <label for=__nav_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded=true aria-labelledby=__nav_3_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../learning-networking-with-mininet/index.html> Learning Networking With Mininet </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_3 type=checkbox> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> Dotfiles <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_3_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Dotfiles </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../dotfiles/how-i-setup-this-blog/index.html> How I Setup This Blog </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../dotfiles/how-i-write-mkdocs-plugins/index.html> How I Write MkDocs Plugins </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../dotfiles/how-to-quickly-setup-a-wireless-mitm-proxy/index.html> How To Quickly Setup A Wireless MitM Proxy </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" id=__nav_3_4 type=checkbox> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> Fancy Zones <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=true aria-labelledby=__nav_3_4_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Fancy Zones </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../fancy-zones-development-environment-setup/index.html> Fancy Zones Development Environment Setup </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" id=__toc type=checkbox> <label class="md-nav__link md-nav__link--active" for=__toc> Fancy Zones Internals <span class="md-nav__icon md-icon"></span> </label> <a class="md-nav__link md-nav__link--active" href=index.html> Fancy Zones Internals </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#basic-concepts> Basic Concepts </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#window-properties> Window Properties </a> <nav aria-label="Window Properties" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#fancyzoneswindowproperties> FancyZonesWindowProperties </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#windows-events> Windows Events </a> <nav aria-label="Windows Events" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#winevents> WinEvents </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#windows-hooks> Windows Hooks </a> <nav aria-label="Windows Hooks" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#fancyzonesappcpp> FancyZonesApp.cpp </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#fancyzonescpp> FancyZones.cpp </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#windows-messages> Windows Messages </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#clicking-maximize-button-on-notepad-toolbar> Clicking Maximize button on Notepad Toolbar </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#clicking-full-screen-button-in-youtube-on-chrome> Clicking "Full Screen" Button in Youtube on Chrome </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#maximize-in-zone-implementation> "Maximize in Zone" Implementation </a> <nav aria-label class=md-nav implementation&quot; in maximize zone&quot;> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#example-1-basic-implementation> Example 1: Basic Implementation </a> <nav aria-label="Example 1: Basic Implementation" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#step-1-update-fancyzonesappcpp> Step 1: Update FancyZonesApp.cpp </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#step-2-update-fancyzonescpp> Step 2: Update FancyZones.cpp </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#example-2-parent-windows> Example 2: Parent Windows </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#example-3-dll-injection> Example 3: DLL-Injection </a> <nav aria-label="Example 3: DLL-Injection" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#setwindowshookex> SetWindowsHookEx </a> <nav aria-label=SetWindowsHookEx class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#considerations> Considerations </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#debugging-tips> Debugging Tips </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#createremotethread> CreateRemoteThread </a> <nav aria-label=CreateRemoteThread class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#dll-injection-references> DLL Injection References </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#references> References </a> <nav aria-label=References class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#things-i-considered> Things I Considered </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_5 type=checkbox> <label class=md-nav__link for=__nav_3_5 id=__nav_3_5_label tabindex=0> Home DIY <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_5_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Home DIY </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../home-diy/how-to-size-a-solar-battery-install/index.html> How To Size A Solar Battery Install </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_6 type=checkbox> <label class=md-nav__link for=__nav_3_6 id=__nav_3_6_label tabindex=0> Window Hacking With Rust <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_6_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Window Hacking With Rust </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../window-hacking-with-rust/creating-a-dll-with-rust/index.html> Creating A DLL With Rust </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../window-hacking-with-rust/creating-a-window-with-rust/index.html> Creating A Window With Rust </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../window-hacking-with-rust/injecting-dlls-with-rust/index.html> Injecting DLLs With Rust </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../window-hacking-with-rust/production-ready-dll-injection/index.html> Production Ready DLL Injection </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_4 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../notes/index.html>Notes</a> <label for=__nav_4> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded=false aria-labelledby=__nav_4_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Notes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/debugging-tools/index.html> Debugging Tools </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/reverse-engineering-tools/index.html> Reverse Engineering Tools </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_4_4 type=checkbox> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> Cheatsheets <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_4_4_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> Cheatsheets </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/cheatsheets/docker-cheatsheet/index.html> Docker Cheatsheet </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/cheatsheets/git-cheatsheet/index.html> Git Cheatsheet </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/cheatsheets/rsync-cheatsheet/index.html> Rsync Cheatsheet </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/cheatsheets/ruby-cheatsheet/index.html> Ruby Cheatsheet </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/cheatsheets/tls-cheatsheet/index.html> TLS Cheatsheet </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_4_5 type=checkbox> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex=0> Debug Probes <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_4_5_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> Debug Probes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/debug-probes/black-magic-probe/index.html> Black Magic Probe </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/debug-probes/segger-j-link/index.html> Segger J-Link </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_4_6 type=checkbox> <label class=md-nav__link for=__nav_4_6 id=__nav_4_6_label tabindex=0> Development Kits <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_4_6_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_4_6> <span class="md-nav__icon md-icon"></span> Development Kits </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/development-kits/adafruit-feather-m0-wifi/index.html> Adafruit Feather M0 WiFi </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/development-kits/esp32/index.html> ESP32 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/development-kits/raspberry-pi/index.html> Raspberry Pi </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_4_6_4 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../notes/development-kits/esp8266/index.html>ESP8266</a> <label for=__nav_4_6_4> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded=false aria-labelledby=__nav_4_6_4_label class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_4_6_4> <span class="md-nav__icon md-icon"></span> ESP8266 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/development-kits/esp8266/esp-01/index.html> ESP-01 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/development-kits/esp8266/wemos-mini/index.html> Wemos Mini </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_4_6_5 type=checkbox> <label class=md-nav__link for=__nav_4_6_5 id=__nav_4_6_5_label tabindex=0> STM32 <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_4_6_5_label class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_4_6_5> <span class="md-nav__icon md-icon"></span> STM32 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/development-kits/stm32/black-pill/index.html> Black Pill </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/development-kits/stm32/itead-maple/index.html> ITead Maple </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/development-kits/stm32/super-blue-pill/index.html> Super Blue Pill </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_5 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../projects/index.html>Projects</a> <label for=__nav_5> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded=false aria-labelledby=__nav_5_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Projects </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_5_2 type=checkbox> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> Apps <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_5_2_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> Apps </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/apps/introducing-recon/index.html> Introducing Recon </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/apps/introducing-sensie/index.html> Introducing Sensie </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/apps/serialmoose-serial-port-sniffer/index.html> SerialMoose Serial Port Sniffer </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_5_2_4 type=checkbox> <label class=md-nav__link for=__nav_5_2_4 id=__nav_5_2_4_label tabindex=0> CalibreSync <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_5_2_4_label class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_5_2_4> <span class="md-nav__icon md-icon"></span> CalibreSync </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/apps/calibresync/calibresync-development-notes/index.html> CalibreSync Development Notes </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_5_3 type=checkbox> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex=0> Cancer Research <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_5_3_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> Cancer Research </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/cancer-research/generating-complete-genomics-build37-files/index.html> Generating Complete Genomics build37 Files </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/cancer-research/target-aml-data-analysis/index.html> TARGET AML Data Analysis </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_5_4 type=checkbox> <label class=md-nav__link for=__nav_5_4 id=__nav_5_4_label tabindex=0> Home Assistant <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_5_4_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_5_4> <span class="md-nav__icon md-icon"></span> Home Assistant </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/home-assistant/my-smart-home-devices/index.html> My Smart Home Devices </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/home-assistant/samsung-refrigerator-integration/index.html> Samsung Refrigerator Integration </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_5_5 type=checkbox> <label class=md-nav__link for=__nav_5_5 id=__nav_5_5_label tabindex=0> Hunter Hacking <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_5_5_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_5_5> <span class="md-nav__icon md-icon"></span> Hunter Hacking </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/hunter-hacking/a-look-inside-a-hunter-pro-hc-controller/index.html> A Look Inside A Hunter Pro-HC Controller </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/hunter-hacking/atwinc1500-iot-module-deep-dive-part-1/index.html> ATWINC1500 IoT Module Deep-Dive (Part 1) </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/hunter-hacking/atwinc1500-iot-module-deep-dive-part-2/index.html> ATWINC1500 IoT Module Deep-Dive (Part 2) </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/hunter-hacking/hands-on-iot-mitm-part-1/index.html> Hands On IoT MitM (Part 1) </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/hunter-hacking/hands-on-iot-mitm-part-2/index.html> Hands On IoT MitM (Part 2) </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/hunter-hacking/reverse-engineering-a-hunter-pro-hc-controller/index.html> Reverse Engineering A Hunter Pro HC Controller </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#basic-concepts> Basic Concepts </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#window-properties> Window Properties </a> <nav aria-label="Window Properties" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#fancyzoneswindowproperties> FancyZonesWindowProperties </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#windows-events> Windows Events </a> <nav aria-label="Windows Events" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#winevents> WinEvents </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#windows-hooks> Windows Hooks </a> <nav aria-label="Windows Hooks" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#fancyzonesappcpp> FancyZonesApp.cpp </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#fancyzonescpp> FancyZones.cpp </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#windows-messages> Windows Messages </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#clicking-maximize-button-on-notepad-toolbar> Clicking Maximize button on Notepad Toolbar </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#clicking-full-screen-button-in-youtube-on-chrome> Clicking "Full Screen" Button in Youtube on Chrome </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#maximize-in-zone-implementation> "Maximize in Zone" Implementation </a> <nav aria-label class=md-nav implementation&quot; in maximize zone&quot;> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#example-1-basic-implementation> Example 1: Basic Implementation </a> <nav aria-label="Example 1: Basic Implementation" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#step-1-update-fancyzonesappcpp> Step 1: Update FancyZonesApp.cpp </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#step-2-update-fancyzonescpp> Step 2: Update FancyZones.cpp </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#example-2-parent-windows> Example 2: Parent Windows </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#example-3-dll-injection> Example 3: DLL-Injection </a> <nav aria-label="Example 3: DLL-Injection" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#setwindowshookex> SetWindowsHookEx </a> <nav aria-label=SetWindowsHookEx class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#considerations> Considerations </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#debugging-tips> Debugging Tips </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#createremotethread> CreateRemoteThread </a> <nav aria-label=CreateRemoteThread class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#dll-injection-references> DLL Injection References </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#references> References </a> <nav aria-label=References class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#things-i-considered> Things I Considered </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <nav class=md-tags> <a class=md-tag href=../../../tags/index.html#powertoys>powertoys</a> <a class=md-tag href=../../../tags/index.html#windows>windows</a> </nav> <div><h2 id=basic-concepts>Basic Concepts<a class=headerlink href=#basic-concepts title="Permanent link">¶</a></h2> <p>At the most fundamental level, Fancy Zones works by: - <strong>Adding metadata to application windows</strong> indicating their size, origin, and "zone" - <strong>Listening for window events</strong> (drag, resize) and "hooking" them</p> <h2 id=window-properties>Window Properties<a class=headerlink href=#window-properties title="Permanent link">¶</a></h2> <p>Metadata can be added to windows by leveraging <a href=https://learn.microsoft.com/en-us/windows/win32/winmsg/window-properties>Window Properties</a>:</p> <blockquote> <p>A window property is any data assigned to a window. A window property is usually a handle of the window-specific data, but it may be any value. Each window property is identified by a string name.</p> </blockquote> <p><a href=https://windowdetective.sourceforge.io/ >Window Detective</a> can be used to view Window Properties. In the example below, the picked window has the following Fancy Zones properties: - <code>FancyZones_RestoreSize</code> - <code>FancyZones_RestoreOrigin</code> - <code>FancyZones_TabSortKeyWithinZone</code> - <code>FancyZones_zones</code></p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230214112243.png><img alt="Pasted image 20230214112243.png" src=../../../assets/images/pasted-image-20230214112243.png></a></p> <h3 id=fancyzoneswindowproperties>FancyZonesWindowProperties<a class=headerlink href=#fancyzoneswindowproperties title="Permanent link">¶</a></h3> <ul> <li><a href=https://github.com/microsoft/PowerToys/blob/150e7d40dd705d5e52bcdd7010491c5c7a529094/src/modules/fancyzones/FancyZonesLib/FancyZonesWindowProperties.h#L8><code>FancyZonesWindowProperties.h</code></a> contains defines for all window properties used by Fancy Zones.</li> <li>FancyZonesWindowProperties.cpp contains the <a href=https://github.com/microsoft/PowerToys/blob/17475ec705442a9986dcc7de5195bd780a32b39e/src/modules/fancyzones/FancyZonesLib/FancyZonesWindowProperties.cpp#L18><code>StampZoneIndexProperty()</code> </a>method, used to "stamp" window properties to window handles.</li> </ul> <h2 id=windows-events>Windows Events<a class=headerlink href=#windows-events title="Permanent link">¶</a></h2> <p>Windows is an event-based operating system, meaning, all windows generate and consume events. Events can broadly be divided into two types:<br> - WinEvents - Messages</p> <h3 id=winevents>WinEvents<a class=headerlink href=#winevents title="Permanent link">¶</a></h3> <p>Microsoft defines <a href=https://learn.microsoft.com/en-us/windows/win32/winauto/winevents-infrastructure>WinEvents</a> thusly:</p> <blockquote> <p>Server applications and the operating system use WinEvents to notify clients when a change occurs in the system or in the user interface.</p> <p>WinEvent support is a feature of the Windows operating system that provides:</p> <ul> <li>A simple way for clients to register for event notifications.</li> <li>A mechanism for injecting client code into servers.</li> <li>Routing of events from servers to interested clients.</li> <li>Automatic event generation for most <strong>HWND</strong>-based controls.</li> </ul> </blockquote> <p>An application can "listen" for events by <a href=https://learn.microsoft.com/en-us/windows/win32/winauto/registering-a-hook-function>registering a hook</a>.</p> <h3 id=windows-hooks>Windows Hooks<a class=headerlink href=#windows-hooks title="Permanent link">¶</a></h3> <p>Microsoft defines <a href=https://learn.microsoft.com/en-us/windows/win32/winmsg/about-hooks>hooks</a> thusly: </p> <blockquote> <p>A <em>hook</em> is a mechanism by which an application can intercept events, such as messages, mouse actions, and keystrokes. A function that intercepts a particular type of event is known as a <em>hook procedure</em>. A hook procedure can act on each event it receives, and then modify or discard the event.</p> </blockquote> <p>Hooks can be one of the following: - In-Context - Out-of-Context</p> <p>There are two types of hooks <code>thread</code> and <code>global</code>. Global hooks require DLL-injection.</p> <p>Hooks are set by registering a <code>WinEventProc</code> callback function using <a href=https://learn.microsoft.com/en-us/windows/desktop/api/Winuser/nf-winuser-setwineventhook><code>SetWinEventHook</code></a>.</p> <h4 id=fancyzonesappcpp>FancyZonesApp.cpp<a class=headerlink href=#fancyzonesappcpp title="Permanent link">¶</a></h4> <p>Fancy Zones calls <a href=https://learn.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-setwineventhook>SetWinEventHook</a> in <a href=https://github.com/microsoft/PowerToys/blob/44e28886d7b879334dfc0ba01dec13d55982923b/src/modules/fancyzones/FancyZones/FancyZonesApp.cpp#L87><code>FancyZonesApp::InitHooks()</code></a> to subscribe to the following <a href=https://learn.microsoft.com/en-us/windows/win32/winauto/system-level-and-object-level-events>system-level and object-level</a> events. </p> <div class="language-csharp highlight"><pre><span></span><code><span id=__span-0-1><a href=#__codelineno-0-1 id=__codelineno-0-1 name=__codelineno-0-1></a><span class=w>    </span><span class=n>std</span><span class=p>::</span><span class=n>array</span><span class=o>&lt;</span><span class=n>DWORD</span><span class=p>,</span><span class=w> </span><span class=m>7</span><span class=o>&gt;</span><span class=w> </span><span class=n>events_to_subscribe</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-2><a href=#__codelineno-0-2 id=__codelineno-0-2 name=__codelineno-0-2></a><span class=w>        </span><span class=n>EVENT_SYSTEM_MOVESIZESTART</span><span class=p>,</span>
</span><span id=__span-0-3><a href=#__codelineno-0-3 id=__codelineno-0-3 name=__codelineno-0-3></a><span class=w>        </span><span class=n>EVENT_SYSTEM_MOVESIZEEND</span><span class=p>,</span>
</span><span id=__span-0-4><a href=#__codelineno-0-4 id=__codelineno-0-4 name=__codelineno-0-4></a><span class=w>        </span><span class=n>EVENT_OBJECT_NAMECHANGE</span><span class=p>,</span>
</span><span id=__span-0-5><a href=#__codelineno-0-5 id=__codelineno-0-5 name=__codelineno-0-5></a><span class=w>        </span><span class=n>EVENT_OBJECT_UNCLOAKED</span><span class=p>,</span>
</span><span id=__span-0-6><a href=#__codelineno-0-6 id=__codelineno-0-6 name=__codelineno-0-6></a><span class=w>        </span><span class=n>EVENT_OBJECT_SHOW</span><span class=p>,</span>
</span><span id=__span-0-7><a href=#__codelineno-0-7 id=__codelineno-0-7 name=__codelineno-0-7></a><span class=w>        </span><span class=n>EVENT_OBJECT_CREATE</span><span class=p>,</span>
</span><span id=__span-0-8><a href=#__codelineno-0-8 id=__codelineno-0-8 name=__codelineno-0-8></a><span class=w>        </span><span class=n>EVENT_OBJECT_LOCATIONCHANGE</span>
</span><span id=__span-0-9><a href=#__codelineno-0-9 id=__codelineno-0-9 name=__codelineno-0-9></a><span class=p>};</span>
</span></code></pre></div> <p>These event constants are detailed in the Windows documentation here, <a href=https://learn.microsoft.com/en-us/windows/win32/winauto/event-constants>Event Constants</a>.</p> <p>The hooked events are received in <a href=https://github.com/microsoft/PowerToys/blob/44e28886d7b879334dfc0ba01dec13d55982923b/src/modules/fancyzones/FancyZones/FancyZonesApp.cpp#L117><code>FancyZonesApp</code></a> and ultimately translated into Windows Messages which are consumed by the Fancy Zones <a href=https://en.wikipedia.org/wiki/Message_loop_in_Microsoft_Windows><code>message loop</code></a> defined in[FancyZones.cpp]].</p> <h4 id=fancyzonescpp>FancyZones.cpp<a class=headerlink href=#fancyzonescpp title="Permanent link">¶</a></h4> <p>The <code>FancyZones</code> class is where most of the Fancy Zones business logic is defined. </p> <p><a href=https://github.com/microsoft/PowerToys/blob/44e28886d7b879334dfc0ba01dec13d55982923b/src/modules/fancyzones/FancyZonesLib/FancyZones.cpp#L77><code>FancyZones::HandleWinHookEvent()</code></a> translates received events into internal Windows Messages which are consumed in <a href=https://github.com/microsoft/PowerToys/blob/44e28886d7b879334dfc0ba01dec13d55982923b/src/modules/fancyzones/FancyZonesLib/FancyZones.cpp#L561><code>FancyZones::WndProc()</code></a>.</p> <h3 id=windows-messages>Windows Messages<a class=headerlink href=#windows-messages title="Permanent link">¶</a></h3> <p>Windows Messages are a type of event used by the operating system to provide external input to a window:</p> <blockquote> <p>Unlike MS-DOS-based applications, Windows-based applications are event-driven. They do not make explicit function calls (such as C run-time library calls) to obtain input. Instead, they wait for the system to pass input to them.</p> <p>The system passes all input for an application to the various windows in the application. Each window has a function, called a window procedure, that the system calls whenever it has input for the window. The window procedure processes the input and returns control to the system. For more information about window procedures, see <a href=https://learn.microsoft.com/en-us/windows/win32/winmsg/window-procedures>Window Procedures</a>.</p> </blockquote> <p>At the most basic level, all Windows GUI applications are simply a window and a message loop.</p> <p><code>Windows Detective</code> can be used to view Windows Events by right-clicking on a window handle and selecting "Messages".</p> <p>![[Pasted image 20230214133520.png]]</p> <h3 id=clicking-maximize-button-on-notepad-toolbar>Clicking Maximize button on Notepad Toolbar<a class=headerlink href=#clicking-maximize-button-on-notepad-toolbar title="Permanent link">¶</a></h3> <p>![[Pasted image 20230216094337.png]]</p> <h3 id=clicking-full-screen-button-in-youtube-on-chrome>Clicking "Full Screen" Button in Youtube on Chrome<a class=headerlink href=#clicking-full-screen-button-in-youtube-on-chrome title="Permanent link">¶</a></h3> <p>![[Pasted image 20230216095107.png]]</p> <h1 id=maximize-in-zone-implementation>"Maximize in Zone" Implementation<a class=headerlink href=#maximize-in-zone-implementation title="Permanent link">¶</a></h1> <h2 id=example-1-basic-implementation>Example 1: Basic Implementation<a class=headerlink href=#example-1-basic-implementation title="Permanent link">¶</a></h2> <p>Implementing a feature which resizes a "maximized" window so that it fits within the zone it is currently in.</p> <p>First, we need to determine what event is generated when the "maximize" button is pressed. </p> <p>Using Microsoft Spy++, we see the following: </p> <p>![<a href=#12f3b9>Pasted image 20230214154342.png</a></p> <p>Ok, great! It looks like the <code>WM_WINDOWPOSCHANGING</code> event gets fired, so we can hook that event. Searching the Fancy Zones code base for <code>WM_WINDOWPOSCHANGING</code> yields... nothing.</p> <p>Hitting up Google, yields this interesting hit:</p> <ul> <li><a href=https://stackoverflow.com/questions/17436795/setwineventhook-window-maximized-event>https://stackoverflow.com/questions/17436795/setwineventhook-window-maximized-event</a> <div class="language-csharp highlight"><pre><span></span><code><span id=__span-1-1><a href=#__codelineno-1-1 id=__codelineno-1-1 name=__codelineno-1-1></a><span class=k>void</span><span class=w> </span><span class=n>CALLBACK</span><span class=w> </span><span class=nf>exampleHook</span><span class=p>(</span><span class=n>HWINEVENTHOOK</span><span class=w> </span><span class=n>hook</span><span class=p>,</span><span class=w> </span><span class=n>DWORD</span><span class=w> </span><span class=k>event</span><span class=p>,</span><span class=w> </span><span class=n>HWND</span><span class=w> </span><span class=n>hWnd</span><span class=p>,</span>
</span><span id=__span-1-2><a href=#__codelineno-1-2 id=__codelineno-1-2 name=__codelineno-1-2></a><span class=w>    </span><span class=n>LONG</span><span class=w> </span><span class=n>idObject</span><span class=p>,</span><span class=w> </span><span class=n>LONG</span><span class=w> </span><span class=n>idChild</span><span class=p>,</span><span class=w> </span><span class=n>DWORD</span><span class=w> </span><span class=n>dwEventThread</span><span class=p>,</span><span class=w> </span><span class=n>DWORD</span><span class=w> </span><span class=n>dwmsEventTime</span><span class=p>)</span>
</span><span id=__span-1-3><a href=#__codelineno-1-3 id=__codelineno-1-3 name=__codelineno-1-3></a><span class=p>{</span>
</span><span id=__span-1-4><a href=#__codelineno-1-4 id=__codelineno-1-4 name=__codelineno-1-4></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>EVENT_OBJECT_LOCATIONCHANGE</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=k>event</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-5><a href=#__codelineno-1-5 id=__codelineno-1-5 name=__codelineno-1-5></a><span class=w>        </span><span class=n>WINDOWPLACEMENT</span><span class=w> </span><span class=n>wp</span><span class=p>;</span>
</span><span id=__span-1-6><a href=#__codelineno-1-6 id=__codelineno-1-6 name=__codelineno-1-6></a><span class=w>        </span><span class=n>wp</span><span class=p>.</span><span class=n>length</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>WINDOWPLACEMENT</span><span class=p>);</span>
</span><span id=__span-1-7><a href=#__codelineno-1-7 id=__codelineno-1-7 name=__codelineno-1-7></a><span class=w>        </span><span class=n>GetWindowPlacement</span><span class=p>(</span><span class=n>hWnd</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>wp</span><span class=p>);</span>
</span><span id=__span-1-8><a href=#__codelineno-1-8 id=__codelineno-1-8 name=__codelineno-1-8></a>
</span><span id=__span-1-9><a href=#__codelineno-1-9 id=__codelineno-1-9 name=__codelineno-1-9></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>SW_SHOWMAXIMIZED</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>wp</span><span class=p>.</span><span class=n>showCmd</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-1-10><a href=#__codelineno-1-10 id=__codelineno-1-10 name=__codelineno-1-10></a><span class=w>            </span><span class=c1>// Window is maximized.</span>
</span><span id=__span-1-11><a href=#__codelineno-1-11 id=__codelineno-1-11 name=__codelineno-1-11></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-1-12><a href=#__codelineno-1-12 id=__codelineno-1-12 name=__codelineno-1-12></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-1-13><a href=#__codelineno-1-13 id=__codelineno-1-13 name=__codelineno-1-13></a><span class=p>}</span>
</span></code></pre></div></li> </ul> <p>Ok, so this guy says to hook the <code>EVENT_OBJECT_LOCATIONCHANGE</code> event, let's search, which results in a few hits, all in <code>FancyZonesApp.cpp</code>: - <a href=https://github.com/microsoft/PowerToys/blob/44e28886d7b879334dfc0ba01dec13d55982923b/src/modules/fancyzones/FancyZones/FancyZonesApp.cpp#L127>One</a> - <a href=https://github.com/microsoft/PowerToys/blob/44e28886d7b879334dfc0ba01dec13d55982923b/src/modules/fancyzones/FancyZones/FancyZonesApp.cpp#L148>Another</a></p> <h3 id=step-1-update-fancyzonesappcpp>Step 1: Update FancyZonesApp.cpp<a class=headerlink href=#step-1-update-fancyzonesappcpp title="Permanent link">¶</a></h3> <p>First, update <code>FancyZonesApp.cpp</code> so that we're always listening to <code>EVENT_OBJECT_LOCATIONCHANGE</code> events.</p> <div class="language-csharp highlight"><pre><span></span><code><span id=__span-2-1><a href=#__codelineno-2-1 id=__codelineno-2-1 name=__codelineno-2-1></a><span class=w>    </span><span class=n>std</span><span class=p>::</span><span class=n>array</span><span class=o>&lt;</span><span class=n>DWORD</span><span class=p>,</span><span class=w> </span><span class=m>7</span><span class=o>&gt;</span><span class=w> </span><span class=n>events_to_subscribe</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-2><a href=#__codelineno-2-2 id=__codelineno-2-2 name=__codelineno-2-2></a><span class=w>        </span><span class=n>EVENT_SYSTEM_MOVESIZESTART</span><span class=p>,</span>
</span><span id=__span-2-3><a href=#__codelineno-2-3 id=__codelineno-2-3 name=__codelineno-2-3></a><span class=w>        </span><span class=n>EVENT_SYSTEM_MOVESIZEEND</span><span class=p>,</span>
</span><span id=__span-2-4><a href=#__codelineno-2-4 id=__codelineno-2-4 name=__codelineno-2-4></a><span class=w>        </span><span class=n>EVENT_OBJECT_NAMECHANGE</span><span class=p>,</span>
</span><span id=__span-2-5><a href=#__codelineno-2-5 id=__codelineno-2-5 name=__codelineno-2-5></a><span class=w>        </span><span class=n>EVENT_OBJECT_UNCLOAKED</span><span class=p>,</span>
</span><span id=__span-2-6><a href=#__codelineno-2-6 id=__codelineno-2-6 name=__codelineno-2-6></a><span class=w>        </span><span class=n>EVENT_OBJECT_SHOW</span><span class=p>,</span>
</span><span id=__span-2-7><a href=#__codelineno-2-7 id=__codelineno-2-7 name=__codelineno-2-7></a><span class=w>        </span><span class=n>EVENT_OBJECT_CREATE</span><span class=p>,</span>
</span><span id=__span-2-8><a href=#__codelineno-2-8 id=__codelineno-2-8 name=__codelineno-2-8></a><span class=w>        </span><span class=n>EVENT_OBJECT_LOCATIONCHANGE</span>
</span><span id=__span-2-9><a href=#__codelineno-2-9 id=__codelineno-2-9 name=__codelineno-2-9></a><span class=w>    </span><span class=p>};</span>
</span></code></pre></div> <h3 id=step-2-update-fancyzonescpp>Step 2: Update FancyZones.cpp<a class=headerlink href=#step-2-update-fancyzonescpp title="Permanent link">¶</a></h3> <div class="language-csharp highlight"><pre><span></span><code><span id=__span-3-1><a href=#__codelineno-3-1 id=__codelineno-3-1 name=__codelineno-3-1></a><span class=k>else</span><span class=w> </span><span class=nf>if</span><span class=w> </span><span class=p>(</span><span class=n>message</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>WM_PRIV_LOCATIONCHANGE</span><span class=p>)</span>
</span><span id=__span-3-2><a href=#__codelineno-3-2 id=__codelineno-3-2 name=__codelineno-3-2></a><span class=p>{</span>
</span><span id=__span-3-3><a href=#__codelineno-3-3 id=__codelineno-3-3 name=__codelineno-3-3></a><span class=w>    </span><span class=c1>// If the window is being resized via handle bars</span>
</span><span id=__span-3-4><a href=#__codelineno-3-4 id=__codelineno-3-4 name=__codelineno-3-4></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>m_draggingState</span><span class=p>.</span><span class=n>IsDragging</span><span class=p>())</span>
</span><span id=__span-3-5><a href=#__codelineno-3-5 id=__codelineno-3-5 name=__codelineno-3-5></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-3-6><a href=#__codelineno-3-6 id=__codelineno-3-6 name=__codelineno-3-6></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>auto</span><span class=w> </span><span class=n>monitor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MonitorFromPoint</span><span class=p>(</span><span class=n>ptScreen</span><span class=p>,</span><span class=w> </span><span class=n>MONITOR_DEFAULTTONULL</span><span class=p>))</span>
</span><span id=__span-3-7><a href=#__codelineno-3-7 id=__codelineno-3-7 name=__codelineno-3-7></a><span class=w>        </span><span class=p>{</span>
</span><span id=__span-3-8><a href=#__codelineno-3-8 id=__codelineno-3-8 name=__codelineno-3-8></a><span class=w>            </span><span class=n>MoveSizeUpdate</span><span class=p>(</span><span class=n>monitor</span><span class=p>,</span><span class=w> </span><span class=n>ptScreen</span><span class=p>);</span>
</span><span id=__span-3-9><a href=#__codelineno-3-9 id=__codelineno-3-9 name=__codelineno-3-9></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-3-10><a href=#__codelineno-3-10 id=__codelineno-3-10 name=__codelineno-3-10></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-3-11><a href=#__codelineno-3-11 id=__codelineno-3-11 name=__codelineno-3-11></a><span class=w>    </span><span class=k>else</span>
</span><span id=__span-3-12><a href=#__codelineno-3-12 id=__codelineno-3-12 name=__codelineno-3-12></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-3-13><a href=#__codelineno-3-13 id=__codelineno-3-13 name=__codelineno-3-13></a><span class=w>        </span><span class=n>auto</span><span class=w> </span><span class=n>hwnd</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>reinterpret_cast</span><span class=o>&lt;</span><span class=n>HWND</span><span class=o>&gt;</span><span class=p>(</span><span class=n>wparam</span><span class=p>);</span>
</span><span id=__span-3-14><a href=#__codelineno-3-14 id=__codelineno-3-14 name=__codelineno-3-14></a>
</span><span id=__span-3-15><a href=#__codelineno-3-15 id=__codelineno-3-15 name=__codelineno-3-15></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>FancyZonesWindowUtils</span><span class=p>::</span><span class=n>IsWindowMaximized</span><span class=p>(</span><span class=n>hwnd</span><span class=p>))</span>
</span><span id=__span-3-16><a href=#__codelineno-3-16 id=__codelineno-3-16 name=__codelineno-3-16></a><span class=w>        </span><span class=p>{</span>
</span><span id=__span-3-17><a href=#__codelineno-3-17 id=__codelineno-3-17 name=__codelineno-3-17></a><span class=w>            </span><span class=n>auto</span><span class=w> </span><span class=n>monitor</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>MonitorFromWindow</span><span class=p>(</span><span class=n>hwnd</span><span class=p>,</span><span class=w> </span><span class=n>MONITOR_DEFAULTTONULL</span><span class=p>);</span>
</span><span id=__span-3-18><a href=#__codelineno-3-18 id=__codelineno-3-18 name=__codelineno-3-18></a><span class=w>            </span><span class=n>MoveToAppLastZone</span><span class=p>(</span><span class=n>hwnd</span><span class=p>,</span><span class=w> </span><span class=n>monitor</span><span class=p>,</span><span class=w> </span><span class=n>NULL</span><span class=p>);</span>
</span><span id=__span-3-19><a href=#__codelineno-3-19 id=__codelineno-3-19 name=__codelineno-3-19></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-3-20><a href=#__codelineno-3-20 id=__codelineno-3-20 name=__codelineno-3-20></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-3-21><a href=#__codelineno-3-21 id=__codelineno-3-21 name=__codelineno-3-21></a><span class=p>}</span>
</span></code></pre></div> <h2 id=example-2-parent-windows>Example 2: Parent Windows<a class=headerlink href=#example-2-parent-windows title="Permanent link">¶</a></h2> <h2 id=example-3-dll-injection>Example 3: DLL-Injection<a class=headerlink href=#example-3-dll-injection title="Permanent link">¶</a></h2> <p>There are two ways to inject DLLs: - SetWindowsHookEx() - CreateRemoteThread()</p> <h3 id=setwindowshookex>SetWindowsHookEx<a class=headerlink href=#setwindowshookex title="Permanent link">¶</a></h3> <h4 id=considerations>Considerations<a class=headerlink href=#considerations title="Permanent link">¶</a></h4> <ul> <li>Global vs per-Thread</li> <li>Hook type: WH_GETMESSAGE, WH_CALLWNDPROC, ...</li> <li>32-bit / 64-bit processes</li> <li>Windows Store Apps</li> </ul> <h4 id=debugging-tips>Debugging Tips<a class=headerlink href=#debugging-tips title="Permanent link">¶</a></h4> <h3 id=createremotethread>CreateRemoteThread<a class=headerlink href=#createremotethread title="Permanent link">¶</a></h3> <h4 id=dll-injection-references>DLL Injection References<a class=headerlink href=#dll-injection-references title="Permanent link">¶</a></h4> <ul> <li><a href=https://www.apriorit.com/dev-blog/679-windows-dll-injection-for-api-hooks>https://www.apriorit.com/dev-blog/679-windows-dll-injection-for-api-hooks</a></li> <li><a href=https://isaratech.com/cpp-dll-injection-using-createremotethread-on-windows/ >https://isaratech.com/cpp-dll-injection-using-createremotethread-on-windows/</a></li> <li><a href=https://www.vicarius.io/blog/wtf-is-frida/ >https://www.vicarius.io/blog/wtf-is-frida/</a></li> <li><a href=https://github.com/rsmudge/vncdll/tree/master/rdll>https://github.com/rsmudge/vncdll/tree/master/rdll</a></li> </ul> <h1 id=references>References<a class=headerlink href=#references title="Permanent link">¶</a></h1> <ul> <li><a href=https://github.com/Taloth/PowerToys/commit/80ddcd08b9fa9537a4d5148735fe2fc9273aecb8>https://github.com/Taloth/PowerToys/commit/80ddcd08b9fa9537a4d5148735fe2fc9273aecb8</a></li> <li><a href=https://github.com/microsoft/PowerToys/wiki/Fancy-Zones-deep-dive>https://github.com/microsoft/PowerToys/wiki/Fancy-Zones-deep-dive</a></li> <li><a href="https://devblogs.microsoft.com/oldnewthing/20210104-00/?p=104656">https://devblogs.microsoft.com/oldnewthing/20210104-00/?p=104656</a></li> <li> <p><a href=http://www.winprog.org/tutorial/window_click.html>http://www.winprog.org/tutorial/window_click.html</a></p> </li> <li> <p><a href=https://stackoverflow.com/questions/1295999/event-when-a-window-gets-maximized-un-maximized>https://stackoverflow.com/questions/1295999/event-when-a-window-gets-maximized-un-maximized</a> </p><div class="language-csharp highlight"><pre><span></span><code><span id=__span-4-1><a href=#__codelineno-4-1 id=__codelineno-4-1 name=__codelineno-4-1></a><span class=k>protected</span><span class=w> </span><span class=k>override</span><span class=w> </span><span class=k>void</span><span class=w> </span><span class=nf>WndProc</span><span class=p>(</span><span class=k>ref</span><span class=w> </span><span class=n>Message</span><span class=w> </span><span class=n>m</span><span class=p>)</span>
</span><span id=__span-4-2><a href=#__codelineno-4-2 id=__codelineno-4-2 name=__codelineno-4-2></a><span class=p>{</span>
</span><span id=__span-4-3><a href=#__codelineno-4-3 id=__codelineno-4-3 name=__codelineno-4-3></a><span class=w>    </span><span class=k>base</span><span class=p>.</span><span class=n>WndProc</span><span class=p>(</span><span class=k>ref</span><span class=w> </span><span class=n>m</span><span class=p>);</span>
</span><span id=__span-4-4><a href=#__codelineno-4-4 id=__codelineno-4-4 name=__codelineno-4-4></a>
</span><span id=__span-4-5><a href=#__codelineno-4-5 id=__codelineno-4-5 name=__codelineno-4-5></a><span class=w>    </span><span class=c1>// WM_SYSCOMMAND</span>
</span><span id=__span-4-6><a href=#__codelineno-4-6 id=__codelineno-4-6 name=__codelineno-4-6></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=n>Msg</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=m>0</span><span class=n>x0112</span><span class=p>)</span>
</span><span id=__span-4-7><a href=#__codelineno-4-7 id=__codelineno-4-7 name=__codelineno-4-7></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-4-8><a href=#__codelineno-4-8 id=__codelineno-4-8 name=__codelineno-4-8></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=n>WParam</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>IntPtr</span><span class=p>(</span><span class=m>0</span><span class=n>xF030</span><span class=p>)</span><span class=w> </span><span class=c1>// Maximize event - SC_MAXIMIZE from Winuser.h</span>
</span><span id=__span-4-9><a href=#__codelineno-4-9 id=__codelineno-4-9 name=__codelineno-4-9></a><span class=w>            </span><span class=o>||</span><span class=w> </span><span class=n>m</span><span class=p>.</span><span class=n>WParam</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>IntPtr</span><span class=p>(</span><span class=m>0</span><span class=n>xF120</span><span class=p>))</span><span class=w> </span><span class=c1>// Restore event - SC_RESTORE from Winuser.h</span>
</span><span id=__span-4-10><a href=#__codelineno-4-10 id=__codelineno-4-10 name=__codelineno-4-10></a><span class=w>        </span><span class=p>{</span>
</span><span id=__span-4-11><a href=#__codelineno-4-11 id=__codelineno-4-11 name=__codelineno-4-11></a><span class=w>            </span><span class=n>UpdateYourUI</span><span class=p>();</span>
</span><span id=__span-4-12><a href=#__codelineno-4-12 id=__codelineno-4-12 name=__codelineno-4-12></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-4-13><a href=#__codelineno-4-13 id=__codelineno-4-13 name=__codelineno-4-13></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-4-14><a href=#__codelineno-4-14 id=__codelineno-4-14 name=__codelineno-4-14></a><span class=p>}</span>
</span></code></pre></div> </li> <li> <p><a href=https://forums.codeguru.com/showthread.php?364445-How-to-detect-if-window-is-maximizing>https://forums.codeguru.com/showthread.php?364445-How-to-detect-if-window-is-maximizing</a> </p><div class="language-csharp highlight"><pre><span></span><code><span id=__span-5-1><a href=#__codelineno-5-1 id=__codelineno-5-1 name=__codelineno-5-1></a><span class=n>To</span><span class=w> </span><span class=n>detect</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=n>the</span><span class=w> </span><span class=n>window</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=n>maximizing</span><span class=p>,</span><span class=w> </span><span class=n>handle</span><span class=w> </span><span class=n>WM_SIZE</span><span class=w> </span><span class=n>and</span><span class=w> </span><span class=n>check</span><span class=w> </span><span class=n>wParam</span><span class=w> </span><span class=n>which</span><span class=w> </span><span class=n>will</span><span class=w> </span><span class=n>be</span><span class=w> </span><span class=n>SIZE_MAXIMIZED</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=n>maximized</span><span class=p>.</span>
</span><span id=__span-5-2><a href=#__codelineno-5-2 id=__codelineno-5-2 name=__codelineno-5-2></a>
</span><span id=__span-5-3><a href=#__codelineno-5-3 id=__codelineno-5-3 name=__codelineno-5-3></a><span class=n>You</span><span class=w> </span><span class=n>can</span><span class=w> </span><span class=n>also</span><span class=w> </span><span class=n>use</span><span class=w> </span><span class=n>GetWindowPlacement</span><span class=w> </span><span class=n>to</span><span class=w> </span><span class=n>check</span><span class=w> </span><span class=n>whether</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>window</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=n>currently</span><span class=w> </span><span class=n>maximized</span><span class=w> </span><span class=n>or</span><span class=w> </span><span class=n>not</span><span class=p>.</span>
</span></code></pre></div> </li> </ul> <h2 id=things-i-considered>Things I Considered<a class=headerlink href=#things-i-considered title="Permanent link">¶</a></h2> <ul> <li>Making application window a child of a parent window<ul> <li><a href=https://windowtop.info/ >https://windowtop.info/</a></li> <li><a href=https://github.com/microsoft/PowerToys/issues/279#issuecomment-1145102438>https://github.com/microsoft/PowerToys/issues/279#issuecomment-1145102438</a></li> </ul> </li> <li>DirectComposition<ul> <li><a href=https://github.com/Microsoft/Windows.UI.Composition-Win32-Samples/tree/master/cpp/ScreenCaptureforHWND>https://github.com/Microsoft/Windows.UI.Composition-Win32-Samples/tree/master/cpp/ScreenCaptureforHWND</a> </li> <li><a href=https://github.com/microsoft/PowerToys/issues/279#issuecomment-1144363857>https://github.com/microsoft/PowerToys/issues/279#issuecomment-1144363857</a> <br></li> </ul> </li> </ul> <div class=blogging-tags-grid> <a class=blogging-tag href=https://samrambles.com/tags#powertoys><code>#powertoys</code></a> <a class=blogging-tag href=https://samrambles.com/tags#windows><code>#windows</code></a> </div> <style>
    .md-typeset .blogging-tags-grid {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 5px;
    }

    .md-typeset .blogging-tag {
        color: var(--md-typeset-color);
        background-color: var(--md-typeset-code-color);
    }

    .md-typeset .blogging-tag code {
        border-radius: 5px;
    }
</style></div> <hr> <div class=md-source-file> <small> Last update: 2023-03-28 </small> </div> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> </div> <a class="md-top md-icon" data-md-component=top hidden href=#> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg> Back to top </a> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Made with ❤️ by Sam. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ rel=noopener target=_blank> Material for MkDocs </a> </div> <div class=md-social> <a class=md-social__link href=https://github.com/peddamat rel=noopener target=_blank title=github.com> <svg viewbox="0 0 480 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"></path></svg> </a> <a class=md-social__link href=https://twitter.com/peddamat rel=noopener target=_blank title=twitter.com> <svg viewbox="0 0 512 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg> </a> <a class=md-social__link href=https://www.instagram.com/speddamat rel=noopener target=_blank title=www.instagram.com> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"></path></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["announce.dismiss", "header.autohide", "search.share", "search.highlight", "search.suggest", "content.code.copy", "content.code.select", "content.code.annotate", "content.tabs.link", "navigation.tracking", "navigation.top", "navigation.sections", "navigation.tabs", "navigation.indexes"], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.2a6f1dda.min.js></script> <script src=../../../assests/scripts/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": false, "openEffect": "none", "closeEffect": "none", "slideEffect": "none"});})</script></body> </html>