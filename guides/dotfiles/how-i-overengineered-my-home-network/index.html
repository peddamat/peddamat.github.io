<!DOCTYPE html><html class=no-js lang=en> <head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content="How my home network is architected and implemented to improve privacy and security for my family and guests." name=description><meta content="Sumanth " name=author peddamatham&quot; sam&quot;><link href=https://samrambles.com/guides/dotfiles/how-i-overengineered-my-home-network/index.html rel=canonical><link href=../../learning-networking-with-mininet/index.html rel=prev><link href=../how-i-setup-this-blog/index.html rel=next><link href=../../../assets/images/favicon.png rel=icon><meta content="mkdocs-1.4.2, mkdocs-material-9.0.15" name=generator><title>How I Overengineered My Home Network - Sam Rambles</title><link href=../../../assets/stylesheets/main.113286f1.min.css rel=stylesheet><link href=../../../assets/stylesheets/palette.a0c5b2b5.min.css rel=stylesheet><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css?family=Noto+Sans:300,300i,400,400i,700,700i%7CIMB+Plex+Mono:400,400i,700,700i&display=fallback" rel=stylesheet><style>:root{--md-text-font:"Noto Sans";--md-code-font:"IMB Plex Mono"}</style><link href=../../../assets/stylesheets/extra.css rel=stylesheet><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-RZQGZXT3GC"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RZQGZXT3GC');
</script><link href=../../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src=../../../assets/javascripts/glightbox.min.js></script></head> <body data-md-color-accent=black data-md-color-primary=black data-md-color-scheme=slate dir=ltr> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox> <input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a class=md-skip href=#how-i-overengineered-my-home-network> Skip to content </a> </div> <div data-md-component=announce> <aside class=md-banner> <div class="md-banner__inner md-grid md-typeset"> <button aria-label="Don't show this again" class="md-banner__button md-icon"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg> </button> <em><b>Migration in progress:</b> apologies for broken articles and links.</em> </div> <script>var content,el=document.querySelector("[data-md-component=announce]");el&&(content=el.querySelector(".md-typeset"),__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0))</script> </aside> </div> <header class=md-header data-md-component=header> <nav aria-label=Header class="md-header__inner md-grid"> <a aria-label="Sam Rambles" class="md-header__button md-logo" data-md-component=logo href=../../../index.html title="Sam Rambles"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Sam Rambles </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> How I Overengineered My Home Network </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input aria-label="Switch to light mode" class=md-option data-md-color-accent=black data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary=black data-md-color-scheme=slate id=__palette_1 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_2 hidden title="Switch to light mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"></path></svg> </label> <input aria-label="Switch to dark mode" class=md-option data-md-color-accent=white data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary=white data-md-color-scheme=white id=__palette_2 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_1 hidden title="Switch to dark mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"></path></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input aria-label=Search autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=Search required spellcheck=false type=text> <label class="md-search__icon md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </label> <nav aria-label=Search class=md-search__options> <a aria-label=Share class="md-search__icon md-icon" data-clipboard data-clipboard-text data-md-component=search-share href=javascript:void(0) tabindex=-1 title=Share> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"></path></svg> </a> <button aria-label=Clear class="md-search__icon md-icon" tabindex=-1 title=Clear type=reset> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a class=md-source data-md-component=source href=https://github.com/peddamat/mkdocs-obsidian title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg> </div> <div class=md-source__repository> peddamat/mkdocs-obsidian </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav aria-label=Tabs class=md-tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a class=md-tabs__link href=../../../index.html> Home </a> </li> <li class=md-tabs__item> <a class=md-tabs__link href=../../../tags/index.html> Tags </a> </li> <li class=md-tabs__item> <a class="md-tabs__link md-tabs__link--active" href=../../index.html> Guides </a> </li> <li class=md-tabs__item> <a class=md-tabs__link href=../../../notes/index.html> Notes </a> </li> <li class=md-tabs__item> <a class=md-tabs__link href=../../../projects/index.html> Projects </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label=Navigation class="md-nav md-nav--primary md-nav--lifted" data-md-level=0> <label class=md-nav__title for=__drawer> <a aria-label="Sam Rambles" class="md-nav__button md-logo" data-md-component=logo href=../../../index.html title="Sam Rambles"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg> </a> Sam Rambles </label> <div class=md-nav__source> <a class=md-source data-md-component=source href=https://github.com/peddamat/mkdocs-obsidian title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg> </div> <div class=md-source__repository> peddamat/mkdocs-obsidian </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../index.html> Home </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../tags/index.html> Tags </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" id=__nav_3 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../index.html>Guides</a> <label for=__nav_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded=true aria-labelledby=__nav_3_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../learning-networking-with-mininet/index.html> Learning Networking With Mininet </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" id=__nav_3_3 type=checkbox> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> Dotfiles <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=true aria-labelledby=__nav_3_3_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Dotfiles </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" id=__toc type=checkbox> <label class="md-nav__link md-nav__link--active" for=__toc> How I Overengineered My Home Network <span class="md-nav__icon md-icon"></span> </label> <a class="md-nav__link md-nav__link--active" href=index.html> How I Overengineered My Home Network </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#10000-ft-view> 10000-ft View </a> <nav aria-label="10000-ft View" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#edgerouter-x> EdgeRouter X </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#vlan-config> VLAN Config </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#wireless-config> Wireless Config </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#firewall-config> Firewall Config </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#edgerouter-x-setup> Edgerouter X Setup </a> <nav aria-label="Edgerouter X Setup" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#getting-started> Getting Started </a> <nav aria-label="Getting Started" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#commands> Commands </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#configuration-directory> Configuration Directory </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#useful-articles> Useful Articles </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#administration-setup> Administration Setup </a> <nav aria-label="Administration Setup" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#ssh-setup> SSH Setup </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#setup-wireguard> Setup Wireguard </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#dhcpdns-setup> DHCP/DNS Setup </a> <nav aria-label="DHCP/DNS Setup" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#create-static-dns-entry-for-unifi-controller> Create Static DNS Entry for Unifi Controller </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#set-router-domain> Set Router Domain </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#setup-dnsmasq> Setup DNSMasq </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#rename-dhcp-servers> Rename DHCP Servers </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#redirect-dns-on-untrusted-vlans-to-internal-adguard-server> Redirect DNS on Untrusted VLANs to Internal AdGuard Server </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#setup-1111-dns> Setup 1.1.1.1 DNS </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#setup-encrypted-dns> Setup Encrypted DNS </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#setup-mdns> Setup mDNS </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#setup-igmp-proxying> Setup IGMP Proxying </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#setup-vlans-subnets> Setup VLANs / Subnets </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#setup-dhcp-servers> Setup DHCP Servers </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#setup-firewall> Setup Firewall </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#hardware-offloading> Hardware Offloading </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#ubiquiti-usw-lite-8-poe-info> Ubiquiti USW-Lite-8-Poe Info </a> <nav aria-label="Ubiquiti USW-Lite-8-Poe Info" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#ports> Ports </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=../how-i-setup-this-blog/index.html> How I Setup This Blog </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../how-i-write-mkdocs-plugins/index.html> How I Write MkDocs Plugins </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../how-to-quickly-setup-a-wireless-mitm-proxy/index.html> How To Quickly Setup A Wireless MitM Proxy </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_4 type=checkbox> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> Fancy Zones <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_4_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Fancy Zones </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../fancy-zones/fancy-zones-development-environment-setup/index.html> Fancy Zones Development Environment Setup </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../fancy-zones/fancy-zones-internals/index.html> Fancy Zones Internals </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_5 type=checkbox> <label class=md-nav__link for=__nav_3_5 id=__nav_3_5_label tabindex=0> Home DIY <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_5_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Home DIY </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../home-diy/how-to-size-a-solar-battery-install/index.html> How To Size A Solar Battery Install </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_6 type=checkbox> <label class=md-nav__link for=__nav_3_6 id=__nav_3_6_label tabindex=0> Window Hacking With Rust <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_6_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Window Hacking With Rust </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../window-hacking-with-rust/creating-a-dll-with-rust/index.html> Creating A DLL With Rust </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../window-hacking-with-rust/creating-a-window-with-rust/index.html> Creating A Window With Rust </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../window-hacking-with-rust/injecting-dlls-with-rust/index.html> Injecting DLLs With Rust </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../window-hacking-with-rust/production-ready-dll-injection/index.html> Production Ready DLL Injection </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_4 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../notes/index.html>Notes</a> <label for=__nav_4> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded=false aria-labelledby=__nav_4_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Notes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/debugging-tools/index.html> Debugging Tools </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/reverse-engineering-tools/index.html> Reverse Engineering Tools </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_4_4 type=checkbox> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> Cheatsheets <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_4_4_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> Cheatsheets </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/cheatsheets/docker-cheatsheet/index.html> Docker Cheatsheet </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/cheatsheets/git-cheatsheet/index.html> Git Cheatsheet </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/cheatsheets/rsync-cheatsheet/index.html> Rsync Cheatsheet </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/cheatsheets/ruby-cheatsheet/index.html> Ruby Cheatsheet </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/cheatsheets/tls-cheatsheet/index.html> TLS Cheatsheet </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_4_5 type=checkbox> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex=0> Debug Probes <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_4_5_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> Debug Probes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/debug-probes/black-magic-probe/index.html> Black Magic Probe </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/debug-probes/segger-j-link/index.html> Segger J-Link </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_4_6 type=checkbox> <label class=md-nav__link for=__nav_4_6 id=__nav_4_6_label tabindex=0> Development Kits <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_4_6_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_4_6> <span class="md-nav__icon md-icon"></span> Development Kits </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/development-kits/adafruit-feather-m0-wifi/index.html> Adafruit Feather M0 WiFi </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/development-kits/esp32/index.html> ESP32 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/development-kits/raspberry-pi/index.html> Raspberry Pi </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_4_6_4 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../notes/development-kits/esp8266/index.html>ESP8266</a> <label for=__nav_4_6_4> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded=false aria-labelledby=__nav_4_6_4_label class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_4_6_4> <span class="md-nav__icon md-icon"></span> ESP8266 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/development-kits/esp8266/esp-01/index.html> ESP-01 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/development-kits/esp8266/wemos-mini/index.html> Wemos Mini </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_4_6_5 type=checkbox> <label class=md-nav__link for=__nav_4_6_5 id=__nav_4_6_5_label tabindex=0> STM32 <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_4_6_5_label class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_4_6_5> <span class="md-nav__icon md-icon"></span> STM32 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/development-kits/stm32/black-pill/index.html> Black Pill </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/development-kits/stm32/itead-maple/index.html> ITead Maple </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/development-kits/stm32/super-blue-pill/index.html> Super Blue Pill </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_5 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../projects/index.html>Projects</a> <label for=__nav_5> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded=false aria-labelledby=__nav_5_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Projects </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_5_2 type=checkbox> <label class=md-nav__link for=__nav_5_2 id=__nav_5_2_label tabindex=0> Apps <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_5_2_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> Apps </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/apps/introducing-recon/index.html> Introducing Recon </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/apps/introducing-sensie/index.html> Introducing Sensie </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/apps/serialmoose-serial-port-sniffer/index.html> SerialMoose Serial Port Sniffer </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_5_2_4 type=checkbox> <label class=md-nav__link for=__nav_5_2_4 id=__nav_5_2_4_label tabindex=0> CalibreSync <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_5_2_4_label class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_5_2_4> <span class="md-nav__icon md-icon"></span> CalibreSync </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/apps/calibresync/calibresync-development-notes/index.html> CalibreSync Development Notes </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_5_3 type=checkbox> <label class=md-nav__link for=__nav_5_3 id=__nav_5_3_label tabindex=0> Cancer Research <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_5_3_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_5_3> <span class="md-nav__icon md-icon"></span> Cancer Research </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/cancer-research/generating-complete-genomics-build37-files/index.html> Generating Complete Genomics build37 Files </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/cancer-research/target-aml-data-analysis/index.html> TARGET AML Data Analysis </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_5_4 type=checkbox> <label class=md-nav__link for=__nav_5_4 id=__nav_5_4_label tabindex=0> Home Assistant <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_5_4_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_5_4> <span class="md-nav__icon md-icon"></span> Home Assistant </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/home-assistant/my-smart-home-devices/index.html> My Smart Home Devices </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/home-assistant/samsung-refrigerator-integration/index.html> Samsung Refrigerator Integration </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_5_5 type=checkbox> <label class=md-nav__link for=__nav_5_5 id=__nav_5_5_label tabindex=0> Hunter Hacking <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_5_5_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_5_5> <span class="md-nav__icon md-icon"></span> Hunter Hacking </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/hunter-hacking/a-look-inside-a-hunter-pro-hc-controller/index.html> A Look Inside A Hunter Pro-HC Controller </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/hunter-hacking/atwinc1500-iot-module-deep-dive-part-1/index.html> ATWINC1500 IoT Module Deep-Dive (Part 1) </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/hunter-hacking/atwinc1500-iot-module-deep-dive-part-2/index.html> ATWINC1500 IoT Module Deep-Dive (Part 2) </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/hunter-hacking/hands-on-iot-mitm-part-1/index.html> Hands On IoT MitM (Part 1) </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/hunter-hacking/hands-on-iot-mitm-part-2/index.html> Hands On IoT MitM (Part 2) </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../projects/hunter-hacking/reverse-engineering-a-hunter-pro-hc-controller/index.html> Reverse Engineering A Hunter Pro HC Controller </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#10000-ft-view> 10000-ft View </a> <nav aria-label="10000-ft View" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#edgerouter-x> EdgeRouter X </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#vlan-config> VLAN Config </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#wireless-config> Wireless Config </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#firewall-config> Firewall Config </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#edgerouter-x-setup> Edgerouter X Setup </a> <nav aria-label="Edgerouter X Setup" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#getting-started> Getting Started </a> <nav aria-label="Getting Started" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#commands> Commands </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#configuration-directory> Configuration Directory </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#useful-articles> Useful Articles </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#administration-setup> Administration Setup </a> <nav aria-label="Administration Setup" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#ssh-setup> SSH Setup </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#setup-wireguard> Setup Wireguard </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#dhcpdns-setup> DHCP/DNS Setup </a> <nav aria-label="DHCP/DNS Setup" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#create-static-dns-entry-for-unifi-controller> Create Static DNS Entry for Unifi Controller </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#set-router-domain> Set Router Domain </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#setup-dnsmasq> Setup DNSMasq </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#rename-dhcp-servers> Rename DHCP Servers </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#redirect-dns-on-untrusted-vlans-to-internal-adguard-server> Redirect DNS on Untrusted VLANs to Internal AdGuard Server </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#setup-1111-dns> Setup 1.1.1.1 DNS </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#setup-encrypted-dns> Setup Encrypted DNS </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#setup-mdns> Setup mDNS </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#setup-igmp-proxying> Setup IGMP Proxying </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#setup-vlans-subnets> Setup VLANs / Subnets </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#setup-dhcp-servers> Setup DHCP Servers </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#setup-firewall> Setup Firewall </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#hardware-offloading> Hardware Offloading </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#ubiquiti-usw-lite-8-poe-info> Ubiquiti USW-Lite-8-Poe Info </a> <nav aria-label="Ubiquiti USW-Lite-8-Poe Info" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#ports> Ports </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <nav class=md-tags> <a class=md-tag href=../../../tags/index.html#home>home</a> <a class=md-tag href=../../../tags/index.html#network>network</a> <a class=md-tag href=../../../tags/index.html#security>security</a> <a class=md-tag href=../../../tags/index.html#edgerouter>edgerouter</a> <a class=md-tag href=../../../tags/index.html#unifi>unifi</a> <a class=md-tag href=../../../tags/index.html#wip>wip</a> </nav> <div><h1 id=how-i-overengineered-my-home-network>How I Overengineered My Home Network<a class=headerlink href=#how-i-overengineered-my-home-network title="Permanent link">¶</a></h1> <p>A long while back I stumbled across Ben Balter's post "<a href=https://ben.balter.com/2020/12/04/over-engineered-home-network-for-privacy-and-security/ >How I over-engineered my home network for privacy and security</a> on HN, and appreciated his thoughtful, yet excessive, approach to designing his home's network.</p> <p>I created this note while architecting my own home network.</p> <h2 id=10000-ft-view>10000-ft View<a class=headerlink href=#10000-ft-view title="Permanent link">¶</a></h2> <p>My physical network looks something like this:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/how-i-overengineered-my-home-network-2023-03-13-15.44.18.excalidraw.svg><img alt="How I Overengineered My Home Network 2023-03-13 15.44.18.excalidraw.svg" src=../../../assets/images/how-i-overengineered-my-home-network-2023-03-13-15.44.18.excalidraw.svg></a></p> <p>My logical network looks like this:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/how-i-overengineered-my-home-network-2023-03-13-16.02.02.excalidraw.svg><img alt="How I Overengineered My Home Network 2023-03-13 16.02.02.excalidraw.svg" src=../../../assets/images/how-i-overengineered-my-home-network-2023-03-13-16.02.02.excalidraw.svg></a></p> <hr> <h3 id=edgerouter-x>EdgeRouter X<a class=headerlink href=#edgerouter-x title="Permanent link">¶</a></h3> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/a5f635f30f2842baa90d56413e76d90c.png><img alt=a5f635f30f2842baa90d56413e76d90c.png src=../../../assets/images/a5f635f30f2842baa90d56413e76d90c.png></a></p> <table> <thead> <tr> <th>Interface</th> <th>Description</th> <th>VLAN (PID)</th> <th>VLAN (VID)</th> </tr> </thead> <tbody> <tr> <td>eth0</td> <td>WAN/Internet</td> <td></td> <td></td> </tr> <tr> <td>eth1</td> <td>Core Switch</td> <td></td> <td></td> </tr> <tr> <td>eth2</td> <td>Living Room TV</td> <td></td> <td></td> </tr> <tr> <td>eth3</td> <td>Home Assistant</td> <td></td> <td></td> </tr> <tr> <td>eth4</td> <td>Living Room Wifi</td> <td></td> <td></td> </tr> </tbody> </table> <h3 id=vlan-config>VLAN Config<a class=headerlink href=#vlan-config title="Permanent link">¶</a></h3> <p>With the network segmented using VLANs:</p> <table> <thead> <tr> <th>VLAN</th> <th>Subnet</th> <th>Domain</th> <th>Name</th> <th>SSID</th> <th>Zone</th> </tr> </thead> <tbody> <tr> <td>1003</td> <td>172.1.1.x</td> <td>guestwifi.home</td> <td>Guest WiFi</td> <td>guest-wifi</td> <td>GUEST</td> </tr> <tr> <td>3</td> <td>172.1.3.x</td> <td>iot.home</td> <td>IoT WiFi</td> <td>iot</td> <td>UNTRUSTED</td> </tr> <tr> <td>4</td> <td>172.1.4.x</td> <td>ha.home</td> <td>Home Assistant</td> <td>N/A</td> <td>GUEST</td> </tr> <tr> <td>5</td> <td>172.1.3.x</td> <td>iot-voice.home</td> <td>IoT Voice WiFi</td> <td>iot-voice</td> <td>UNTRUSTED</td> </tr> <tr> <td>6</td> <td>172.1.3.x</td> <td>iot-tv.home</td> <td>IoT TV WiFi</td> <td>iot-tv</td> <td>UNTRUSTED</td> </tr> <tr> <td>10</td> <td>192.168.1.x</td> <td>mgmt.home</td> <td>Management</td> <td>N/A</td> <td>LAN</td> </tr> <tr> <td>11</td> <td>192.168.1.x</td> <td>wired.home</td> <td>Wired</td> <td>N/A</td> <td>LAN</td> </tr> </tbody> </table> <h3 id=wireless-config>Wireless Config<a class=headerlink href=#wireless-config title="Permanent link">¶</a></h3> <p>The WAPs broadcast three SSIDs: <code>guest-wifi</code>, <code>iot-voice</code>, and <code>iot-voice</code>; the latter two being hidden. </p> <h3 id=firewall-config>Firewall Config<a class=headerlink href=#firewall-config title="Permanent link">¶</a></h3> <p>My firewall uses zone-based policies to specifically enable traffic between zones.</p> <table> <thead> <tr> <th>Source</th> <th>Destination</th> <th>Policy</th> </tr> </thead> <tbody> <tr> <td>LAN</td> <td>ALL</td> <td>Allow</td> </tr> <tr> <td>LOCAL</td> <td>ALL</td> <td>Allow</td> </tr> <tr> <td>WAN</td> <td>IN</td> <td>Established</td> </tr> <tr> <td>GUEST</td> <td>LAN</td> <td>Deny</td> </tr> <tr> <td>GUEST</td> <td>WAN</td> <td>Allow</td> </tr> <tr> <td>GUEST</td> <td>LOCAL</td> <td>Deny except DHCP/DNS</td> </tr> <tr> <td>UNTRUSTED</td> <td>LAN</td> <td>Deny</td> </tr> <tr> <td>UNTRUSTED</td> <td>WAN</td> <td>Deny</td> </tr> <tr> <td>UNTRUSTED</td> <td>GUEST</td> <td>Established</td> </tr> <tr> <td>GUEST</td> <td>LOCAL</td> <td>Deny except DHCP/DNS</td> </tr> </tbody> </table> <hr> <h2 id=edgerouter-x-setup>Edgerouter X Setup<a class=headerlink href=#edgerouter-x-setup title="Permanent link">¶</a></h2> <h3 id=getting-started>Getting Started<a class=headerlink href=#getting-started title="Permanent link">¶</a></h3> <p>The EdgeRouter X is based on Vyatta, here are a few things you should know about working with Vyatta.</p> <h4 id=commands>Commands<a class=headerlink href=#commands title="Permanent link">¶</a></h4> <ul> <li>SSH<ul> <li>Show all public keys <code>show configuration commands | egrep public-keys</code></li> <li>Delete a user's public key: <code>delete system login user coniferadmin authentication public-keys</code></li> </ul> </li> </ul> <h4 id=configuration-directory>Configuration Directory<a class=headerlink href=#configuration-directory title="Permanent link">¶</a></h4> <p>The EdgeRouter config directory is located at /config and is used to store various system files such as:</p> <ul> <li><code>Boot/startup configuration file</code> See the <a href=https://help.ui.com/hc/en-us/articles/360002535514>Backup and Restore Configuration</a> article for more information.</li> <li><code>OpenVPN certificates and key files</code> See the <a href=https://help.ui.com/hc/en-us/articles/115015971688>OpenVPN Server and OpenVPN Site-to-Site</a> articles for more information.</li> <li><code>VPN RSA keys</code> See the <a href=https://help.ui.com/hc/en-us/articles/115011373628>Dynamic Site-to-Site IPsec VPN using FQDNs</a> article for more information.</li> <li><code>Custom (boot/startup) scripts</code> See the <a href=https://help.ui.com/hc/en-us/articles/204976164>Run Operational Mode Command from Scripts</a> article for more information.</li> <li><code>Commit archive</code> See the <a href=https://help.ui.com/hc/en-us/articles/204960084>Archiving and Managing the Configuration Files</a> article for more information.</li> </ul> <p>Files stored in the config directory persist between reboots and firmware upgrades. The directory is only cleared when the device is reset to factory defaults. The contents of the config directory can either be downloaded through UNMS, the local Web UI (contained in the configuration backup archive) or transferred/copied from the Command Line. </p> <p>Each method is demonstrated below. - <a href=https://help.ui.com/hc/en-us/articles/360044753453-EdgeRouter-Backing-Up-the-Config-Directory>https://help.ui.com/hc/en-us/articles/360044753453-EdgeRouter-Backing-Up-the-Config-Directory</a></p> <p>.deb packages in <code>/config/data/firstboot/install-packages/</code> are automatically installed after firmware updates.</p> <p>The contents of <code>/config/scripts/firstboot.d/</code> are executed once after each firmware update.</p> <h4 id=useful-articles>Useful Articles<a class=headerlink href=#useful-articles title="Permanent link">¶</a></h4> <ul> <li><a href=https://help.ui.com/hc/en-us/sections/200919150-EdgeRouter-Getting-Started>Getting Started</a></li> </ul> <hr> <h3 id=administration-setup>Administration Setup<a class=headerlink href=#administration-setup title="Permanent link">¶</a></h3> <h4 id=ssh-setup>SSH Setup<a class=headerlink href=#ssh-setup title="Permanent link">¶</a></h4> <ol> <li><a href=https://docs.microsoft.com/en-us/windows-server/administration/openssh/openssh_keymanagement>Enable OpenSSH on Windows</a></li> </ol> <p></p><div class="language-text highlight"><pre><span></span><code><span id=__span-0-1><a href=#__codelineno-0-1 id=__codelineno-0-1 name=__codelineno-0-1></a># Set the sshd service to be started automatically
</span><span id=__span-0-2><a href=#__codelineno-0-2 id=__codelineno-0-2 name=__codelineno-0-2></a>Get-Service -Name ssh-agent | Set-Service -StartupType Automatic
</span><span id=__span-0-3><a href=#__codelineno-0-3 id=__codelineno-0-3 name=__codelineno-0-3></a>
</span><span id=__span-0-4><a href=#__codelineno-0-4 id=__codelineno-0-4 name=__codelineno-0-4></a># Now start the sshd service
</span><span id=__span-0-5><a href=#__codelineno-0-5 id=__codelineno-0-5 name=__codelineno-0-5></a>Start-Service sshd
</span></code></pre></div> 2. Generate coniferadmin SSH keypair: <code>ssh-keygen -t ed25519 -C coniferadmin -f coniferadmin</code> 3. Add key to ssh-agent: <code>ssh-add coniferadmin</code> 4. Copy key to router: <code>scp coniferadmin.pub coniferadmin@router.home:~/</code> 5. Load key on router: <div class="language-text highlight"><pre><span></span><code><span id=__span-1-1><a href=#__codelineno-1-1 id=__codelineno-1-1 name=__codelineno-1-1></a>configure
</span><span id=__span-1-2><a href=#__codelineno-1-2 id=__codelineno-1-2 name=__codelineno-1-2></a>loadkey coniferadmin coniferadmin.pub
</span><span id=__span-1-3><a href=#__codelineno-1-3 id=__codelineno-1-3 name=__codelineno-1-3></a>set service ssh disable-password-authentication
</span><span id=__span-1-4><a href=#__codelineno-1-4 id=__codelineno-1-4 name=__codelineno-1-4></a>commit; save; exit
</span><span id=__span-1-5><a href=#__codelineno-1-5 id=__codelineno-1-5 name=__codelineno-1-5></a>show configuration commands | egrep public-keys
</span><span id=__span-1-6><a href=#__codelineno-1-6 id=__codelineno-1-6 name=__codelineno-1-6></a>rm coniferadmin.pub
</span></code></pre></div> <hr> <h4 id=setup-wireguard>Setup Wireguard<a class=headerlink href=#setup-wireguard title="Permanent link">¶</a></h4> <ul> <li><a href=https://www.erianna.com/wireguard-ubiquity-edgeos/ >https://www.erianna.com/wireguard-ubiquity-edgeos/</a></li> </ul> <div class="language-text highlight"><pre><span></span><code><span id=__span-2-1><a href=#__codelineno-2-1 id=__codelineno-2-1 name=__codelineno-2-1></a>cd /tmp
</span><span id=__span-2-2><a href=#__codelineno-2-2 id=__codelineno-2-2 name=__codelineno-2-2></a>
</span><span id=__span-2-3><a href=#__codelineno-2-3 id=__codelineno-2-3 name=__codelineno-2-3></a># Download the appropriate version
</span><span id=__span-2-4><a href=#__codelineno-2-4 id=__codelineno-2-4 name=__codelineno-2-4></a>curl -qLs https://github.com/WireGuard/wireguard-vyatta-ubnt/releases/download/1.0.20210606-2/e50-v2-v1.0.20210606-v1.0.20210914.deb -o wireguard.deb
</span><span id=__span-2-5><a href=#__codelineno-2-5 id=__codelineno-2-5 name=__codelineno-2-5></a>sudo dpkg -i wireguard.deb
</span><span id=__span-2-6><a href=#__codelineno-2-6 id=__codelineno-2-6 name=__codelineno-2-6></a>
</span><span id=__span-2-7><a href=#__codelineno-2-7 id=__codelineno-2-7 name=__codelineno-2-7></a>wg genkey | tee /dev/tty | wg pubkey
</span><span id=__span-2-8><a href=#__codelineno-2-8 id=__codelineno-2-8 name=__codelineno-2-8></a>
</span><span id=__span-2-9><a href=#__codelineno-2-9 id=__codelineno-2-9 name=__codelineno-2-9></a># Private key: abc
</span><span id=__span-2-10><a href=#__codelineno-2-10 id=__codelineno-2-10 name=__codelineno-2-10></a># Public key: xxx
</span><span id=__span-2-11><a href=#__codelineno-2-11 id=__codelineno-2-11 name=__codelineno-2-11></a>
</span><span id=__span-2-12><a href=#__codelineno-2-12 id=__codelineno-2-12 name=__codelineno-2-12></a>configure
</span><span id=__span-2-13><a href=#__codelineno-2-13 id=__codelineno-2-13 name=__codelineno-2-13></a>
</span><span id=__span-2-14><a href=#__codelineno-2-14 id=__codelineno-2-14 name=__codelineno-2-14></a># Adjust the address route as necessary
</span><span id=__span-2-15><a href=#__codelineno-2-15 id=__codelineno-2-15 name=__codelineno-2-15></a>set interfaces wireguard wg0 address 192.168.33.1/24
</span><span id=__span-2-16><a href=#__codelineno-2-16 id=__codelineno-2-16 name=__codelineno-2-16></a>set interfaces wireguard wg0 listen-port 51820
</span><span id=__span-2-17><a href=#__codelineno-2-17 id=__codelineno-2-17 name=__codelineno-2-17></a>set interfaces wireguard wg0 route-allowed-ips true
</span><span id=__span-2-18><a href=#__codelineno-2-18 id=__codelineno-2-18 name=__codelineno-2-18></a>
</span><span id=__span-2-19><a href=#__codelineno-2-19 id=__codelineno-2-19 name=__codelineno-2-19></a>set interfaces wireguard wg0 private-key abc
</span><span id=__span-2-20><a href=#__codelineno-2-20 id=__codelineno-2-20 name=__codelineno-2-20></a>
</span><span id=__span-2-21><a href=#__codelineno-2-21 id=__codelineno-2-21 name=__codelineno-2-21></a>commit
</span><span id=__span-2-22><a href=#__codelineno-2-22 id=__codelineno-2-22 name=__codelineno-2-22></a>
</span><span id=__span-2-23><a href=#__codelineno-2-23 id=__codelineno-2-23 name=__codelineno-2-23></a>### Setup client then do the following
</span><span id=__span-2-24><a href=#__codelineno-2-24 id=__codelineno-2-24 name=__codelineno-2-24></a>
</span><span id=__span-2-25><a href=#__codelineno-2-25 id=__codelineno-2-25 name=__codelineno-2-25></a>set interfaces wireguard wg0 peer def allowed-ips 192.168.33.2/32
</span><span id=__span-2-26><a href=#__codelineno-2-26 id=__codelineno-2-26 name=__codelineno-2-26></a>
</span><span id=__span-2-27><a href=#__codelineno-2-27 id=__codelineno-2-27 name=__codelineno-2-27></a>commit
</span><span id=__span-2-28><a href=#__codelineno-2-28 id=__codelineno-2-28 name=__codelineno-2-28></a>save
</span></code></pre></div> <hr> <h3 id=dhcpdns-setup>DHCP/DNS Setup<a class=headerlink href=#dhcpdns-setup title="Permanent link">¶</a></h3> <ul> <li><a href=https://help.ui.com/hc/en-us/articles/115002673188>https://help.ui.com/hc/en-us/articles/115002673188</a></li> </ul> <h4 id=create-static-dns-entry-for-unifi-controller>Create Static DNS Entry for Unifi Controller<a class=headerlink href=#create-static-dns-entry-for-unifi-controller title="Permanent link">¶</a></h4> <ul> <li><a href=https://community.ui.com/questions/Create-DNS-enteries/ab712740-d579-4c89-824a-cda582a6bdd4>https://community.ui.com/questions/Create-DNS-enteries/ab712740-d579-4c89-824a-cda582a6bdd4</a></li> </ul> <div class="language-text highlight"><pre><span></span><code><span id=__span-3-1><a href=#__codelineno-3-1 id=__codelineno-3-1 name=__codelineno-3-1></a>configure
</span><span id=__span-3-2><a href=#__codelineno-3-2 id=__codelineno-3-2 name=__codelineno-3-2></a>delete system static-host-mapping host-name unifi.home
</span><span id=__span-3-3><a href=#__codelineno-3-3 id=__codelineno-3-3 name=__codelineno-3-3></a>set system static-host-mapping host-name unifi.home inet 192.168.1.74
</span><span id=__span-3-4><a href=#__codelineno-3-4 id=__codelineno-3-4 name=__codelineno-3-4></a>commit;save;exit
</span></code></pre></div> <h4 id=set-router-domain>Set Router Domain<a class=headerlink href=#set-router-domain title="Permanent link">¶</a></h4> <div class="language-text highlight"><pre><span></span><code><span id=__span-4-1><a href=#__codelineno-4-1 id=__codelineno-4-1 name=__codelineno-4-1></a>configure
</span><span id=__span-4-2><a href=#__codelineno-4-2 id=__codelineno-4-2 name=__codelineno-4-2></a>set system domain-name router.home
</span><span id=__span-4-3><a href=#__codelineno-4-3 id=__codelineno-4-3 name=__codelineno-4-3></a>commit; save; exit
</span></code></pre></div> <h4 id=setup-dnsmasq>Setup DNSMasq<a class=headerlink href=#setup-dnsmasq title="Permanent link">¶</a></h4> <div class="language-text highlight"><pre><span></span><code><span id=__span-5-1><a href=#__codelineno-5-1 id=__codelineno-5-1 name=__codelineno-5-1></a>configure
</span><span id=__span-5-2><a href=#__codelineno-5-2 id=__codelineno-5-2 name=__codelineno-5-2></a>set service dhcp-server use-dnsmasq enable 
</span><span id=__span-5-3><a href=#__codelineno-5-3 id=__codelineno-5-3 name=__codelineno-5-3></a>commit ; save; exit
</span></code></pre></div> <h4 id=rename-dhcp-servers>Rename DHCP Servers<a class=headerlink href=#rename-dhcp-servers title="Permanent link">¶</a></h4> <div class="language-text highlight"><pre><span></span><code><span id=__span-6-1><a href=#__codelineno-6-1 id=__codelineno-6-1 name=__codelineno-6-1></a>configure
</span><span id=__span-6-2><a href=#__codelineno-6-2 id=__codelineno-6-2 name=__codelineno-6-2></a>edit service dhcp-server
</span><span id=__span-6-3><a href=#__codelineno-6-3 id=__codelineno-6-3 name=__codelineno-6-3></a>rename shared-network-name LAN to shared-network-name mgmt.home
</span><span id=__span-6-4><a href=#__codelineno-6-4 id=__codelineno-6-4 name=__codelineno-6-4></a>rename shared-network-name LAN-WLAN-Untrusted to shared-network-name guestwifi.home
</span><span id=__span-6-5><a href=#__codelineno-6-5 id=__codelineno-6-5 name=__codelineno-6-5></a>rename shared-network-name WLAN-IoT to shared-network-name iot.home
</span><span id=__span-6-6><a href=#__codelineno-6-6 id=__codelineno-6-6 name=__codelineno-6-6></a>top
</span><span id=__span-6-7><a href=#__codelineno-6-7 id=__codelineno-6-7 name=__codelineno-6-7></a>commit; save; exit
</span></code></pre></div> <h4 id=redirect-dns-on-untrusted-vlans-to-internal-adguard-server>Redirect DNS on Untrusted VLANs to Internal AdGuard Server<a class=headerlink href=#redirect-dns-on-untrusted-vlans-to-internal-adguard-server title="Permanent link">¶</a></h4> <ul> <li><a href=https://www.derekseaman.com/2019/10/redirect-hard-coded-dns-to-pi-hole-using-ubiquiti-edgerouter.html>https://www.derekseaman.com/2019/10/redirect-hard-coded-dns-to-pi-hole-using-ubiquiti-edgerouter.html</a></li> </ul> <h4 id=setup-1111-dns>Setup 1.1.1.1 DNS<a class=headerlink href=#setup-1111-dns title="Permanent link">¶</a></h4> <p></p><div class="language-text highlight"><pre><span></span><code><span id=__span-7-1><a href=#__codelineno-7-1 id=__codelineno-7-1 name=__codelineno-7-1></a>sudo mkdir /config/dnsmasq
</span><span id=__span-7-2><a href=#__codelineno-7-2 id=__codelineno-7-2 name=__codelineno-7-2></a>sudo chown dnsmasq:nogroup /config/dnsmasq
</span><span id=__span-7-3><a href=#__codelineno-7-3 id=__codelineno-7-3 name=__codelineno-7-3></a>
</span><span id=__span-7-4><a href=#__codelineno-7-4 id=__codelineno-7-4 name=__codelineno-7-4></a>configure
</span><span id=__span-7-5><a href=#__codelineno-7-5 id=__codelineno-7-5 name=__codelineno-7-5></a>set service dns forwarding name-server 1.1.1.1
</span><span id=__span-7-6><a href=#__codelineno-7-6 id=__codelineno-7-6 name=__codelineno-7-6></a>set service dns forwarding name-server 1.0.0.1
</span><span id=__span-7-7><a href=#__codelineno-7-7 id=__codelineno-7-7 name=__codelineno-7-7></a>set service dns forwarding name-server '2606:4700:4700::1111'
</span><span id=__span-7-8><a href=#__codelineno-7-8 id=__codelineno-7-8 name=__codelineno-7-8></a>set service dns forwarding name-server '2606:4700:4700::1001'
</span><span id=__span-7-9><a href=#__codelineno-7-9 id=__codelineno-7-9 name=__codelineno-7-9></a>set service dns forwarding options dnssec
</span><span id=__span-7-10><a href=#__codelineno-7-10 id=__codelineno-7-10 name=__codelineno-7-10></a>set service dns forwarding options trust-anchor=.,19036,8,2,49AAC11D7B6F6446702E54A1607371607A1A41855200FD2CE1CDDE32F24E8FB5
</span><span id=__span-7-11><a href=#__codelineno-7-11 id=__codelineno-7-11 name=__codelineno-7-11></a>set service dns forwarding options trust-anchor=.,20326,8,2,E06D44B80B8F1D39A95C0B0D7C65D08458E880409BBC683457104237C7F8EC8D
</span><span id=__span-7-12><a href=#__codelineno-7-12 id=__codelineno-7-12 name=__codelineno-7-12></a>set service dns forwarding options dnssec-check-unsigned
</span><span id=__span-7-13><a href=#__codelineno-7-13 id=__codelineno-7-13 name=__codelineno-7-13></a>set service dns forwarding options dnssec-timestamp=/config/dnsmasq/dnsmasq.time
</span><span id=__span-7-14><a href=#__codelineno-7-14 id=__codelineno-7-14 name=__codelineno-7-14></a>delete system name-server
</span><span id=__span-7-15><a href=#__codelineno-7-15 id=__codelineno-7-15 name=__codelineno-7-15></a>set system name-server 127.0.0.1
</span><span id=__span-7-16><a href=#__codelineno-7-16 id=__codelineno-7-16 name=__codelineno-7-16></a>commit; save; exit
</span><span id=__span-7-17><a href=#__codelineno-7-17 id=__codelineno-7-17 name=__codelineno-7-17></a>
</span><span id=__span-7-18><a href=#__codelineno-7-18 id=__codelineno-7-18 name=__codelineno-7-18></a>show dns forwarding nameservers
</span><span id=__span-7-19><a href=#__codelineno-7-19 id=__codelineno-7-19 name=__codelineno-7-19></a>show dns forwarding statistics
</span></code></pre></div> - <a href=https://help.ui.com/hc/en-us/articles/115010913367-EdgeRouter-DNS-Forwarding-Setup-and-Options>https://help.ui.com/hc/en-us/articles/115010913367-EdgeRouter-DNS-Forwarding-Setup-and-Options</a> <h4 id=setup-encrypted-dns>Setup Encrypted DNS<a class=headerlink href=#setup-encrypted-dns title="Permanent link">¶</a></h4> <ul> <li><a href=https://timmydouglas.com/2019/06/09/dns-over-tls.html>https://timmydouglas.com/2019/06/09/dns-over-tls.html</a></li> </ul> <div class="language-text highlight"><pre><span></span><code><span id=__span-8-1><a href=#__codelineno-8-1 id=__codelineno-8-1 name=__codelineno-8-1></a>TBD
</span></code></pre></div> <hr> <hr> <h3 id=setup-mdns>Setup mDNS<a class=headerlink href=#setup-mdns title="Permanent link">¶</a></h3> <ul> <li><a href=https://help.ui.com/hc/en-us/articles/360035256553-EdgeRouter-mDNS-Repeater>https://help.ui.com/hc/en-us/articles/360035256553-EdgeRouter-mDNS-Repeater</a></li> </ul> <p>Helps make Chromecast work across subnets.</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-9-1><a href=#__codelineno-9-1 id=__codelineno-9-1 name=__codelineno-9-1></a>configure
</span><span id=__span-9-2><a href=#__codelineno-9-2 id=__codelineno-9-2 name=__codelineno-9-2></a>set service mdns repeater interface switch0.1003
</span><span id=__span-9-3><a href=#__codelineno-9-3 id=__codelineno-9-3 name=__codelineno-9-3></a>set service mdns repeater interface switch0.4
</span><span id=__span-9-4><a href=#__codelineno-9-4 id=__codelineno-9-4 name=__codelineno-9-4></a>set service mdns repeater interface switch0
</span><span id=__span-9-5><a href=#__codelineno-9-5 id=__codelineno-9-5 name=__codelineno-9-5></a>commit; save; exit
</span></code></pre></div> <h3 id=setup-igmp-proxying>Setup IGMP Proxying<a class=headerlink href=#setup-igmp-proxying title="Permanent link">¶</a></h3> <ul> <li><a href=https://help.ui.com/hc/en-us/articles/204961854-EdgeRouter-IGMP-Proxy>https://help.ui.com/hc/en-us/articles/204961854-EdgeRouter-IGMP-Proxy</a></li> </ul> <div class="language-text highlight"><pre><span></span><code><span id=__span-10-1><a href=#__codelineno-10-1 id=__codelineno-10-1 name=__codelineno-10-1></a>set protocols igmp-proxy interface switch0 role upstream
</span><span id=__span-10-2><a href=#__codelineno-10-2 id=__codelineno-10-2 name=__codelineno-10-2></a>set protocols igmp-proxy interface switch0.1003 role downstream
</span><span id=__span-10-3><a href=#__codelineno-10-3 id=__codelineno-10-3 name=__codelineno-10-3></a>
</span><span id=__span-10-4><a href=#__codelineno-10-4 id=__codelineno-10-4 name=__codelineno-10-4></a>set protocols igmp-proxy interface switch0 threshold 1
</span><span id=__span-10-5><a href=#__codelineno-10-5 id=__codelineno-10-5 name=__codelineno-10-5></a>set protocols igmp-proxy interface switch0 alt-subnet 0.0.0.0/0
</span><span id=__span-10-6><a href=#__codelineno-10-6 id=__codelineno-10-6 name=__codelineno-10-6></a>
</span><span id=__span-10-7><a href=#__codelineno-10-7 id=__codelineno-10-7 name=__codelineno-10-7></a>set protocols igmp-proxy interface switch0.1003 threshold 1
</span><span id=__span-10-8><a href=#__codelineno-10-8 id=__codelineno-10-8 name=__codelineno-10-8></a>set protocols igmp-proxy interface switch0.1003 alt-subnet 0.0.0.0/0
</span><span id=__span-10-9><a href=#__codelineno-10-9 id=__codelineno-10-9 name=__codelineno-10-9></a>
</span><span id=__span-10-10><a href=#__codelineno-10-10 id=__codelineno-10-10 name=__codelineno-10-10></a>commit; save; exit
</span><span id=__span-10-11><a href=#__codelineno-10-11 id=__codelineno-10-11 name=__codelineno-10-11></a>
</span><span id=__span-10-12><a href=#__codelineno-10-12 id=__codelineno-10-12 name=__codelineno-10-12></a>show ip multicast mfc
</span><span id=__span-10-13><a href=#__codelineno-10-13 id=__codelineno-10-13 name=__codelineno-10-13></a>show ip multicast interfaces
</span></code></pre></div> <h3 id=setup-vlans-subnets>Setup VLANs / Subnets<a class=headerlink href=#setup-vlans-subnets title="Permanent link">¶</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-11-1><a href=#__codelineno-11-1 id=__codelineno-11-1 name=__codelineno-11-1></a>configure
</span><span id=__span-11-2><a href=#__codelineno-11-2 id=__codelineno-11-2 name=__codelineno-11-2></a>
</span><span id=__span-11-3><a href=#__codelineno-11-3 id=__codelineno-11-3 name=__codelineno-11-3></a>set interfaces switch switch0 vif 1003 address 172.16.1.1/24
</span><span id=__span-11-4><a href=#__codelineno-11-4 id=__codelineno-11-4 name=__codelineno-11-4></a>set interfaces switch switch0 vif 1003 description 'guestwifi.home'
</span><span id=__span-11-5><a href=#__codelineno-11-5 id=__codelineno-11-5 name=__codelineno-11-5></a>set interfaces switch switch0 vif 1003 mtu 1500
</span><span id=__span-11-6><a href=#__codelineno-11-6 id=__codelineno-11-6 name=__codelineno-11-6></a>
</span><span id=__span-11-7><a href=#__codelineno-11-7 id=__codelineno-11-7 name=__codelineno-11-7></a>set interfaces switch switch0 vif 2 address 172.16.2.1/24
</span><span id=__span-11-8><a href=#__codelineno-11-8 id=__codelineno-11-8 name=__codelineno-11-8></a>set interfaces switch switch0 vif 2 description 'printer.home'
</span><span id=__span-11-9><a href=#__codelineno-11-9 id=__codelineno-11-9 name=__codelineno-11-9></a>set interfaces switch switch0 vif 2 mtu 1500
</span><span id=__span-11-10><a href=#__codelineno-11-10 id=__codelineno-11-10 name=__codelineno-11-10></a>
</span><span id=__span-11-11><a href=#__codelineno-11-11 id=__codelineno-11-11 name=__codelineno-11-11></a>set interfaces switch switch0 vif 3 address 172.16.3.1/24
</span><span id=__span-11-12><a href=#__codelineno-11-12 id=__codelineno-11-12 name=__codelineno-11-12></a>set interfaces switch switch0 vif 3 description 'iot.home'
</span><span id=__span-11-13><a href=#__codelineno-11-13 id=__codelineno-11-13 name=__codelineno-11-13></a>set interfaces switch switch0 vif 3 mtu 1500
</span><span id=__span-11-14><a href=#__codelineno-11-14 id=__codelineno-11-14 name=__codelineno-11-14></a>
</span><span id=__span-11-15><a href=#__codelineno-11-15 id=__codelineno-11-15 name=__codelineno-11-15></a>set interfaces switch switch0 vif 4 address 172.16.4.1/24
</span><span id=__span-11-16><a href=#__codelineno-11-16 id=__codelineno-11-16 name=__codelineno-11-16></a>set interfaces switch switch0 vif 4 description 'ha.home'
</span><span id=__span-11-17><a href=#__codelineno-11-17 id=__codelineno-11-17 name=__codelineno-11-17></a>set interfaces switch switch0 vif 4 mtu 1500
</span><span id=__span-11-18><a href=#__codelineno-11-18 id=__codelineno-11-18 name=__codelineno-11-18></a>
</span><span id=__span-11-19><a href=#__codelineno-11-19 id=__codelineno-11-19 name=__codelineno-11-19></a>set interfaces switch switch0 vif 10 address 192.168.10.1/24
</span><span id=__span-11-20><a href=#__codelineno-11-20 id=__codelineno-11-20 name=__codelineno-11-20></a>set interfaces switch switch0 vif 10 description 'mgmt.home'
</span><span id=__span-11-21><a href=#__codelineno-11-21 id=__codelineno-11-21 name=__codelineno-11-21></a>set interfaces switch switch0 vif 10 mtu 1500
</span><span id=__span-11-22><a href=#__codelineno-11-22 id=__codelineno-11-22 name=__codelineno-11-22></a>
</span><span id=__span-11-23><a href=#__codelineno-11-23 id=__codelineno-11-23 name=__codelineno-11-23></a>set interfaces switch switch0 vif 11 address 192.168.11.1/24
</span><span id=__span-11-24><a href=#__codelineno-11-24 id=__codelineno-11-24 name=__codelineno-11-24></a>set interfaces switch switch0 vif 11 description 'wired.home'
</span><span id=__span-11-25><a href=#__codelineno-11-25 id=__codelineno-11-25 name=__codelineno-11-25></a>set interfaces switch switch0 vif 11 mtu 1500
</span><span id=__span-11-26><a href=#__codelineno-11-26 id=__codelineno-11-26 name=__codelineno-11-26></a>
</span><span id=__span-11-27><a href=#__codelineno-11-27 id=__codelineno-11-27 name=__codelineno-11-27></a>set interfaces switch switch0 vif 12 address 192.168.12.1/24
</span><span id=__span-11-28><a href=#__codelineno-11-28 id=__codelineno-11-28 name=__codelineno-11-28></a>set interfaces switch switch0 vif 12 description 'wifi.home'
</span><span id=__span-11-29><a href=#__codelineno-11-29 id=__codelineno-11-29 name=__codelineno-11-29></a>set interfaces switch switch0 vif 12 mtu 1500
</span><span id=__span-11-30><a href=#__codelineno-11-30 id=__codelineno-11-30 name=__codelineno-11-30></a>
</span><span id=__span-11-31><a href=#__codelineno-11-31 id=__codelineno-11-31 name=__codelineno-11-31></a>set interfaces switch switch0 switch-port interface eth1 vlan vid 1003
</span><span id=__span-11-32><a href=#__codelineno-11-32 id=__codelineno-11-32 name=__codelineno-11-32></a>set interfaces switch switch0 switch-port interface eth1 vlan vid 2
</span><span id=__span-11-33><a href=#__codelineno-11-33 id=__codelineno-11-33 name=__codelineno-11-33></a>set interfaces switch switch0 switch-port interface eth1 vlan vid 3 
</span><span id=__span-11-34><a href=#__codelineno-11-34 id=__codelineno-11-34 name=__codelineno-11-34></a>set interfaces switch switch0 switch-port interface eth1 vlan vid 4
</span><span id=__span-11-35><a href=#__codelineno-11-35 id=__codelineno-11-35 name=__codelineno-11-35></a>set interfaces switch switch0 switch-port interface eth1 vlan vid 10
</span><span id=__span-11-36><a href=#__codelineno-11-36 id=__codelineno-11-36 name=__codelineno-11-36></a>set interfaces switch switch0 switch-port interface eth1 vlan vid 11
</span><span id=__span-11-37><a href=#__codelineno-11-37 id=__codelineno-11-37 name=__codelineno-11-37></a>set interfaces switch switch0 switch-port interface eth1 vlan vid 12
</span><span id=__span-11-38><a href=#__codelineno-11-38 id=__codelineno-11-38 name=__codelineno-11-38></a>
</span><span id=__span-11-39><a href=#__codelineno-11-39 id=__codelineno-11-39 name=__codelineno-11-39></a>set service dns forwarding listen-on switch0
</span><span id=__span-11-40><a href=#__codelineno-11-40 id=__codelineno-11-40 name=__codelineno-11-40></a>set service dns forwarding listen-on switch0.1003
</span><span id=__span-11-41><a href=#__codelineno-11-41 id=__codelineno-11-41 name=__codelineno-11-41></a>set service dns forwarding listen-on switch0.2
</span><span id=__span-11-42><a href=#__codelineno-11-42 id=__codelineno-11-42 name=__codelineno-11-42></a>set service dns forwarding listen-on switch0.3
</span><span id=__span-11-43><a href=#__codelineno-11-43 id=__codelineno-11-43 name=__codelineno-11-43></a>set service dns forwarding listen-on switch0.4
</span><span id=__span-11-44><a href=#__codelineno-11-44 id=__codelineno-11-44 name=__codelineno-11-44></a>set service dns forwarding listen-on switch0.10
</span><span id=__span-11-45><a href=#__codelineno-11-45 id=__codelineno-11-45 name=__codelineno-11-45></a>set service dns forwarding listen-on switch0.11
</span><span id=__span-11-46><a href=#__codelineno-11-46 id=__codelineno-11-46 name=__codelineno-11-46></a>set service dns forwarding listen-on switch0.12
</span></code></pre></div> <h3 id=setup-dhcp-servers>Setup DHCP Servers<a class=headerlink href=#setup-dhcp-servers title="Permanent link">¶</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-12-1><a href=#__codelineno-12-1 id=__codelineno-12-1 name=__codelineno-12-1></a>configure
</span><span id=__span-12-2><a href=#__codelineno-12-2 id=__codelineno-12-2 name=__codelineno-12-2></a>
</span><span id=__span-12-3><a href=#__codelineno-12-3 id=__codelineno-12-3 name=__codelineno-12-3></a>set service dhcp-server disabled false
</span><span id=__span-12-4><a href=#__codelineno-12-4 id=__codelineno-12-4 name=__codelineno-12-4></a>set service dhcp-server hostfile-update disable
</span><span id=__span-12-5><a href=#__codelineno-12-5 id=__codelineno-12-5 name=__codelineno-12-5></a>
</span><span id=__span-12-6><a href=#__codelineno-12-6 id=__codelineno-12-6 name=__codelineno-12-6></a>set service dhcp-server shared-network-name guestwifi.home authoritative enable
</span><span id=__span-12-7><a href=#__codelineno-12-7 id=__codelineno-12-7 name=__codelineno-12-7></a>set service dhcp-server shared-network-name guestwifi.home subnet 172.16.1.0/24 default-router 172.16.1.1
</span><span id=__span-12-8><a href=#__codelineno-12-8 id=__codelineno-12-8 name=__codelineno-12-8></a>set service dhcp-server shared-network-name guestwifi.home subnet 172.16.1.0/24 dns-server 172.16.1.1
</span><span id=__span-12-9><a href=#__codelineno-12-9 id=__codelineno-12-9 name=__codelineno-12-9></a>set service dhcp-server shared-network-name guestwifi.home subnet 172.16.1.0/24 domain-name guestwifi.home
</span><span id=__span-12-10><a href=#__codelineno-12-10 id=__codelineno-12-10 name=__codelineno-12-10></a>set service dhcp-server shared-network-name guestwifi.home subnet 172.16.1.0/24 lease 86400
</span><span id=__span-12-11><a href=#__codelineno-12-11 id=__codelineno-12-11 name=__codelineno-12-11></a>set service dhcp-server shared-network-name guestwifi.home subnet 172.16.1.0/24 start 172.16.1.50 stop 172.16.1.200
</span><span id=__span-12-12><a href=#__codelineno-12-12 id=__codelineno-12-12 name=__codelineno-12-12></a>
</span><span id=__span-12-13><a href=#__codelineno-12-13 id=__codelineno-12-13 name=__codelineno-12-13></a>set service dhcp-server shared-network-name printer.home authoritative enable
</span><span id=__span-12-14><a href=#__codelineno-12-14 id=__codelineno-12-14 name=__codelineno-12-14></a>set service dhcp-server shared-network-name printer.home subnet 172.16.2.0/24 default-router 172.16.2.1
</span><span id=__span-12-15><a href=#__codelineno-12-15 id=__codelineno-12-15 name=__codelineno-12-15></a>set service dhcp-server shared-network-name printer.home subnet 172.16.2.0/24 dns-server 172.16.2.1
</span><span id=__span-12-16><a href=#__codelineno-12-16 id=__codelineno-12-16 name=__codelineno-12-16></a>set service dhcp-server shared-network-name printer.home subnet 172.16.2.0/24 domain-name printer.home
</span><span id=__span-12-17><a href=#__codelineno-12-17 id=__codelineno-12-17 name=__codelineno-12-17></a>set service dhcp-server shared-network-name printer.home subnet 172.16.2.0/24 lease 86400
</span><span id=__span-12-18><a href=#__codelineno-12-18 id=__codelineno-12-18 name=__codelineno-12-18></a>set service dhcp-server shared-network-name printer.home subnet 172.16.2.0/24 start 172.16.2.50 stop 172.16.2.200
</span><span id=__span-12-19><a href=#__codelineno-12-19 id=__codelineno-12-19 name=__codelineno-12-19></a>
</span><span id=__span-12-20><a href=#__codelineno-12-20 id=__codelineno-12-20 name=__codelineno-12-20></a>set service dhcp-server shared-network-name iot.home authoritative enable
</span><span id=__span-12-21><a href=#__codelineno-12-21 id=__codelineno-12-21 name=__codelineno-12-21></a>set service dhcp-server shared-network-name iot.home subnet 172.16.3.0/24 default-router 172.16.3.1
</span><span id=__span-12-22><a href=#__codelineno-12-22 id=__codelineno-12-22 name=__codelineno-12-22></a>set service dhcp-server shared-network-name iot.home subnet 172.16.3.0/24 dns-server 172.16.3.1
</span><span id=__span-12-23><a href=#__codelineno-12-23 id=__codelineno-12-23 name=__codelineno-12-23></a>set service dhcp-server shared-network-name iot.home subnet 172.16.3.0/24 domain-name iot.home
</span><span id=__span-12-24><a href=#__codelineno-12-24 id=__codelineno-12-24 name=__codelineno-12-24></a>set service dhcp-server shared-network-name iot.home subnet 172.16.3.0/24 lease 86400
</span><span id=__span-12-25><a href=#__codelineno-12-25 id=__codelineno-12-25 name=__codelineno-12-25></a>set service dhcp-server shared-network-name iot.home subnet 172.16.3.0/24 start 172.16.3.50 stop 172.16.3.200
</span><span id=__span-12-26><a href=#__codelineno-12-26 id=__codelineno-12-26 name=__codelineno-12-26></a>
</span><span id=__span-12-27><a href=#__codelineno-12-27 id=__codelineno-12-27 name=__codelineno-12-27></a>set service dhcp-server shared-network-name ha.home authoritative enable
</span><span id=__span-12-28><a href=#__codelineno-12-28 id=__codelineno-12-28 name=__codelineno-12-28></a>set service dhcp-server shared-network-name ha.home subnet 172.16.4.0/24 default-router 172.16.4.1
</span><span id=__span-12-29><a href=#__codelineno-12-29 id=__codelineno-12-29 name=__codelineno-12-29></a>set service dhcp-server shared-network-name ha.home subnet 172.16.4.0/24 dns-server 172.16.4.1
</span><span id=__span-12-30><a href=#__codelineno-12-30 id=__codelineno-12-30 name=__codelineno-12-30></a>set service dhcp-server shared-network-name ha.home subnet 172.16.4.0/24 domain-name ha.home
</span><span id=__span-12-31><a href=#__codelineno-12-31 id=__codelineno-12-31 name=__codelineno-12-31></a>set service dhcp-server shared-network-name ha.home subnet 172.16.4.0/24 lease 86400
</span><span id=__span-12-32><a href=#__codelineno-12-32 id=__codelineno-12-32 name=__codelineno-12-32></a>set service dhcp-server shared-network-name ha.home subnet 172.16.4.0/24 start 172.16.4.50 stop 172.16.4.200
</span><span id=__span-12-33><a href=#__codelineno-12-33 id=__codelineno-12-33 name=__codelineno-12-33></a>
</span><span id=__span-12-34><a href=#__codelineno-12-34 id=__codelineno-12-34 name=__codelineno-12-34></a>set service dhcp-server shared-network-name native.home authoritative enable
</span><span id=__span-12-35><a href=#__codelineno-12-35 id=__codelineno-12-35 name=__codelineno-12-35></a>set service dhcp-server shared-network-name native.home subnet 192.168.1.0/24 default-router 192.168.1.1
</span><span id=__span-12-36><a href=#__codelineno-12-36 id=__codelineno-12-36 name=__codelineno-12-36></a>set service dhcp-server shared-network-name native.home subnet 192.168.1.0/24 dns-server 192.168.1.1
</span><span id=__span-12-37><a href=#__codelineno-12-37 id=__codelineno-12-37 name=__codelineno-12-37></a>set service dhcp-server shared-network-name native.home subnet 192.168.1.0/24 domain-name native.home
</span><span id=__span-12-38><a href=#__codelineno-12-38 id=__codelineno-12-38 name=__codelineno-12-38></a>set service dhcp-server shared-network-name native.home subnet 192.168.1.0/24 lease 86400
</span><span id=__span-12-39><a href=#__codelineno-12-39 id=__codelineno-12-39 name=__codelineno-12-39></a>set service dhcp-server shared-network-name native.home subnet 192.168.1.0/24 start 192.168.1.50 stop 192.168.1.200
</span><span id=__span-12-40><a href=#__codelineno-12-40 id=__codelineno-12-40 name=__codelineno-12-40></a>
</span><span id=__span-12-41><a href=#__codelineno-12-41 id=__codelineno-12-41 name=__codelineno-12-41></a>set service dhcp-server shared-network-name mgmt.home authoritative enable
</span><span id=__span-12-42><a href=#__codelineno-12-42 id=__codelineno-12-42 name=__codelineno-12-42></a>set service dhcp-server shared-network-name mgmt.home subnet 192.168.10.0/24 default-router 192.168.10.1
</span><span id=__span-12-43><a href=#__codelineno-12-43 id=__codelineno-12-43 name=__codelineno-12-43></a>set service dhcp-server shared-network-name mgmt.home subnet 192.168.10.0/24 dns-server 192.168.10.1
</span><span id=__span-12-44><a href=#__codelineno-12-44 id=__codelineno-12-44 name=__codelineno-12-44></a>set service dhcp-server shared-network-name mgmt.home subnet 192.168.10.0/24 domain-name mgmt.home
</span><span id=__span-12-45><a href=#__codelineno-12-45 id=__codelineno-12-45 name=__codelineno-12-45></a>set service dhcp-server shared-network-name mgmt.home subnet 192.168.10.0/24 lease 86400
</span><span id=__span-12-46><a href=#__codelineno-12-46 id=__codelineno-12-46 name=__codelineno-12-46></a>set service dhcp-server shared-network-name mgmt.home subnet 192.168.10.0/24 start 192.168.10.50 stop 192.168.10.200
</span><span id=__span-12-47><a href=#__codelineno-12-47 id=__codelineno-12-47 name=__codelineno-12-47></a>
</span><span id=__span-12-48><a href=#__codelineno-12-48 id=__codelineno-12-48 name=__codelineno-12-48></a>set service dhcp-server shared-network-name wired.home authoritative enable
</span><span id=__span-12-49><a href=#__codelineno-12-49 id=__codelineno-12-49 name=__codelineno-12-49></a>set service dhcp-server shared-network-name wired.home subnet 192.168.11.0/24 default-router 192.168.11.1
</span><span id=__span-12-50><a href=#__codelineno-12-50 id=__codelineno-12-50 name=__codelineno-12-50></a>set service dhcp-server shared-network-name wired.home subnet 192.168.11.0/24 dns-server 192.168.11.1
</span><span id=__span-12-51><a href=#__codelineno-12-51 id=__codelineno-12-51 name=__codelineno-12-51></a>set service dhcp-server shared-network-name wired.home subnet 192.168.11.0/24 domain-name wired.home
</span><span id=__span-12-52><a href=#__codelineno-12-52 id=__codelineno-12-52 name=__codelineno-12-52></a>set service dhcp-server shared-network-name wired.home subnet 192.168.11.0/24 lease 86400
</span><span id=__span-12-53><a href=#__codelineno-12-53 id=__codelineno-12-53 name=__codelineno-12-53></a>set service dhcp-server shared-network-name wired.home subnet 192.168.11.0/24 start 192.168.11.50 stop 192.168.11.200
</span><span id=__span-12-54><a href=#__codelineno-12-54 id=__codelineno-12-54 name=__codelineno-12-54></a>
</span><span id=__span-12-55><a href=#__codelineno-12-55 id=__codelineno-12-55 name=__codelineno-12-55></a>set service dhcp-server shared-network-name wifi.home authoritative enable
</span><span id=__span-12-56><a href=#__codelineno-12-56 id=__codelineno-12-56 name=__codelineno-12-56></a>set service dhcp-server shared-network-name wifi.home subnet 192.168.12.0/24 default-router 192.168.12.1
</span><span id=__span-12-57><a href=#__codelineno-12-57 id=__codelineno-12-57 name=__codelineno-12-57></a>set service dhcp-server shared-network-name wifi.home subnet 192.168.12.0/24 dns-server 192.168.12.1
</span><span id=__span-12-58><a href=#__codelineno-12-58 id=__codelineno-12-58 name=__codelineno-12-58></a>set service dhcp-server shared-network-name wifi.home subnet 192.168.12.0/24 domain-name wifi.home
</span><span id=__span-12-59><a href=#__codelineno-12-59 id=__codelineno-12-59 name=__codelineno-12-59></a>set service dhcp-server shared-network-name wifi.home subnet 192.168.12.0/24 lease 86400
</span><span id=__span-12-60><a href=#__codelineno-12-60 id=__codelineno-12-60 name=__codelineno-12-60></a>set service dhcp-server shared-network-name wifi.home subnet 192.168.12.0/24 start 192.168.12.50 stop 192.168.12.200
</span><span id=__span-12-61><a href=#__codelineno-12-61 id=__codelineno-12-61 name=__codelineno-12-61></a>
</span><span id=__span-12-62><a href=#__codelineno-12-62 id=__codelineno-12-62 name=__codelineno-12-62></a>set service dhcp-server static-arp disable
</span><span id=__span-12-63><a href=#__codelineno-12-63 id=__codelineno-12-63 name=__codelineno-12-63></a>set service dhcp-server use-dnsmasq enable
</span><span id=__span-12-64><a href=#__codelineno-12-64 id=__codelineno-12-64 name=__codelineno-12-64></a>
</span><span id=__span-12-65><a href=#__codelineno-12-65 id=__codelineno-12-65 name=__codelineno-12-65></a>configure; save; exit
</span></code></pre></div> <h3 id=setup-firewall>Setup Firewall<a class=headerlink href=#setup-firewall title="Permanent link">¶</a></h3> <ul> <li><a href=https://help.ui.com/hc/en-us/articles/204952154-EdgeRouter-Zone-Based-Firewall>https://help.ui.com/hc/en-us/articles/204952154-EdgeRouter-Zone-Based-Firewall</a></li> </ul> <div class="language-text highlight"><pre><span></span><code><span id=__span-13-1><a href=#__codelineno-13-1 id=__codelineno-13-1 name=__codelineno-13-1></a>### CLEANUP
</span><span id=__span-13-2><a href=#__codelineno-13-2 id=__codelineno-13-2 name=__codelineno-13-2></a>
</span><span id=__span-13-3><a href=#__codelineno-13-3 id=__codelineno-13-3 name=__codelineno-13-3></a>configure
</span><span id=__span-13-4><a href=#__codelineno-13-4 id=__codelineno-13-4 name=__codelineno-13-4></a>delete firewall name ALLOW_ALL
</span><span id=__span-13-5><a href=#__codelineno-13-5 id=__codelineno-13-5 name=__codelineno-13-5></a>delete firewall name ALLOW_DNS_DHCP
</span><span id=__span-13-6><a href=#__codelineno-13-6 id=__codelineno-13-6 name=__codelineno-13-6></a>delete firewall name ALLOW_DNS_DHCP_WEB_SSH
</span><span id=__span-13-7><a href=#__codelineno-13-7 id=__codelineno-13-7 name=__codelineno-13-7></a>delete firewall name ALLOW_ESTABLISHED
</span><span id=__span-13-8><a href=#__codelineno-13-8 id=__codelineno-13-8 name=__codelineno-13-8></a>delete firewall name ALLOW_PLEX
</span><span id=__span-13-9><a href=#__codelineno-13-9 id=__codelineno-13-9 name=__codelineno-13-9></a>delete firewall name ALLOW_PLEX_REMOTE
</span><span id=__span-13-10><a href=#__codelineno-13-10 id=__codelineno-13-10 name=__codelineno-13-10></a>delete firewall name ALLOW_WIREGUARD
</span><span id=__span-13-11><a href=#__codelineno-13-11 id=__codelineno-13-11 name=__codelineno-13-11></a>
</span><span id=__span-13-12><a href=#__codelineno-13-12 id=__codelineno-13-12 name=__codelineno-13-12></a>delete firewall name ALLOW_ALL_IPv6
</span><span id=__span-13-13><a href=#__codelineno-13-13 id=__codelineno-13-13 name=__codelineno-13-13></a>delete firewall ipv6-name ALLOW_ALL-IPv6
</span><span id=__span-13-14><a href=#__codelineno-13-14 id=__codelineno-13-14 name=__codelineno-13-14></a>
</span><span id=__span-13-15><a href=#__codelineno-13-15 id=__codelineno-13-15 name=__codelineno-13-15></a>delete firewall ipv6-name ALLOW_ESTABLISHED-IPv6
</span><span id=__span-13-16><a href=#__codelineno-13-16 id=__codelineno-13-16 name=__codelineno-13-16></a>delete firewall ipv6-name ALLOW_ESTABLISHED_IPv6
</span><span id=__span-13-17><a href=#__codelineno-13-17 id=__codelineno-13-17 name=__codelineno-13-17></a>commit;save;exit;
</span><span id=__span-13-18><a href=#__codelineno-13-18 id=__codelineno-13-18 name=__codelineno-13-18></a>show configuration commands | egrep firewall
</span></code></pre></div> <div class="language-text highlight"><pre><span></span><code><span id=__span-14-1><a href=#__codelineno-14-1 id=__codelineno-14-1 name=__codelineno-14-1></a>configure
</span><span id=__span-14-2><a href=#__codelineno-14-2 id=__codelineno-14-2 name=__codelineno-14-2></a>
</span><span id=__span-14-3><a href=#__codelineno-14-3 id=__codelineno-14-3 name=__codelineno-14-3></a>## Reusable rules to allow established connections and drop invalid packets
</span><span id=__span-14-4><a href=#__codelineno-14-4 id=__codelineno-14-4 name=__codelineno-14-4></a># IPv4 rules
</span><span id=__span-14-5><a href=#__codelineno-14-5 id=__codelineno-14-5 name=__codelineno-14-5></a>edit firewall name ALLOW_ESTABLISHED
</span><span id=__span-14-6><a href=#__codelineno-14-6 id=__codelineno-14-6 name=__codelineno-14-6></a>set default-action drop
</span><span id=__span-14-7><a href=#__codelineno-14-7 id=__codelineno-14-7 name=__codelineno-14-7></a>set enable-default-log
</span><span id=__span-14-8><a href=#__codelineno-14-8 id=__codelineno-14-8 name=__codelineno-14-8></a>set rule 1 action accept
</span><span id=__span-14-9><a href=#__codelineno-14-9 id=__codelineno-14-9 name=__codelineno-14-9></a>set rule 1 state established enable
</span><span id=__span-14-10><a href=#__codelineno-14-10 id=__codelineno-14-10 name=__codelineno-14-10></a>set rule 1 state related enable
</span><span id=__span-14-11><a href=#__codelineno-14-11 id=__codelineno-14-11 name=__codelineno-14-11></a>set rule 2 action drop
</span><span id=__span-14-12><a href=#__codelineno-14-12 id=__codelineno-14-12 name=__codelineno-14-12></a>set rule 2 log enable
</span><span id=__span-14-13><a href=#__codelineno-14-13 id=__codelineno-14-13 name=__codelineno-14-13></a>set rule 2 state invalid enable
</span><span id=__span-14-14><a href=#__codelineno-14-14 id=__codelineno-14-14 name=__codelineno-14-14></a>top
</span><span id=__span-14-15><a href=#__codelineno-14-15 id=__codelineno-14-15 name=__codelineno-14-15></a>
</span><span id=__span-14-16><a href=#__codelineno-14-16 id=__codelineno-14-16 name=__codelineno-14-16></a># IPv6 rules (ICMP is required because of how IPv6 works)
</span><span id=__span-14-17><a href=#__codelineno-14-17 id=__codelineno-14-17 name=__codelineno-14-17></a>edit firewall ipv6-name ALLOW_ESTABLISHED_IPv6
</span><span id=__span-14-18><a href=#__codelineno-14-18 id=__codelineno-14-18 name=__codelineno-14-18></a>set default-action drop
</span><span id=__span-14-19><a href=#__codelineno-14-19 id=__codelineno-14-19 name=__codelineno-14-19></a>set enable-default-log
</span><span id=__span-14-20><a href=#__codelineno-14-20 id=__codelineno-14-20 name=__codelineno-14-20></a>set rule 1 action accept
</span><span id=__span-14-21><a href=#__codelineno-14-21 id=__codelineno-14-21 name=__codelineno-14-21></a>set rule 1 state established enable
</span><span id=__span-14-22><a href=#__codelineno-14-22 id=__codelineno-14-22 name=__codelineno-14-22></a>set rule 1 state related enable
</span><span id=__span-14-23><a href=#__codelineno-14-23 id=__codelineno-14-23 name=__codelineno-14-23></a>set rule 2 action drop
</span><span id=__span-14-24><a href=#__codelineno-14-24 id=__codelineno-14-24 name=__codelineno-14-24></a>set rule 2 log enable
</span><span id=__span-14-25><a href=#__codelineno-14-25 id=__codelineno-14-25 name=__codelineno-14-25></a>set rule 2 state invalid enable
</span><span id=__span-14-26><a href=#__codelineno-14-26 id=__codelineno-14-26 name=__codelineno-14-26></a>set rule 100 action accept
</span><span id=__span-14-27><a href=#__codelineno-14-27 id=__codelineno-14-27 name=__codelineno-14-27></a>set rule 100 protocol ipv6-icmp
</span><span id=__span-14-28><a href=#__codelineno-14-28 id=__codelineno-14-28 name=__codelineno-14-28></a>top
</span><span id=__span-14-29><a href=#__codelineno-14-29 id=__codelineno-14-29 name=__codelineno-14-29></a>
</span><span id=__span-14-30><a href=#__codelineno-14-30 id=__codelineno-14-30 name=__codelineno-14-30></a># Allow all connections
</span><span id=__span-14-31><a href=#__codelineno-14-31 id=__codelineno-14-31 name=__codelineno-14-31></a>edit firewall
</span><span id=__span-14-32><a href=#__codelineno-14-32 id=__codelineno-14-32 name=__codelineno-14-32></a>copy name ALLOW_ESTABLISHED to name ALLOW_ALL
</span><span id=__span-14-33><a href=#__codelineno-14-33 id=__codelineno-14-33 name=__codelineno-14-33></a>set name ALLOW_ALL default-action accept
</span><span id=__span-14-34><a href=#__codelineno-14-34 id=__codelineno-14-34 name=__codelineno-14-34></a>delete name ALLOW_ALL enable-default-log
</span><span id=__span-14-35><a href=#__codelineno-14-35 id=__codelineno-14-35 name=__codelineno-14-35></a>top
</span><span id=__span-14-36><a href=#__codelineno-14-36 id=__codelineno-14-36 name=__codelineno-14-36></a>
</span><span id=__span-14-37><a href=#__codelineno-14-37 id=__codelineno-14-37 name=__codelineno-14-37></a>edit firewall
</span><span id=__span-14-38><a href=#__codelineno-14-38 id=__codelineno-14-38 name=__codelineno-14-38></a>copy ipv6-name ALLOW_ESTABLISHED_IPv6 to ipv6-name ALLOW_ALL_IPv6
</span><span id=__span-14-39><a href=#__codelineno-14-39 id=__codelineno-14-39 name=__codelineno-14-39></a>set ipv6-name ALLOW_ALL_IPv6 default-action accept
</span><span id=__span-14-40><a href=#__codelineno-14-40 id=__codelineno-14-40 name=__codelineno-14-40></a>delete ipv6-name ALLOW_ALL_IPv6 enable-default-log
</span><span id=__span-14-41><a href=#__codelineno-14-41 id=__codelineno-14-41 name=__codelineno-14-41></a>top
</span><span id=__span-14-42><a href=#__codelineno-14-42 id=__codelineno-14-42 name=__codelineno-14-42></a>
</span><span id=__span-14-43><a href=#__codelineno-14-43 id=__codelineno-14-43 name=__codelineno-14-43></a>## Allow DNS/DHCP to Local from anywhere
</span><span id=__span-14-44><a href=#__codelineno-14-44 id=__codelineno-14-44 name=__codelineno-14-44></a>edit firewall
</span><span id=__span-14-45><a href=#__codelineno-14-45 id=__codelineno-14-45 name=__codelineno-14-45></a>copy name ALLOW_ESTABLISHED to name ALLOW_DNS_DHCP
</span><span id=__span-14-46><a href=#__codelineno-14-46 id=__codelineno-14-46 name=__codelineno-14-46></a>edit name ALLOW_DNS_DHCP
</span><span id=__span-14-47><a href=#__codelineno-14-47 id=__codelineno-14-47 name=__codelineno-14-47></a>
</span><span id=__span-14-48><a href=#__codelineno-14-48 id=__codelineno-14-48 name=__codelineno-14-48></a>set rule 600 description "Allow DNS"
</span><span id=__span-14-49><a href=#__codelineno-14-49 id=__codelineno-14-49 name=__codelineno-14-49></a>set rule 600 action accept
</span><span id=__span-14-50><a href=#__codelineno-14-50 id=__codelineno-14-50 name=__codelineno-14-50></a>set rule 600 destination port 53
</span><span id=__span-14-51><a href=#__codelineno-14-51 id=__codelineno-14-51 name=__codelineno-14-51></a>set rule 600 protocol tcp_udp
</span><span id=__span-14-52><a href=#__codelineno-14-52 id=__codelineno-14-52 name=__codelineno-14-52></a>
</span><span id=__span-14-53><a href=#__codelineno-14-53 id=__codelineno-14-53 name=__codelineno-14-53></a>set rule 700 description "Allow DHCP"
</span><span id=__span-14-54><a href=#__codelineno-14-54 id=__codelineno-14-54 name=__codelineno-14-54></a>set rule 700 action accept
</span><span id=__span-14-55><a href=#__codelineno-14-55 id=__codelineno-14-55 name=__codelineno-14-55></a>set rule 700 destination port 67,68
</span><span id=__span-14-56><a href=#__codelineno-14-56 id=__codelineno-14-56 name=__codelineno-14-56></a>set rule 700 protocol udp
</span><span id=__span-14-57><a href=#__codelineno-14-57 id=__codelineno-14-57 name=__codelineno-14-57></a>top
</span><span id=__span-14-58><a href=#__codelineno-14-58 id=__codelineno-14-58 name=__codelineno-14-58></a>
</span><span id=__span-14-59><a href=#__codelineno-14-59 id=__codelineno-14-59 name=__codelineno-14-59></a>## Allow Wireguard to Local
</span><span id=__span-14-60><a href=#__codelineno-14-60 id=__codelineno-14-60 name=__codelineno-14-60></a>edit firewall
</span><span id=__span-14-61><a href=#__codelineno-14-61 id=__codelineno-14-61 name=__codelineno-14-61></a>copy name ALLOW_ESTABLISHED to name ALLOW_WIREGUARD
</span><span id=__span-14-62><a href=#__codelineno-14-62 id=__codelineno-14-62 name=__codelineno-14-62></a>edit name ALLOW_WIREGUARD
</span><span id=__span-14-63><a href=#__codelineno-14-63 id=__codelineno-14-63 name=__codelineno-14-63></a>
</span><span id=__span-14-64><a href=#__codelineno-14-64 id=__codelineno-14-64 name=__codelineno-14-64></a>#set firewall name ALLOW_WIREGUARD rule 600 description "Allow Wireguard"
</span><span id=__span-14-65><a href=#__codelineno-14-65 id=__codelineno-14-65 name=__codelineno-14-65></a>
</span><span id=__span-14-66><a href=#__codelineno-14-66 id=__codelineno-14-66 name=__codelineno-14-66></a>set rule 600 description "Allow Wireguard"
</span><span id=__span-14-67><a href=#__codelineno-14-67 id=__codelineno-14-67 name=__codelineno-14-67></a>set rule 600 action accept
</span><span id=__span-14-68><a href=#__codelineno-14-68 id=__codelineno-14-68 name=__codelineno-14-68></a>set rule 600 destination port 51820
</span><span id=__span-14-69><a href=#__codelineno-14-69 id=__codelineno-14-69 name=__codelineno-14-69></a>set rule 600 protocol udp
</span><span id=__span-14-70><a href=#__codelineno-14-70 id=__codelineno-14-70 name=__codelineno-14-70></a>top
</span><span id=__span-14-71><a href=#__codelineno-14-71 id=__codelineno-14-71 name=__codelineno-14-71></a>
</span><span id=__span-14-72><a href=#__codelineno-14-72 id=__codelineno-14-72 name=__codelineno-14-72></a>## Allow guestwifi.home Access to Plex on Monolith
</span><span id=__span-14-73><a href=#__codelineno-14-73 id=__codelineno-14-73 name=__codelineno-14-73></a># - https://support.plex.tv/articles/201543147-what-network-ports-do-i-need-to-allow-through-my-firewall/
</span><span id=__span-14-74><a href=#__codelineno-14-74 id=__codelineno-14-74 name=__codelineno-14-74></a>edit firewall
</span><span id=__span-14-75><a href=#__codelineno-14-75 id=__codelineno-14-75 name=__codelineno-14-75></a>copy name ALLOW_ESTABLISHED to name ALLOW_PLEX
</span><span id=__span-14-76><a href=#__codelineno-14-76 id=__codelineno-14-76 name=__codelineno-14-76></a>edit name ALLOW_PLEX
</span><span id=__span-14-77><a href=#__codelineno-14-77 id=__codelineno-14-77 name=__codelineno-14-77></a>
</span><span id=__span-14-78><a href=#__codelineno-14-78 id=__codelineno-14-78 name=__codelineno-14-78></a>set rule 600 description "Allow Plex TCP"
</span><span id=__span-14-79><a href=#__codelineno-14-79 id=__codelineno-14-79 name=__codelineno-14-79></a>set rule 600 action accept
</span><span id=__span-14-80><a href=#__codelineno-14-80 id=__codelineno-14-80 name=__codelineno-14-80></a>set rule 600 destination port 8324,32400
</span><span id=__span-14-81><a href=#__codelineno-14-81 id=__codelineno-14-81 name=__codelineno-14-81></a>set rule 600 destination address 192.168.11.182
</span><span id=__span-14-82><a href=#__codelineno-14-82 id=__codelineno-14-82 name=__codelineno-14-82></a>set rule 600 protocol tcp
</span><span id=__span-14-83><a href=#__codelineno-14-83 id=__codelineno-14-83 name=__codelineno-14-83></a>
</span><span id=__span-14-84><a href=#__codelineno-14-84 id=__codelineno-14-84 name=__codelineno-14-84></a>set rule 700 description "Allow Plex UDP"
</span><span id=__span-14-85><a href=#__codelineno-14-85 id=__codelineno-14-85 name=__codelineno-14-85></a>set rule 700 action accept
</span><span id=__span-14-86><a href=#__codelineno-14-86 id=__codelineno-14-86 name=__codelineno-14-86></a>set rule 700 destination port 32410,32412,32413,32414 
</span><span id=__span-14-87><a href=#__codelineno-14-87 id=__codelineno-14-87 name=__codelineno-14-87></a>set rule 700 protocol udp
</span><span id=__span-14-88><a href=#__codelineno-14-88 id=__codelineno-14-88 name=__codelineno-14-88></a>top
</span><span id=__span-14-89><a href=#__codelineno-14-89 id=__codelineno-14-89 name=__codelineno-14-89></a>
</span><span id=__span-14-90><a href=#__codelineno-14-90 id=__codelineno-14-90 name=__codelineno-14-90></a>edit firewall
</span><span id=__span-14-91><a href=#__codelineno-14-91 id=__codelineno-14-91 name=__codelineno-14-91></a>copy name ALLOW_ESTABLISHED to name ALLOW_PLEX_REMOTE
</span><span id=__span-14-92><a href=#__codelineno-14-92 id=__codelineno-14-92 name=__codelineno-14-92></a>edit name ALLOW_PLEX_REMOTE
</span><span id=__span-14-93><a href=#__codelineno-14-93 id=__codelineno-14-93 name=__codelineno-14-93></a>
</span><span id=__span-14-94><a href=#__codelineno-14-94 id=__codelineno-14-94 name=__codelineno-14-94></a>set rule 600 description "Allow Plex TCP"
</span><span id=__span-14-95><a href=#__codelineno-14-95 id=__codelineno-14-95 name=__codelineno-14-95></a>set rule 600 action accept
</span><span id=__span-14-96><a href=#__codelineno-14-96 id=__codelineno-14-96 name=__codelineno-14-96></a>set rule 600 destination port 32400
</span><span id=__span-14-97><a href=#__codelineno-14-97 id=__codelineno-14-97 name=__codelineno-14-97></a>set rule 600 destination address 192.168.11.182
</span><span id=__span-14-98><a href=#__codelineno-14-98 id=__codelineno-14-98 name=__codelineno-14-98></a>set rule 600 protocol tcp
</span><span id=__span-14-99><a href=#__codelineno-14-99 id=__codelineno-14-99 name=__codelineno-14-99></a>top
</span><span id=__span-14-100><a href=#__codelineno-14-100 id=__codelineno-14-100 name=__codelineno-14-100></a>
</span><span id=__span-14-101><a href=#__codelineno-14-101 id=__codelineno-14-101 name=__codelineno-14-101></a>## LAN to Local (to router)
</span><span id=__span-14-102><a href=#__codelineno-14-102 id=__codelineno-14-102 name=__codelineno-14-102></a>edit firewall
</span><span id=__span-14-103><a href=#__codelineno-14-103 id=__codelineno-14-103 name=__codelineno-14-103></a>copy name ALLOW_DNS_DHCP to name ALLOW_DNS_DHCP_WEB_SSH
</span><span id=__span-14-104><a href=#__codelineno-14-104 id=__codelineno-14-104 name=__codelineno-14-104></a>edit name ALLOW_DNS_DHCP_WEB_SSH
</span><span id=__span-14-105><a href=#__codelineno-14-105 id=__codelineno-14-105 name=__codelineno-14-105></a>set rule 100 action accept
</span><span id=__span-14-106><a href=#__codelineno-14-106 id=__codelineno-14-106 name=__codelineno-14-106></a>set rule 100 protocol icmp
</span><span id=__span-14-107><a href=#__codelineno-14-107 id=__codelineno-14-107 name=__codelineno-14-107></a>
</span><span id=__span-14-108><a href=#__codelineno-14-108 id=__codelineno-14-108 name=__codelineno-14-108></a>set rule 200 description "Allow HTTP/HTTPS"
</span><span id=__span-14-109><a href=#__codelineno-14-109 id=__codelineno-14-109 name=__codelineno-14-109></a>set rule 200 action accept
</span><span id=__span-14-110><a href=#__codelineno-14-110 id=__codelineno-14-110 name=__codelineno-14-110></a>set rule 200 destination port 80,443
</span><span id=__span-14-111><a href=#__codelineno-14-111 id=__codelineno-14-111 name=__codelineno-14-111></a>set rule 200 protocol tcp
</span><span id=__span-14-112><a href=#__codelineno-14-112 id=__codelineno-14-112 name=__codelineno-14-112></a>
</span><span id=__span-14-113><a href=#__codelineno-14-113 id=__codelineno-14-113 name=__codelineno-14-113></a>set rule 800 description "Allow SSH"
</span><span id=__span-14-114><a href=#__codelineno-14-114 id=__codelineno-14-114 name=__codelineno-14-114></a>set rule 800 action accept
</span><span id=__span-14-115><a href=#__codelineno-14-115 id=__codelineno-14-115 name=__codelineno-14-115></a>set rule 800 destination port 22
</span><span id=__span-14-116><a href=#__codelineno-14-116 id=__codelineno-14-116 name=__codelineno-14-116></a>set rule 800 protocol tcp
</span><span id=__span-14-117><a href=#__codelineno-14-117 id=__codelineno-14-117 name=__codelineno-14-117></a>top
</span><span id=__span-14-118><a href=#__codelineno-14-118 id=__codelineno-14-118 name=__codelineno-14-118></a>commit
</span><span id=__span-14-119><a href=#__codelineno-14-119 id=__codelineno-14-119 name=__codelineno-14-119></a>
</span><span id=__span-14-120><a href=#__codelineno-14-120 id=__codelineno-14-120 name=__codelineno-14-120></a>## Zone Setup
</span><span id=__span-14-121><a href=#__codelineno-14-121 id=__codelineno-14-121 name=__codelineno-14-121></a>
</span><span id=__span-14-122><a href=#__codelineno-14-122 id=__codelineno-14-122 name=__codelineno-14-122></a># Remove existing WAN Rules
</span><span id=__span-14-123><a href=#__codelineno-14-123 id=__codelineno-14-123 name=__codelineno-14-123></a>delete interfaces ethernet eth0 firewall
</span><span id=__span-14-124><a href=#__codelineno-14-124 id=__codelineno-14-124 name=__codelineno-14-124></a>delete firewall name WAN_IN
</span><span id=__span-14-125><a href=#__codelineno-14-125 id=__codelineno-14-125 name=__codelineno-14-125></a>delete firewall name WAN_LOCAL
</span><span id=__span-14-126><a href=#__codelineno-14-126 id=__codelineno-14-126 name=__codelineno-14-126></a>
</span><span id=__span-14-127><a href=#__codelineno-14-127 id=__codelineno-14-127 name=__codelineno-14-127></a># WAN Zone
</span><span id=__span-14-128><a href=#__codelineno-14-128 id=__codelineno-14-128 name=__codelineno-14-128></a>set zone-policy zone wan default-action drop
</span><span id=__span-14-129><a href=#__codelineno-14-129 id=__codelineno-14-129 name=__codelineno-14-129></a>set zone-policy zone wan from local firewall name ALLOW_ALL
</span><span id=__span-14-130><a href=#__codelineno-14-130 id=__codelineno-14-130 name=__codelineno-14-130></a>set zone-policy zone wan from lan firewall name ALLOW_ALL
</span><span id=__span-14-131><a href=#__codelineno-14-131 id=__codelineno-14-131 name=__codelineno-14-131></a>set zone-policy zone wan from guest firewall name ALLOW_ALL
</span><span id=__span-14-132><a href=#__codelineno-14-132 id=__codelineno-14-132 name=__codelineno-14-132></a>set zone-policy zone wan interface eth0
</span><span id=__span-14-133><a href=#__codelineno-14-133 id=__codelineno-14-133 name=__codelineno-14-133></a>
</span><span id=__span-14-134><a href=#__codelineno-14-134 id=__codelineno-14-134 name=__codelineno-14-134></a># LAN Zone
</span><span id=__span-14-135><a href=#__codelineno-14-135 id=__codelineno-14-135 name=__codelineno-14-135></a>set zone-policy zone lan default-action drop
</span><span id=__span-14-136><a href=#__codelineno-14-136 id=__codelineno-14-136 name=__codelineno-14-136></a>set zone-policy zone lan from local firewall name ALLOW_ALL 
</span><span id=__span-14-137><a href=#__codelineno-14-137 id=__codelineno-14-137 name=__codelineno-14-137></a>set zone-policy zone lan from wan firewall name ALLOW_PLEX_REMOTE
</span><span id=__span-14-138><a href=#__codelineno-14-138 id=__codelineno-14-138 name=__codelineno-14-138></a>set zone-policy zone lan from guest firewall name ALLOW_PLEX
</span><span id=__span-14-139><a href=#__codelineno-14-139 id=__codelineno-14-139 name=__codelineno-14-139></a>set zone-policy zone lan from wireguard firewall name ALLOW_ESTABLISHED
</span><span id=__span-14-140><a href=#__codelineno-14-140 id=__codelineno-14-140 name=__codelineno-14-140></a>set zone-policy zone lan interface switch0
</span><span id=__span-14-141><a href=#__codelineno-14-141 id=__codelineno-14-141 name=__codelineno-14-141></a>set zone-policy zone lan interface switch0.10
</span><span id=__span-14-142><a href=#__codelineno-14-142 id=__codelineno-14-142 name=__codelineno-14-142></a>set zone-policy zone lan interface switch0.11
</span><span id=__span-14-143><a href=#__codelineno-14-143 id=__codelineno-14-143 name=__codelineno-14-143></a>set zone-policy zone lan interface switch0.12
</span><span id=__span-14-144><a href=#__codelineno-14-144 id=__codelineno-14-144 name=__codelineno-14-144></a>
</span><span id=__span-14-145><a href=#__codelineno-14-145 id=__codelineno-14-145 name=__codelineno-14-145></a># GUEST Zone
</span><span id=__span-14-146><a href=#__codelineno-14-146 id=__codelineno-14-146 name=__codelineno-14-146></a>set zone-policy zone guest default-action drop
</span><span id=__span-14-147><a href=#__codelineno-14-147 id=__codelineno-14-147 name=__codelineno-14-147></a>set zone-policy zone guest from local firewall name ALLOW_ALL
</span><span id=__span-14-148><a href=#__codelineno-14-148 id=__codelineno-14-148 name=__codelineno-14-148></a>set zone-policy zone guest from wan firewall name ALLOW_ESTABLISHED
</span><span id=__span-14-149><a href=#__codelineno-14-149 id=__codelineno-14-149 name=__codelineno-14-149></a>set zone-policy zone guest from lan firewall name ALLOW_ALL
</span><span id=__span-14-150><a href=#__codelineno-14-150 id=__codelineno-14-150 name=__codelineno-14-150></a>set zone-policy zone guest from untrusted firewall name ALLOW_ESTABLISHED
</span><span id=__span-14-151><a href=#__codelineno-14-151 id=__codelineno-14-151 name=__codelineno-14-151></a>set zone-policy zone guest from wireguard firewall name ALLOW_ALL
</span><span id=__span-14-152><a href=#__codelineno-14-152 id=__codelineno-14-152 name=__codelineno-14-152></a>set zone-policy zone guest interface switch0.4
</span><span id=__span-14-153><a href=#__codelineno-14-153 id=__codelineno-14-153 name=__codelineno-14-153></a>set zone-policy zone guest interface switch0.1003
</span><span id=__span-14-154><a href=#__codelineno-14-154 id=__codelineno-14-154 name=__codelineno-14-154></a>
</span><span id=__span-14-155><a href=#__codelineno-14-155 id=__codelineno-14-155 name=__codelineno-14-155></a># LOCAL Zone (to Router)
</span><span id=__span-14-156><a href=#__codelineno-14-156 id=__codelineno-14-156 name=__codelineno-14-156></a>set zone-policy zone local default-action drop
</span><span id=__span-14-157><a href=#__codelineno-14-157 id=__codelineno-14-157 name=__codelineno-14-157></a>set zone-policy zone local from wan firewall name ALLOW_ESTABLISHED
</span><span id=__span-14-158><a href=#__codelineno-14-158 id=__codelineno-14-158 name=__codelineno-14-158></a>set zone-policy zone local from lan firewall name ALLOW_DNS_DHCP_WEB_SSH
</span><span id=__span-14-159><a href=#__codelineno-14-159 id=__codelineno-14-159 name=__codelineno-14-159></a>set zone-policy zone local from guest firewall name ALLOW_DNS_DHCP
</span><span id=__span-14-160><a href=#__codelineno-14-160 id=__codelineno-14-160 name=__codelineno-14-160></a>set zone-policy zone local from untrusted firewall name ALLOW_DNS_DHCP
</span><span id=__span-14-161><a href=#__codelineno-14-161 id=__codelineno-14-161 name=__codelineno-14-161></a>set zone-policy zone local from wireguard firewall name ALLOW_WIREGUARD
</span><span id=__span-14-162><a href=#__codelineno-14-162 id=__codelineno-14-162 name=__codelineno-14-162></a>set zone-policy zone local local-zone
</span><span id=__span-14-163><a href=#__codelineno-14-163 id=__codelineno-14-163 name=__codelineno-14-163></a>
</span><span id=__span-14-164><a href=#__codelineno-14-164 id=__codelineno-14-164 name=__codelineno-14-164></a># UNTRUSTED Zone
</span><span id=__span-14-165><a href=#__codelineno-14-165 id=__codelineno-14-165 name=__codelineno-14-165></a>set zone-policy zone untrusted default-action drop
</span><span id=__span-14-166><a href=#__codelineno-14-166 id=__codelineno-14-166 name=__codelineno-14-166></a>set zone-policy zone untrusted from lan firewall name ALLOW_ALL
</span><span id=__span-14-167><a href=#__codelineno-14-167 id=__codelineno-14-167 name=__codelineno-14-167></a>set zone-policy zone untrusted from guest firewall name ALLOW_ALL
</span><span id=__span-14-168><a href=#__codelineno-14-168 id=__codelineno-14-168 name=__codelineno-14-168></a>set zone-policy zone untrusted from local firewall name ALLOW_ALL
</span><span id=__span-14-169><a href=#__codelineno-14-169 id=__codelineno-14-169 name=__codelineno-14-169></a>set zone-policy zone untrusted interface switch0.2
</span><span id=__span-14-170><a href=#__codelineno-14-170 id=__codelineno-14-170 name=__codelineno-14-170></a>set zone-policy zone untrusted interface switch0.3
</span><span id=__span-14-171><a href=#__codelineno-14-171 id=__codelineno-14-171 name=__codelineno-14-171></a>
</span><span id=__span-14-172><a href=#__codelineno-14-172 id=__codelineno-14-172 name=__codelineno-14-172></a># WIREGUARD Zone
</span><span id=__span-14-173><a href=#__codelineno-14-173 id=__codelineno-14-173 name=__codelineno-14-173></a>set zone-policy zone wireguard from guest firewall name ALLOW_ALL
</span><span id=__span-14-174><a href=#__codelineno-14-174 id=__codelineno-14-174 name=__codelineno-14-174></a>set zone-policy zone wireguard from lan firewall name ALLOW_ALL
</span><span id=__span-14-175><a href=#__codelineno-14-175 id=__codelineno-14-175 name=__codelineno-14-175></a>set zone-policy zone wireguard from wan firewall name ALLOW_WIREGUARD
</span><span id=__span-14-176><a href=#__codelineno-14-176 id=__codelineno-14-176 name=__codelineno-14-176></a>set zone-policy zone wireguard interface wg0
</span><span id=__span-14-177><a href=#__codelineno-14-177 id=__codelineno-14-177 name=__codelineno-14-177></a>
</span><span id=__span-14-178><a href=#__codelineno-14-178 id=__codelineno-14-178 name=__codelineno-14-178></a>commit; save
</span></code></pre></div> <hr> <h3 id=hardware-offloading>Hardware Offloading<a class=headerlink href=#hardware-offloading title="Permanent link">¶</a></h3> <ul> <li><a href=https://help.ui.com/hc/en-us/articles/115006567467-EdgeRouter-Hardware-Offloading>https://help.ui.com/hc/en-us/articles/115006567467-EdgeRouter-Hardware-Offloading</a></li> </ul> <div class="language-text highlight"><pre><span></span><code><span id=__span-15-1><a href=#__codelineno-15-1 id=__codelineno-15-1 name=__codelineno-15-1></a>configure
</span><span id=__span-15-2><a href=#__codelineno-15-2 id=__codelineno-15-2 name=__codelineno-15-2></a>
</span><span id=__span-15-3><a href=#__codelineno-15-3 id=__codelineno-15-3 name=__codelineno-15-3></a>set system offload hwnat disable
</span><span id=__span-15-4><a href=#__codelineno-15-4 id=__codelineno-15-4 name=__codelineno-15-4></a>set system offload ipsec disable 
</span><span id=__span-15-5><a href=#__codelineno-15-5 id=__codelineno-15-5 name=__codelineno-15-5></a>
</span><span id=__span-15-6><a href=#__codelineno-15-6 id=__codelineno-15-6 name=__codelineno-15-6></a>commit ; save; exit
</span></code></pre></div> <hr> <h2 id=ubiquiti-usw-lite-8-poe-info>Ubiquiti USW-Lite-8-Poe Info<a class=headerlink href=#ubiquiti-usw-lite-8-poe-info title="Permanent link">¶</a></h2> <h3 id=ports>Ports<a class=headerlink href=#ports title="Permanent link">¶</a></h3> <table> <thead> <tr> <th>Port</th> <th>Description</th> <th>VLAN(s)</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>Upstairs Guest Bedroom</td> <td></td> </tr> <tr> <td>2</td> <td>Downstairs Guest Bedroom (Left)</td> <td></td> </tr> <tr> <td>3</td> <td>Kitchen</td> <td></td> </tr> <tr> <td>4</td> <td>Downstairs Guest Bedroom (Right)</td> <td></td> </tr> <tr> <td>5</td> <td>Unknown</td> <td></td> </tr> <tr> <td>6</td> <td>Master Bedroom</td> <td>1003</td> </tr> <tr> <td>7</td> <td>Living Room</td> <td>1003</td> </tr> <tr> <td>8</td> <td>Family Room</td> <td>1003</td> </tr> </tbody> </table> <hr> <h1 id=wireless>Wireless<a class=headerlink href=#wireless title="Permanent link">¶</a></h1> <h2 id=airport-extreme-express>Airport Extreme / Express<a class=headerlink href=#airport-extreme-express title="Permanent link">¶</a></h2> <p>VLAN for Guest Network is 1003</p> <h1 id=unifi-raspberry-pi>UniFi Raspberry Pi<a class=headerlink href=#unifi-raspberry-pi title="Permanent link">¶</a></h1> <p>UniFi Controller is running as a Docker image on a BalenaOS-based Raspberry Pi host.</p> <h2 id=accessing-host>Accessing Host<a class=headerlink href=#accessing-host title="Permanent link">¶</a></h2> <p><code>ssh pi@unifi.home -p 22222</code> </p> <h2 id=docker-admin>Docker Admin<a class=headerlink href=#docker-admin title="Permanent link">¶</a></h2> <p>The image used is: <a href=https://hub.docker.com/r/jacobalberty/unifi>https://hub.docker.com/r/jacobalberty/unifi</a> - Show running containers: <code>balena ps</code> - Update container image: <code>balena pull jacobalberty/unifi</code> </p><div class="language-text highlight"><pre><span></span><code><span id=__span-16-1><a href=#__codelineno-16-1 id=__codelineno-16-1 name=__codelineno-16-1></a>balena stop &lt;container id&gt;
</span><span id=__span-16-2><a href=#__codelineno-16-2 id=__codelineno-16-2 name=__codelineno-16-2></a>balena rm &lt;container id&gt;
</span><span id=__span-16-3><a href=#__codelineno-16-3 id=__codelineno-16-3 name=__codelineno-16-3></a>balena run -d --restart unless-stopped --init -p 8080:8080 -p 8443:8443 -p 3478:3478/udp -e TZ='America/Los_Angeles' -v /mnt/data/unifi:/unifi --name unifi jacobalberty/unifi:latest
</span><span id=__span-16-4><a href=#__codelineno-16-4 id=__codelineno-16-4 name=__codelineno-16-4></a>balena run -d --restart unless-stopped --init -p 8080:8080 -p 8443:8443 -p 3478:3478/udp -e TZ='America/Los_Angeles' -v /mnt/data/unifi:/unifi --name unifi jacobalberty/unifi:latest
</span></code></pre></div> <h1 id=action-plan>Action Plan<a class=headerlink href=#action-plan title="Permanent link">¶</a></h1> <ul> <li>Swap out new core switch</li> <li>Update FreshTomato router to add new subnets</li> <li>Update HA config to separate Supervisor network from main interface network ** <a href=https://github.com/home-assistant/operating-system/blob/dev/Documentation/network.md>https://github.com/home-assistant/operating-system/blob/dev/Documentation/network.md</a></li> <li>Add new antennas to FreshTomato router</li> <li>Move Airport Extreme to Family Room</li> <li>Configure VLANS on FreshTomato router and core switch</li> </ul> <p>netsh wlan show interfaces</p> <h1 id=tutorial>Tutorial<a class=headerlink href=#tutorial title="Permanent link">¶</a></h1> <ul> <li>Navigate to: <a href=https://searchitoperations.techtarget.com/tutorial/Use-Docker-and-Alpine-Linux-to-build-lightweight-containers>https://searchitoperations.techtarget.com/tutorial/Use-Docker-and-Alpine-Linux-to-build-lightweight-containers</a></li> <li>Run <code>docker run -i -t alpine /bin/sh</code> </li> <li>Type <code>ip link add br0 type bridge</code></li> <li>Notice error message</li> <li>Explains how to resolve error: <a href=https://stackoverflow.com/questions/27708376/why-am-i-getting-an-rtnetlink-operation-not-permitted-when-using-pipework-with-d>https://stackoverflow.com/questions/27708376/why-am-i-getting-an-rtnetlink-operation-not-permitted-when-using-pipework-with-d</a></li> <li> <p>Run <code>docker run --cap-add=NET_ADMIN -i -t alpine /bin/sh</code></p> </li> <li> <p>apk add iproute2</p> </li> </ul> <h1 id=understanding-vyatta>Understanding Vyatta<a class=headerlink href=#understanding-vyatta title="Permanent link">¶</a></h1> <p>The OS is based on Debian Jessie.</p> <h1 id=booting>Booting<a class=headerlink href=#booting title="Permanent link">¶</a></h1> <ul> <li><a href=https://docs.vyos.io/en/equuleus/troubleshooting/index.html#boot-steps>https://docs.vyos.io/en/equuleus/troubleshooting/index.html#boot-steps</a></li> </ul> <h1 id=understanding-installed-packages>Understanding Installed Packages<a class=headerlink href=#understanding-installed-packages title="Permanent link">¶</a></h1> <p>The Vyatta configuration system is installed via standard Debian packages.</p> <p></p><div class="language-text highlight"><pre><span></span><code><span id=__span-17-1><a href=#__codelineno-17-1 id=__codelineno-17-1 name=__codelineno-17-1></a>apt search vyatta-cfg
</span><span id=__span-17-2><a href=#__codelineno-17-2 id=__codelineno-17-2 name=__codelineno-17-2></a>dpkg -L vyatta-cfg
</span></code></pre></div> <br> <div class=blogging-tags-grid> <a class=blogging-tag href=https://samrambles.com/tags#home><code>#home</code></a> <a class=blogging-tag href=https://samrambles.com/tags#network><code>#network</code></a> <a class=blogging-tag href=https://samrambles.com/tags#security><code>#security</code></a> <a class=blogging-tag href=https://samrambles.com/tags#edgerouter><code>#edgerouter</code></a> <a class=blogging-tag href=https://samrambles.com/tags#unifi><code>#unifi</code></a> <a class=blogging-tag href=https://samrambles.com/tags#wip><code>#wip</code></a> </div> <style>
    .md-typeset .blogging-tags-grid {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 5px;
    }

    .md-typeset .blogging-tag {
        color: var(--md-typeset-color);
        background-color: var(--md-typeset-code-color);
    }

    .md-typeset .blogging-tag code {
        border-radius: 5px;
    }
</style></div> <hr> <div class=md-source-file> <small> Last update: 2023-03-30 </small> </div> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> </div> <a class="md-top md-icon" data-md-component=top hidden href=#> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg> Back to top </a> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Made with ❤️ by Sam. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ rel=noopener target=_blank> Material for MkDocs </a> </div> <div class=md-social> <a class=md-social__link href=https://github.com/peddamat rel=noopener target=_blank title=github.com> <svg viewbox="0 0 480 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"></path></svg> </a> <a class=md-social__link href=https://twitter.com/peddamat rel=noopener target=_blank title=twitter.com> <svg viewbox="0 0 512 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg> </a> <a class=md-social__link href=https://www.instagram.com/speddamat rel=noopener target=_blank title=www.instagram.com> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"></path></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["announce.dismiss", "header.autohide", "search.share", "search.highlight", "search.suggest", "content.code.copy", "content.code.select", "content.code.annotate", "content.tabs.link", "navigation.tracking", "navigation.top", "navigation.sections", "navigation.tabs", "navigation.indexes"], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.2a6f1dda.min.js></script> <script src=../../../assests/scripts/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": false, "openEffect": "none", "closeEffect": "none", "slideEffect": "none"});})</script></body> </html>