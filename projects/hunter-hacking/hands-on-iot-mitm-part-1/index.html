<!DOCTYPE html><html class=no-js lang=en> <head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content="A third project log entry where we learn how to man-in-the-middle (MitM) an ATWINC1500 SSL/TLS connection, then go whole hog and MitM a secure MQTT connection to an AWS IoT gateway..." name=description><meta content="Sumanth " name=author peddamatham&quot; sam&quot;><link href=https://samrambles.com/projects/hunter-hacking/hands-on-iot-mitm-part-1/index.html rel=canonical><link href=../atwinc1500-iot-module-deep-dive-part-2/index.html rel=prev><link href=../hands-on-iot-mitm-part-2/index.html rel=next><link href=../../../assets/images/favicon.png rel=icon><meta content="mkdocs-1.4.2, mkdocs-material-9.0.15" name=generator><title>Hands On IoT MitM (Part 1) - Sam Rambles</title><link href=../../../assets/stylesheets/main.113286f1.min.css rel=stylesheet><link href=../../../assets/stylesheets/palette.a0c5b2b5.min.css rel=stylesheet><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css?family=Noto+Sans:300,300i,400,400i,700,700i%7CIMB+Plex+Mono:400,400i,700,700i&display=fallback" rel=stylesheet><style>:root{--md-text-font:"Noto Sans";--md-code-font:"IMB Plex Mono"}</style><link href=../../../assets/stylesheets/extra.css rel=stylesheet><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-RZQGZXT3GC"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RZQGZXT3GC');
</script><link href=../../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src=../../../assets/javascripts/glightbox.min.js></script></head> <body data-md-color-accent=white data-md-color-primary=white data-md-color-scheme=white dir=ltr> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox> <input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a class=md-skip href=#hands-on-iot-mitm-part-1> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav aria-label=Header class="md-header__inner md-grid"> <a aria-label="Sam Rambles" class="md-header__button md-logo" data-md-component=logo href=../../../index.html title="Sam Rambles"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Sam Rambles </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Hands On IoT MitM (Part 1) </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input aria-label="Switch to dark mode" class=md-option data-md-color-accent=white data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary=white data-md-color-scheme=white id=__palette_1 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_2 hidden title="Switch to dark mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"></path></svg> </label> <input aria-label="Switch to light mode" class=md-option data-md-color-accent=black data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary=black data-md-color-scheme=slate id=__palette_2 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_1 hidden title="Switch to light mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"></path></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input aria-label=Search autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=Search required spellcheck=false type=text> <label class="md-search__icon md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </label> <nav aria-label=Search class=md-search__options> <a aria-label=Share class="md-search__icon md-icon" data-clipboard data-clipboard-text data-md-component=search-share href=javascript:void(0) tabindex=-1 title=Share> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"></path></svg> </a> <button aria-label=Clear class="md-search__icon md-icon" tabindex=-1 title=Clear type=reset> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a class=md-source data-md-component=source href=https://github.com/peddamat/mkdocs-obsidian title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg> </div> <div class=md-source__repository> peddamat/mkdocs-obsidian </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav aria-label=Tabs class=md-tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a class=md-tabs__link href=../../../index.html> Home </a> </li> <li class=md-tabs__item> <a class=md-tabs__link href=../../../tags/index.html> Tags </a> </li> <li class=md-tabs__item> <a class=md-tabs__link href=../../../guides/index.html> Guides </a> </li> <li class=md-tabs__item> <a class=md-tabs__link href=../../../notes/index.html> Notes </a> </li> <li class=md-tabs__item> <a class="md-tabs__link md-tabs__link--active" href=../../index.html> Projects </a> </li> <li class=md-tabs__item> <a class=md-tabs__link href=../../../assets/templates/blog-entry/index.html> Assets </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label=Navigation class="md-nav md-nav--primary md-nav--lifted" data-md-level=0> <label class=md-nav__title for=__drawer> <a aria-label="Sam Rambles" class="md-nav__button md-logo" data-md-component=logo href=../../../index.html title="Sam Rambles"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg> </a> Sam Rambles </label> <div class=md-nav__source> <a class=md-source data-md-component=source href=https://github.com/peddamat/mkdocs-obsidian title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg> </div> <div class=md-source__repository> peddamat/mkdocs-obsidian </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../index.html> Home </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../tags/index.html> Tags </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../guides/index.html>Guides</a> <label for=__nav_3> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded=false aria-labelledby=__nav_3_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../guides/how-to-size-a-solar-battery-install/index.html> How To Size A Solar Battery Install </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_3 type=checkbox> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex=0> Dotfiles <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_3_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Dotfiles </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../guides/dotfiles/debugging-a-mkdocs-plugin/index.html> Making An MkDocs Plugin </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../guides/dotfiles/how-i-setup-this-blog/index.html> How I Setup This Blog </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../guides/dotfiles/how-to-quickly-setup-a-wireless-mitm-proxy/index.html> How To Quickly Setup A Wireless MitM Proxy </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_4 type=checkbox> <label class=md-nav__link for=__nav_3_4 id=__nav_3_4_label tabindex=0> Fancy Zones <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_4_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Fancy Zones </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../guides/fancy-zones/fancy-zones-internals/index.html> Fancy Zones Internals </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../guides/fancy-zones/fancy-zones-overview/index.html> Fancy Zones Overview </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_5 type=checkbox> <label class=md-nav__link for=__nav_3_5 id=__nav_3_5_label tabindex=0> Window Hacking With Rust <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_5_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Window Hacking With Rust </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../guides/window-hacking-with-rust/creating-a-dll-with-rust/index.html> Creating A DLL With Rust </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../guides/window-hacking-with-rust/creating-a-window-with-rust/index.html> Creating A Window With Rust </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../guides/window-hacking-with-rust/injecting-dlls-with-rust/index.html> Injecting DLLs With Rust </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../guides/window-hacking-with-rust/production-ready-dll-injection/index.html> Production Ready DLL Injection </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_4 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../notes/index.html>Notes</a> <label for=__nav_4> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded=false aria-labelledby=__nav_4_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Notes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/modern-debugging-tools-for-windows/index.html> Modern Debugging Tools For Windows </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_4_3 type=checkbox> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> Cheatsheets <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_4_3_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Cheatsheets </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/cheatsheets/git-cheatsheet/index.html> Git Cheatsheet </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/cheatsheets/rsync-cheatsheet/index.html> Rsync Cheatsheet </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/cheatsheets/tls-cheatsheet/index.html> TLS Cheatsheet </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_4_4 type=checkbox> <label class=md-nav__link for=__nav_4_4 id=__nav_4_4_label tabindex=0> Debug Probes <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_4_4_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> Debug Probes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/debug-probes/black-magic-probe/index.html> Black Magic Probe </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/debug-probes/segger-j-link/index.html> Segger J-Link </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_4_5 type=checkbox> <label class=md-nav__link for=__nav_4_5 id=__nav_4_5_label tabindex=0> Development Kits <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_4_5_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_4_5> <span class="md-nav__icon md-icon"></span> Development Kits </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/development-kits/adafruit-feather-m0-wifi/index.html> Adafruit Feather M0 WiFi </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/development-kits/esp32/index.html> ESP32 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/development-kits/raspberry-pi/index.html> Raspberry Pi </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_4_5_4 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../../notes/development-kits/esp8266/index.html>ESP8266</a> <label for=__nav_4_5_4> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded=false aria-labelledby=__nav_4_5_4_label class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_4_5_4> <span class="md-nav__icon md-icon"></span> ESP8266 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/development-kits/esp8266/esp-01/index.html> ESP-01 </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/development-kits/esp8266/wemos-mini/index.html> Wemos Mini </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_4_5_5 type=checkbox> <label class=md-nav__link for=__nav_4_5_5 id=__nav_4_5_5_label tabindex=0> STM32 <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_4_5_5_label class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_4_5_5> <span class="md-nav__icon md-icon"></span> STM32 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/development-kits/stm32/black-pill/index.html> Black Pill </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/development-kits/stm32/itead-maple/index.html> ITead Maple </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../../notes/development-kits/stm32/super-blue-pill/index.html> Super Blue Pill </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" id=__nav_5 type=checkbox> <div class="md-nav__link md-nav__link--index"> <a href=../../index.html>Projects</a> <label for=__nav_5> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded=true aria-labelledby=__nav_5_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Projects </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../introducing-sensie/index.html> Introducing Sensie </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../serialmoose-serial-port-sniffer/index.html> SerialMoose Serial Port Sniffer </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_5_4 type=checkbox> <label class=md-nav__link for=__nav_5_4 id=__nav_5_4_label tabindex=0> Home Assistant <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_5_4_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_5_4> <span class="md-nav__icon md-icon"></span> Home Assistant </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../home-assistant/my-smart-home-devices/index.html> My Smart Home Devices </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../../home-assistant/samsung-refrigerator-integration/index.html> Samsung Refrigerator Integration </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" id=__nav_5_5 type=checkbox> <label class=md-nav__link for=__nav_5_5 id=__nav_5_5_label tabindex=0> Hunter Hacking <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=true aria-labelledby=__nav_5_5_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_5_5> <span class="md-nav__icon md-icon"></span> Hunter Hacking </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../a-look-inside-a-hunter-pro-hc-controller/index.html> A Look Inside A Hunter Pro-HC Controller </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../atwinc1500-iot-module-deep-dive-part-1/index.html> ATWINC1500 IoT Module Deep-Dive (Part 1) </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../atwinc1500-iot-module-deep-dive-part-2/index.html> ATWINC1500 IoT Module Deep-Dive (Part 2) </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" id=__toc type=checkbox> <label class="md-nav__link md-nav__link--active" for=__toc> Hands On IoT MitM (Part 1) <span class="md-nav__icon md-icon"></span> </label> <a class="md-nav__link md-nav__link--active" href=index.html> Hands On IoT MitM (Part 1) </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#the-basics> The Basics </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#1-basic-ssl-connection> 1. Basic SSL Connection </a> <nav aria-label="1. Basic SSL Connection" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#troubleshooting> Troubleshooting </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#2-mitmd-ssl-connection> 2. MitM'd SSL Connection </a> <nav aria-label="2. MitM'd SSL Connection" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#upload-sketch> Upload Sketch </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#installing-mitmproxy-root-certificate> Installing mitmproxy Root Certificate </a> <nav aria-label="Installing mitmproxy Root Certificate" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#1-upload-serial-bridge> 1. Upload Serial Bridge </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#2-obtain-certificate> 2. Obtain Certificate </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#3-write-certificate> 3. Write Certificate </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#re-upload-sketch> Re-Upload Sketch </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#troubleshooting_1> Troubleshooting </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#3-basic-mqtts-connection> 3. Basic MQTTS Connection </a> <nav aria-label="3. Basic MQTTS Connection" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#aws-iot-setup> AWS IoT Setup </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#testing> Testing </a> <nav aria-label=Testing class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#connection-kit> Connection Kit </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#mqtt-explorer> MQTT Explorer </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#iot-device-setup> IoT Device Setup </a> <nav aria-label="IoT Device Setup" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#write-certificates> Write Certificates </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#upload-sketch_1> Upload Sketch </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#next-steps> Next Steps </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#troubleshooting_2> Troubleshooting </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#links> Links </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=../hands-on-iot-mitm-part-2/index.html> Hands On IoT MitM (Part 2) </a> </li> <li class=md-nav__item> <a class=md-nav__link href=../reverse-engineering-the-hunter-pro-hc-controller/index.html> Reverse Engineering The Hunter Pro-HC Controller </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_6 type=checkbox> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> Assets <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_6_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Assets </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_6_1 type=checkbox> <label class=md-nav__link for=__nav_6_1 id=__nav_6_1_label tabindex=0> Templates <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_6_1_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_6_1> <span class="md-nav__icon md-icon"></span> Templates </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../assets/templates/blog-entry/index.html> Blog entry </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#the-basics> The Basics </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#1-basic-ssl-connection> 1. Basic SSL Connection </a> <nav aria-label="1. Basic SSL Connection" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#troubleshooting> Troubleshooting </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#2-mitmd-ssl-connection> 2. MitM'd SSL Connection </a> <nav aria-label="2. MitM'd SSL Connection" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#upload-sketch> Upload Sketch </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#installing-mitmproxy-root-certificate> Installing mitmproxy Root Certificate </a> <nav aria-label="Installing mitmproxy Root Certificate" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#1-upload-serial-bridge> 1. Upload Serial Bridge </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#2-obtain-certificate> 2. Obtain Certificate </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#3-write-certificate> 3. Write Certificate </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#re-upload-sketch> Re-Upload Sketch </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#troubleshooting_1> Troubleshooting </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#3-basic-mqtts-connection> 3. Basic MQTTS Connection </a> <nav aria-label="3. Basic MQTTS Connection" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#aws-iot-setup> AWS IoT Setup </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#testing> Testing </a> <nav aria-label=Testing class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#connection-kit> Connection Kit </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#mqtt-explorer> MQTT Explorer </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#iot-device-setup> IoT Device Setup </a> <nav aria-label="IoT Device Setup" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#write-certificates> Write Certificates </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#upload-sketch_1> Upload Sketch </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#next-steps> Next Steps </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#troubleshooting_2> Troubleshooting </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#links> Links </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <nav class=md-tags> <a class=md-tag href=../../../tags/index.html#microchip>microchip</a> <a class=md-tag href=../../../tags/index.html#firmware>firmware</a> <a class=md-tag href=../../../tags/index.html#analysis>analysis</a> <a class=md-tag href=../../../tags/index.html#iot>iot</a> <a class=md-tag href=../../../tags/index.html#mitm>mitm</a> </nav> <div><h1 id=hands-on-iot-mitm-part-1>Hands On IoT MitM (Part 1)<a class=headerlink href=#hands-on-iot-mitm-part-1 title="Permanent link">¶</a></h1> <p><em>This is the third article in the <a href=../a-look-inside-a-hunter-pro-hc-controller/index.html>Hunter Hacking</a> Project.</em></p> <p>In <a href=../../../guides/dotfiles/how-to-quickly-setup-a-wireless-mitm-proxy/index.html>How To Quickly Setup A Wireless MitM Proxy</a>, I discussed how to setup a "Man In The Middle" (MitM) proxy using Kali Linux, but <em>what is</em> a man-in-the-middle proxy? What are they used for?</p> <p>In this article we'll explore MitM proxies using Kali Linux and an Adafruit Feather M0 WiFi module.</p> <h2 id=the-basics>The Basics<a class=headerlink href=#the-basics title="Permanent link">¶</a></h2> <p>A man-in-the-middle (MITM) proxy is an application or device that intercepts communication between two parties and can eavesdrop, modify, or block data transmission.</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/man-in-the-middle-attack.png><img alt=man-in-the-middle-attack.png src=../../../assets/images/man-in-the-middle-attack.png width=500></a></p> <p>In the early days of the internet, before the <a href=https://letsencrypt.org/ >Let's Encrypt </a> revolution, it was ridiculously easy to insert yourself in between one computer and another: <a href=https://en.wikipedia.org/wiki/Cain_and_Abel_(software)>Cain and Abel</a>, <a href=https://www.ettercap-project.org/ >ettercap</a>, <a href=https://etherape.sourceforge.io/ >etherape</a>...</p> <p>Mainly for <a href=https://null-byte.wonderhowto.com/how-to/hacking-pranks-flip-photos-change-images-inject-messages-into-friends-browsers-your-wi-fi-network-0180303/ >lulz</a>, but probably for some nefarious stuff, as well.</p> <p>Nowadays, unless you're "<em>leet</em>", it's basically impossible to "sniff" a random TLS-secured connection, <em>unless</em>... you have root on one of the devices.</p> <p>To better understand things, we're going to examine a few scenarios.</p> <p>Our intention is to understand what is required to intercept traffic between an ATWINC1500-based IoT device and an AWS IoT MQTT endpoint:</p> <ol> <li> <p>Basic SSL Connection</p> <p>By establishing a basic SSL connection, we confirm that our network is configured correctly to allow the microcontroller (uC) to connect to google.com over port 443. We also confirm that the Root Cert Store on the uC contains a Root CA certificate which trusts Google's certificate****.</p> </li> <li> <p>MitM'd SSL Connection</p> <p>Establishing an SSL connection through <code>mitmproxy</code> allows us to understand what happens when an SSL connection is man-in-the-middle'd. Learning how to get things working helps us understand the role that the Root Cert Store plays in the ATWINC1500.</p> </li> <li> <p>Basic MQTTS Connection</p> <p>This scenario allows us to understand how to get AWS IoT configured as an MQTT endpoint. In addition, we learn how how to write TLS certificates to the ATWINC1500.</p> </li> <li> <p>MitM'd MQTTS Connection</p> <p>This final scenario allows us to understand how insert a... ...</p> </li> </ol> <p>For all of these tests, we'll be using an <a href=https://www.adafruit.com/product/3010>Adafruit Feather M0</a> module.</p> <hr> <h2 id=1-basic-ssl-connection>1. Basic SSL Connection<a class=headerlink href=#1-basic-ssl-connection title="Permanent link">¶</a></h2> <p>The Arduino WiFi101 Library includes the <code>WifiSSLClient</code> example, which simply connects to an access point and retrieves the <code>google.com</code> homepages and prints it to the serial terminal.</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230321155605.png><img alt="Pasted image 20230321155605.png" src=../../../assets/images/pasted-image-20230321155605.png width=600></a></p> <p>We can use this example out-of-the-box, with one change. Add the following to your <code>setup()</code>:</p> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-0-1><a href=#__codelineno-0-1 id=__codelineno-0-1 name=__codelineno-0-1></a><span class=kt>void</span><span class=w> </span><span class=nf>setup</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-0-2><a href=#__codelineno-0-2 id=__codelineno-0-2 name=__codelineno-0-2></a><span class=w>  </span><span class=n>WiFi</span><span class=p>.</span><span class=n>setPins</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=w> </span><span class=mi>7</span><span class=p>,</span><span class=w> </span><span class=mi>4</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>);</span>
</span><span id=__span-0-3><a href=#__codelineno-0-3 id=__codelineno-0-3 name=__codelineno-0-3></a><span class=p>...</span><span class=w> </span>
</span></code></pre></div> <p>After uploading the sketch to you should see the following:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230321161513.png><img alt="Pasted image 20230321161513.png" src=../../../assets/images/pasted-image-20230321161513.png width=500></a></p> <h3 id=troubleshooting>Troubleshooting<a class=headerlink href=#troubleshooting title="Permanent link">¶</a></h3> <div class="admonition info"> <p class=admonition-title>Didn't work?</p> <p>Try adding the <code>google.com</code> certificate to your ATWINC1500 by following the instructions here: <a href=../atwinc1500-iot-module-deep-dive-part-1/index.html#uploading-ssl-root-certificates>ATWINC1500 IoT Module Deep-Dive (Part 1)Uploading SSL Root Certificates</a>.</p> </div> <hr> <h2 id=2-mitmd-ssl-connection>2. MitM'd SSL Connection<a class=headerlink href=#2-mitmd-ssl-connection title="Permanent link">¶</a></h2> <p>Now let's run the same example through a transparent proxy, using <code>mitmproxy</code>. </p> <p>I'm going to setup my proxy, using the instructions here: <a href=../../../guides/dotfiles/how-to-quickly-setup-a-wireless-mitm-proxy/index.html#start-transparent-mitm-proxy>How To Quickly Setup A Wireless MitM ProxyStart Transparent MitM Proxy</a>)</p> <h3 id=upload-sketch>Upload Sketch<a class=headerlink href=#upload-sketch title="Permanent link">¶</a></h3> <p>Update the <code>WifiSSLClient</code> sketch so that it connects to your proxy and re-run the sketch:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230321171146.png><img alt="Pasted image 20230321171146.png" src=../../../assets/images/pasted-image-20230321171146.png width=500></a></p> <p>Hrm... </p> <p>Checking the <code>mitmproxy</code> logs we see the following:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-1-1><a href=#__codelineno-1-1 id=__codelineno-1-1 name=__codelineno-1-1></a><span class=m>192</span>.168.1.22:60689:<span class=w> </span>client<span class=w> </span>connect
</span><span id=__span-1-2><a href=#__codelineno-1-2 id=__codelineno-1-2 name=__codelineno-1-2></a><span class=m>192</span>.168.1.22:60689:<span class=w> </span>server<span class=w> </span>connect<span class=w> </span><span class=m>17</span>.248.180.49:443
</span><span id=__span-1-3><a href=#__codelineno-1-3 id=__codelineno-1-3 name=__codelineno-1-3></a><span class=m>192</span>.168.1.22:60689:<span class=w> </span>Client<span class=w> </span>TLS<span class=w> </span>handshake<span class=w> </span>failed.<span class=w> </span>Client<span class=w> </span>and<span class=w> </span>mitmproxy<span class=w> </span>cannot<span class=w> </span>agree<span class=w> </span>on<span class=w> </span>a<span class=w> </span>TLS<span class=w> </span>version<span class=w> </span>to<span class=w> </span>use.<span class=w> </span>You<span class=w> </span>may<span class=w> </span>need<span class=w> </span>to<span class=w> </span>adjust<span class=w> </span>mitmproxy<span class=s1>'s tls_version_client_min option.</span>
</span><span id=__span-1-4><a href=#__codelineno-1-4 id=__codelineno-1-4 name=__codelineno-1-4></a><span class=s1>192.168.1.22:60689: client disconnect</span>
</span><span id=__span-1-5><a href=#__codelineno-1-5 id=__codelineno-1-5 name=__codelineno-1-5></a><span class=s1>192.168.1.22:60689: server disconnect 17.248.180.49:443</span>
</span><span id=__span-1-6><a href=#__codelineno-1-6 id=__codelineno-1-6 name=__codelineno-1-6></a><span class=s1>192.168.1.3:62014: client connect</span>
</span><span id=__span-1-7><a href=#__codelineno-1-7 id=__codelineno-1-7 name=__codelineno-1-7></a><span class=s1>192.168.1.3:62014: server connect 142.250.68.68:443</span>
</span><span id=__span-1-8><a href=#__codelineno-1-8 id=__codelineno-1-8 name=__codelineno-1-8></a><span class=hll><span class=s1>192.168.1.3:62014: Client TLS handshake failed. The client disconnected during the handshake. If this happens consistently for www.google.com, this may indicate that the client does not trust the proxy'</span>s<span class=w> </span>certificate.
</span></span><span id=__span-1-9><a href=#__codelineno-1-9 id=__codelineno-1-9 name=__codelineno-1-9></a><span class=m>192</span>.168.1.3:62014:<span class=w> </span>client<span class=w> </span>disconnect
</span><span id=__span-1-10><a href=#__codelineno-1-10 id=__codelineno-1-10 name=__codelineno-1-10></a><span class=m>192</span>.168.1.3:62014:<span class=w> </span>server<span class=w> </span>disconnect<span class=w> </span><span class=m>142</span>.250.68.68:443
</span><span id=__span-1-11><a href=#__codelineno-1-11 id=__codelineno-1-11 name=__codelineno-1-11></a>...
</span></code></pre></div> <p>This line is of particular interest:</p> <blockquote> <p>Client TLS handshake failed. The client disconnected during the handshake. If this happens consistently for <a href=http://www.google.com>www.google.com</a>, this may indicate that the client does not trust the proxy's certificate.</p> </blockquote> <p><code>mitmproxy</code> is hinting that something similar to this is happening within the microcontroller's network stack causing the connection to be aborted:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230324184127.png><img alt="Pasted image 20230324184127.png" src=../../../assets/images/pasted-image-20230324184127.png width=300></a></p> <p>If you recall from <a href=../../../guides/dotfiles/how-to-quickly-setup-a-wireless-mitm-proxy/index.html>How To Quickly Setup A Wireless MitM Proxy</a>, the above error occurs when we haven't installed the <code>mitmproxy</code> root certificate.</p> <p>Let's test this hypothesis by installing the <code>mitmproxy</code> root certificate.</p> <h3 id=installing-mitmproxy-root-certificate>Installing mitmproxy Root Certificate<a class=headerlink href=#installing-mitmproxy-root-certificate title="Permanent link">¶</a></h3> <h4 id=1-upload-serial-bridge>1. Upload Serial Bridge<a class=headerlink href=#1-upload-serial-bridge title="Permanent link">¶</a></h4> <p>First, we need to install the <a href=../atwinc1500-iot-module-deep-dive-part-2/index.html#serial-bridge-arduino-portpeddamatserialbridge>ATWINC1500 IoT Module Deep-Dive (Part 2)Serial Bridge Arduino Port|peddamat/SerialBridge</a> so <code>atwinc1500_fwtool.exe</code> can talk directly to the ATWINC1500 module over USB.</p> <h4 id=2-obtain-certificate>2. Obtain Certificate<a class=headerlink href=#2-obtain-certificate title="Permanent link">¶</a></h4> <p>You'll need a copy of the <code>mitmproxy</code> certificate, which you can grab by connecting to <code>bumper_mitm</code> on your phone and downloading the cert in <code>.cer</code> format.</p> <p>Place the certificate in a directory named "certs".</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-2-1><a href=#__codelineno-2-1 id=__codelineno-2-1 name=__codelineno-2-1></a>$<span class=w> </span>tree
</span><span id=__span-2-2><a href=#__codelineno-2-2 id=__codelineno-2-2 name=__codelineno-2-2></a>.
</span><span id=__span-2-3><a href=#__codelineno-2-3 id=__codelineno-2-3 name=__codelineno-2-3></a>├──<span class=w> </span>Interm
</span><span id=__span-2-4><a href=#__codelineno-2-4 id=__codelineno-2-4 name=__codelineno-2-4></a>...
</span><span id=__span-2-5><a href=#__codelineno-2-5 id=__codelineno-2-5 name=__codelineno-2-5></a>├──<span class=w> </span>atwinc1500_fwtool.exe
</span><span id=__span-2-6><a href=#__codelineno-2-6 id=__codelineno-2-6 name=__codelineno-2-6></a>├──<span class=w> </span>atwinc1500_fwtool.pdb
</span><span id=__span-2-7><a href=#__codelineno-2-7 id=__codelineno-2-7 name=__codelineno-2-7></a>└──<span class=w> </span>certs
</span><span id=__span-2-8><a href=#__codelineno-2-8 id=__codelineno-2-8 name=__codelineno-2-8></a><span class=w>    </span>└──<span class=w> </span>mitmproxy-ca-cert.cer
</span></code></pre></div> <h4 id=3-write-certificate>3. Write Certificate<a class=headerlink href=#3-write-certificate title="Permanent link">¶</a></h4> <p>To reduce any confounding variables, let's first erase both stores on our ATWINC1500.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-3-1><a href=#__codelineno-3-1 id=__codelineno-3-1 name=__codelineno-3-1></a>$<span class=w> </span>atwinc1500_fwtool.exe<span class=w> </span>erase<span class=w> </span>--root
</span><span id=__span-3-2><a href=#__codelineno-3-2 id=__codelineno-3-2 name=__codelineno-3-2></a>
</span><span id=__span-3-3><a href=#__codelineno-3-3 id=__codelineno-3-3 name=__codelineno-3-3></a>Erasing<span class=w> </span>device...
</span><span id=__span-3-4><a href=#__codelineno-3-4 id=__codelineno-3-4 name=__codelineno-3-4></a>Root<span class=w> </span>Certificate<span class=w> </span>Store<span class=w> </span>Updated<span class=w> </span>Successfully<span class=w> </span>On:<span class=w> </span>Flash
</span></code></pre></div> <p>Confirming:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-4-1><a href=#__codelineno-4-1 id=__codelineno-4-1 name=__codelineno-4-1></a>$ atwinc1500_fwtool.exe read
</span><span id=__span-4-2><a href=#__codelineno-4-2 id=__codelineno-4-2 name=__codelineno-4-2></a>
</span><span id=__span-4-3><a href=#__codelineno-4-3 id=__codelineno-4-3 name=__codelineno-4-3></a>Dumping Root Cert Store contents...
</span><span id=__span-4-4><a href=#__codelineno-4-4 id=__codelineno-4-4 name=__codelineno-4-4></a>Root Certificate Store Loaded Successfully From: Flash
</span><span id=__span-4-5><a href=#__codelineno-4-5 id=__codelineno-4-5 name=__codelineno-4-5></a>- Found 0 entries!
</span><span id=__span-4-6><a href=#__codelineno-4-6 id=__codelineno-4-6 name=__codelineno-4-6></a>...
</span></code></pre></div> <p>Now we let's add the cert to the Root Cert Store:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-5-1><a href=#__codelineno-5-1 id=__codelineno-5-1 name=__codelineno-5-1></a>$<span class=w> </span>atwinc1500_fwtool.exe<span class=w> </span>update<span class=w> </span>--root<span class=w> </span>--ca_dir<span class=w> </span>certs
</span><span id=__span-5-2><a href=#__codelineno-5-2 id=__codelineno-5-2 name=__codelineno-5-2></a>
</span><span id=__span-5-3><a href=#__codelineno-5-3 id=__codelineno-5-3 name=__codelineno-5-3></a>Root<span class=w> </span>Certificate<span class=w> </span>Store<span class=w> </span>Loaded<span class=w> </span>Successfully<span class=w> </span>From:<span class=w> </span>Flash
</span><span id=__span-5-4><a href=#__codelineno-5-4 id=__codelineno-5-4 name=__codelineno-5-4></a>
</span><span id=__span-5-5><a href=#__codelineno-5-5 id=__codelineno-5-5 name=__codelineno-5-5></a>&gt;&gt;&gt;Found<span class=w> </span>Certificate:
</span><span id=__span-5-6><a href=#__codelineno-5-6 id=__codelineno-5-6 name=__codelineno-5-6></a>&gt;&gt;&gt;<span class=w>     </span>mitmproxy
</span><span id=__span-5-7><a href=#__codelineno-5-7 id=__codelineno-5-7 name=__codelineno-5-7></a>Root<span class=w> </span>Certificate<span class=w> </span>Store<span class=w> </span>Updated<span class=w> </span>Successfully<span class=w> </span>On:<span class=w> </span>Flash
</span></code></pre></div> <p>Confirming:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-6-1><a href=#__codelineno-6-1 id=__codelineno-6-1 name=__codelineno-6-1></a>$ atwinc1500_fwtool.exe read
</span><span id=__span-6-2><a href=#__codelineno-6-2 id=__codelineno-6-2 name=__codelineno-6-2></a>
</span><span id=__span-6-3><a href=#__codelineno-6-3 id=__codelineno-6-3 name=__codelineno-6-3></a>Dumping Root Cert Store contents...
</span><span id=__span-6-4><a href=#__codelineno-6-4 id=__codelineno-6-4 name=__codelineno-6-4></a>Root Certificate Store Loaded Successfully From: Flash
</span><span id=__span-6-5><a href=#__codelineno-6-5 id=__codelineno-6-5 name=__codelineno-6-5></a>- Found 1 entries!
</span><span id=__span-6-6><a href=#__codelineno-6-6 id=__codelineno-6-6 name=__codelineno-6-6></a>  Name Hash (SHA1): 14 65 65 22 40 7A D1 30 64 06 9E 87 AD BB C5 31 7D 37 94 FF   Certificate 1: RSA
</span><span id=__span-6-7><a href=#__codelineno-6-7 id=__codelineno-6-7 name=__codelineno-6-7></a>  &lt;2023-03-19 20:00:22&gt; to &lt;2033-03-18 20:00:22&gt;
</span></code></pre></div> <h3 id=re-upload-sketch>Re-Upload Sketch<a class=headerlink href=#re-upload-sketch title="Permanent link">¶</a></h3> <p>Re-uploading the Sketch and checking the serial monitor yields in: </p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230323034716.png><img alt="Pasted image 20230323034716.png" src=../../../assets/images/pasted-image-20230323034716.png width=500></a> <strong>BOOM!!!</strong></p> <h3 id=troubleshooting_1>Troubleshooting<a class=headerlink href=#troubleshooting_1 title="Permanent link">¶</a></h3> <details class=info> <summary>Trouble connecting to your Adafruit Feather M0?</summary> <p>Check to make sure your VMWare Player isn't intercepting the USB device connection request:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../.trash/Pasted%20image%2020230321171217.png><img alt="Pasted image 20230321171217.png" src=../../.trash/Pasted%20image%2020230321171217.png width=400></a></p> </details> <hr> <h2 id=3-basic-mqtts-connection>3. Basic MQTTS Connection<a class=headerlink href=#3-basic-mqtts-connection title="Permanent link">¶</a></h2> <p>Now that we have a handle of the basics, let's model something more realistic, a scenario where our Adafruit Feather M0 is an IoT device which communicates with an AWS IoT MQTT endpoint.</p> <p>Before we get started, it's worth spending a moment talking about <a href=https://docs.aws.amazon.com/iot/latest/developerguide/transport-security.html>mutual TLS</a>.</p> <p>TODO: Tighten up verbiage</p> <p>Mutual TLS (mTLS) differs from the TLS we've previously done, in that it's a protocol that allows a mutual exchange of keys during session initiation.</p> <p>What this means is that the "IoT Device" has its own unique public/private key pair, which essentially serves as a username and password when it connects to AWS IoT.</p> <p>This means... </p> <h3 id=aws-iot-setup>AWS IoT Setup<a class=headerlink href=#aws-iot-setup title="Permanent link">¶</a></h3> <p>First, you'll need to create an AWS account by heading over to: <a href=https://aws.amazon.com/ >aws.amazon.com</a></p> <p>Next, scroll down and click the "Connect an IoT device" link under "Build a solution".</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230323051616.png><img alt="Pasted image 20230323051616.png" src=../../../assets/images/pasted-image-20230323051616.png></a></p> <p>This will bring up a "Prepare your device" wizard:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230323051904.png><img alt="Pasted image 20230323051904.png" src=../../../assets/images/pasted-image-20230323051904.png></a></p> <p>Scroll down and click <strong>Next</strong>:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230323052017.png><img alt="Pasted image 20230323052017.png" src=../../../assets/images/pasted-image-20230323052017.png></a></p> <p>Under "Thing properties" enter "feathermitm":</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230323052205.png><img alt="Pasted image 20230323052205.png" src=../../../assets/images/pasted-image-20230323052205.png width=500></a></p> <p>and click <strong>Next</strong>:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230323052308.png><img alt="Pasted image 20230323052308.png" src=../../../assets/images/pasted-image-20230323052308.png></a></p> <p>Select "Python" and click <strong>Next</strong>:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230323054804.png><img alt="Pasted image 20230323054804.png" src=../../../assets/images/pasted-image-20230323054804.png></a></p> <p>Click <strong>Download connection kit</strong> and click <strong>Next</strong>:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230323054910.png><img alt="Pasted image 20230323054910.png" src=../../../assets/images/pasted-image-20230323054910.png></a></p> <p>Finish by clicking <strong>View thing</strong>:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230323053002.png><img alt="Pasted image 20230323053002.png" src=../../../assets/images/pasted-image-20230323053002.png></a></p> <hr> <h3 id=testing>Testing<a class=headerlink href=#testing title="Permanent link">¶</a></h3> <h4 id=connection-kit>Connection Kit<a class=headerlink href=#connection-kit title="Permanent link">¶</a></h4> <p>Unzip <code>connect_device_package.zip</code>: </p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-7-1><a href=#__codelineno-7-1 id=__codelineno-7-1 name=__codelineno-7-1></a>$<span class=w> </span>tree
</span><span id=__span-7-2><a href=#__codelineno-7-2 id=__codelineno-7-2 name=__codelineno-7-2></a>.
</span><span id=__span-7-3><a href=#__codelineno-7-3 id=__codelineno-7-3 name=__codelineno-7-3></a>├──<span class=w> </span>feathermitm-Policy
</span><span id=__span-7-4><a href=#__codelineno-7-4 id=__codelineno-7-4 name=__codelineno-7-4></a>├──<span class=w> </span>feathermitm.cert.pem
</span><span id=__span-7-5><a href=#__codelineno-7-5 id=__codelineno-7-5 name=__codelineno-7-5></a>├──<span class=w> </span>feathermitm.private.key
</span><span id=__span-7-6><a href=#__codelineno-7-6 id=__codelineno-7-6 name=__codelineno-7-6></a>├──<span class=w> </span>feathermitm.public.key
</span><span id=__span-7-7><a href=#__codelineno-7-7 id=__codelineno-7-7 name=__codelineno-7-7></a>└──<span class=w> </span>start.sh
</span></code></pre></div> <p>and run <code>start.sh</code> in a WSL terminal:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-8-1><a href=#__codelineno-8-1 id=__codelineno-8-1 name=__codelineno-8-1></a>$<span class=w> </span>./start.sh
</span><span id=__span-8-2><a href=#__codelineno-8-2 id=__codelineno-8-2 name=__codelineno-8-2></a>...
</span><span id=__span-8-3><a href=#__codelineno-8-3 id=__codelineno-8-3 name=__codelineno-8-3></a>Running<span class=w> </span>pub/sub<span class=w> </span>sample<span class=w> </span>application...
</span><span id=__span-8-4><a href=#__codelineno-8-4 id=__codelineno-8-4 name=__codelineno-8-4></a>Connecting<span class=w> </span>to<span class=w> </span>xxx.amazonaws.com<span class=w> </span>with<span class=w> </span>client<span class=w> </span>ID<span class=w> </span><span class=s1>'basicPubSub'</span>...
</span><span id=__span-8-5><a href=#__codelineno-8-5 id=__codelineno-8-5 name=__codelineno-8-5></a>Connected!
</span><span id=__span-8-6><a href=#__codelineno-8-6 id=__codelineno-8-6 name=__codelineno-8-6></a>Subscribing<span class=w> </span>to<span class=w> </span>topic<span class=w> </span><span class=s1>'sdk/test/python'</span>...
</span><span id=__span-8-7><a href=#__codelineno-8-7 id=__codelineno-8-7 name=__codelineno-8-7></a>Subscribed<span class=w> </span>with<span class=w> </span>QoS.AT_LEAST_ONCE
</span><span id=__span-8-8><a href=#__codelineno-8-8 id=__codelineno-8-8 name=__codelineno-8-8></a>Sending<span class=w> </span>messages<span class=w> </span><span class=k>until</span><span class=w> </span>program<span class=w> </span>killed
</span><span id=__span-8-9><a href=#__codelineno-8-9 id=__codelineno-8-9 name=__codelineno-8-9></a>Publishing<span class=w> </span>message<span class=w> </span>to<span class=w> </span>topic<span class=w> </span><span class=s1>'sdk/test/python'</span>:<span class=w> </span>Hello<span class=w> </span>World!<span class=w> </span><span class=o>[</span><span class=m>1</span><span class=o>]</span>
</span><span id=__span-8-10><a href=#__codelineno-8-10 id=__codelineno-8-10 name=__codelineno-8-10></a>Received<span class=w> </span>message<span class=w> </span>from<span class=w> </span>topic<span class=w> </span><span class=s1>'sdk/test/python'</span>:<span class=w> </span>b<span class=s1>'"Hello World! [1]"'</span>
</span></code></pre></div> <p>We can see the messages show up in the "MQTT test client" section:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230323054417.png><img alt="Pasted image 20230323054417.png" src=../../../assets/images/pasted-image-20230323054417.png width=500></a></p> <hr> <h4 id=mqtt-explorer>MQTT Explorer<a class=headerlink href=#mqtt-explorer title="Permanent link">¶</a></h4> <p>Since we're going to be in MQTT-world for a while, it's worth getting a hang of <a href=http://mqtt-explorer.com/ >MQTT Explorer</a>, a tool which lets us <em>pub</em> and <em>sub</em> MQTT endpoints:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230323060157.png><img alt="Pasted image 20230323060157.png" src=../../../assets/images/pasted-image-20230323060157.png></a></p> <p>Grab the connection settings from <code>start.sh</code>, populate the host name and port, and then click <strong>Advanced</strong>:</p> <div class="language-bash highlight"><span class=filename>start.sh</span><pre><span></span><code><span id=__span-9-1><a href=#__codelineno-9-1 id=__codelineno-9-1 name=__codelineno-9-1></a><span class=ch>#!/usr/bin/env bash</span>
</span><span id=__span-9-2><a href=#__codelineno-9-2 id=__codelineno-9-2 name=__codelineno-9-2></a>...
</span><span id=__span-9-3><a href=#__codelineno-9-3 id=__codelineno-9-3 name=__codelineno-9-3></a><span class=c1># run pub/sub sample app using certificates downloaded in package</span>
</span><span id=__span-9-4><a href=#__codelineno-9-4 id=__codelineno-9-4 name=__codelineno-9-4></a><span class=nb>printf</span><span class=w> </span><span class=s2>"\nRunning pub/sub sample application...\n"</span>
</span><span id=__span-9-5><a href=#__codelineno-9-5 id=__codelineno-9-5 name=__codelineno-9-5></a><span class=hll>python3<span class=w> </span>aws-iot-device-sdk-python-v2/samples/pubsub.py<span class=w> </span>--endpoint<span class=w> </span>xxx.iot.amazonaws.com<span class=w> </span>--ca_file<span class=w> </span>root-CA.crt<span class=w> </span>--cert<span class=w> </span>feathermitm.cert.pem<span class=w> </span>--key<span class=w> </span>feathermitm.private.key<span class=w> </span>--client_id<span class=w> </span>basicPubSub<span class=w> </span>--topic<span class=w> </span>sdk/test/python<span class=w> </span>--count<span class=w> </span><span class=m>0</span>
</span></span></code></pre></div> <p>Set the "MQTT Client ID" to "basicPubSub" and click <strong>Certificates</strong>:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230323060415.png><img alt="Pasted image 20230323060415.png" src=../../../assets/images/pasted-image-20230323060415.png></a></p> <p>Populate the entries with the contents of the <code>connect_device_package</code> folder as shown, and click <strong>Back</strong> (twice):</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230323060516.png><img alt="Pasted image 20230323060516.png" src=../../../assets/images/pasted-image-20230323060516.png></a></p> <p>NOW <strong>CLICK SAVE</strong>!!!</p> <p>Then click on "MQTT test client" in the AWS IoT sidebar, enter <code>sdk/test/python</code> in the Topic filter, and click <strong>Subscribe</strong>:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230323061209.png><img alt="Pasted image 20230323061209.png" src=../../../assets/images/pasted-image-20230323061209.png></a></p> <p>Back in MQTT Explorer, click "Connect", enter "sdk/test/python" in the Topic, add a message and click <strong>Publish</strong>:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-10-1><a href=#__codelineno-10-1 id=__codelineno-10-1 name=__codelineno-10-1></a>{
</span><span id=__span-10-2><a href=#__codelineno-10-2 id=__codelineno-10-2 name=__codelineno-10-2></a>  "message": "Hello from MQTT Explorer!"
</span><span id=__span-10-3><a href=#__codelineno-10-3 id=__codelineno-10-3 name=__codelineno-10-3></a>}
</span></code></pre></div> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230323061012.png><img alt="Pasted image 20230323061012.png" src=../../../assets/images/pasted-image-20230323061012.png></a></p> <p>Back in "MQTT test client", you should see your message!</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230323061238.png><img alt="Pasted image 20230323061238.png" src=../../../assets/images/pasted-image-20230323061238.png></a></p> <hr> <h3 id=iot-device-setup>IoT Device Setup<a class=headerlink href=#iot-device-setup title="Permanent link">¶</a></h3> <p>Now that we've setup and tested our AWS IoT gateway, let's prepare our "IoT device".</p> <p>Unlike <code>mitmproxy</code>, IOXY requires some certificate configuration work to get things working.</p> <h4 id=write-certificates>Write Certificates<a class=headerlink href=#write-certificates title="Permanent link">¶</a></h4> <p>For the mTLS handshake to work, we're going to need to upload the private key and cert to the ATWINC1500 TLS Server Store and Amazon's RootCA cert to its Root Cert Store.</p> <p>Start by renaming <code>root-CA.crt</code> to <code>root-CA.cer</code>:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230323093544.png><img alt="Pasted image 20230323093544.png" src=../../../assets/images/pasted-image-20230323093544.png></a></p> <p>Then upload the device's private key and certificate to the TLS Server Store:</p> <div class="language-bash highlight"><span class=filename>Update TLS Server Store</span><pre><span></span><code><span id=__span-11-1><a href=#__codelineno-11-1 id=__codelineno-11-1 name=__codelineno-11-1></a>$<span class=w> </span>atwinc1500_fwtool.exe<span class=w> </span>update<span class=w> </span><span class=se>\</span>
</span><span id=__span-11-2><a href=#__codelineno-11-2 id=__codelineno-11-2 name=__codelineno-11-2></a><span class=w>    </span>--tls<span class=w> </span><span class=se>\</span>
</span><span id=__span-11-3><a href=#__codelineno-11-3 id=__codelineno-11-3 name=__codelineno-11-3></a><span class=w>    </span>--key<span class=w> </span>connect_device_package<span class=se>\f</span>eathermitm.private.key<span class=w> </span><span class=se>\</span>
</span><span id=__span-11-4><a href=#__codelineno-11-4 id=__codelineno-11-4 name=__codelineno-11-4></a><span class=w>    </span>--cert<span class=w> </span>connect_device_package<span class=se>\f</span>eathermitm.cert.pem
</span><span id=__span-11-5><a href=#__codelineno-11-5 id=__codelineno-11-5 name=__codelineno-11-5></a>
</span><span id=__span-11-6><a href=#__codelineno-11-6 id=__codelineno-11-6 name=__codelineno-11-6></a>TLS<span class=w> </span>Certificate<span class=w> </span>Store<span class=w> </span>Loaded<span class=w> </span>Successfully<span class=w> </span>From:<span class=w> </span>Flash
</span><span id=__span-11-7><a href=#__codelineno-11-7 id=__codelineno-11-7 name=__codelineno-11-7></a>TLS<span class=w> </span>Certificate<span class=w> </span>Store<span class=w> </span>Updated<span class=w> </span>Successfully<span class=w> </span>On:<span class=w> </span>Flash
</span></code></pre></div> <p>Now upload the Amazon Root CA certificate to the Root Cert Store:</p> <div class="language-bash highlight"><span class=filename>Update Root Cert Store</span><pre><span></span><code><span id=__span-12-1><a href=#__codelineno-12-1 id=__codelineno-12-1 name=__codelineno-12-1></a>$<span class=w> </span>atwinc1500_fwtool.exe<span class=w> </span>update<span class=w> </span>--root<span class=w> </span>--ca_dir<span class=w> </span>connect_device_package
</span><span id=__span-12-2><a href=#__codelineno-12-2 id=__codelineno-12-2 name=__codelineno-12-2></a>
</span><span id=__span-12-3><a href=#__codelineno-12-3 id=__codelineno-12-3 name=__codelineno-12-3></a>Root<span class=w> </span>Certificate<span class=w> </span>Store<span class=w> </span>Loaded<span class=w> </span>Successfully<span class=w> </span>From:<span class=w> </span>Flash
</span><span id=__span-12-4><a href=#__codelineno-12-4 id=__codelineno-12-4 name=__codelineno-12-4></a>
</span><span id=__span-12-5><a href=#__codelineno-12-5 id=__codelineno-12-5 name=__codelineno-12-5></a>&gt;&gt;&gt;Found<span class=w> </span>Certificate:
</span><span id=__span-12-6><a href=#__codelineno-12-6 id=__codelineno-12-6 name=__codelineno-12-6></a>&gt;&gt;&gt;<span class=w>     </span>Amazon<span class=w> </span>Root<span class=w> </span>CA<span class=w> </span><span class=m>1</span>
</span><span id=__span-12-7><a href=#__codelineno-12-7 id=__codelineno-12-7 name=__codelineno-12-7></a>Root<span class=w> </span>Certificate<span class=w> </span>Store<span class=w> </span>Updated<span class=w> </span>Successfully<span class=w> </span>On:<span class=w> </span>Flash
</span></code></pre></div> <p>Verifying:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-13-1><a href=#__codelineno-13-1 id=__codelineno-13-1 name=__codelineno-13-1></a>$<span class=w> </span>atwinc1500_fwtool.exe<span class=w> </span><span class=nb>read</span>
</span><span id=__span-13-2><a href=#__codelineno-13-2 id=__codelineno-13-2 name=__codelineno-13-2></a>
</span><span id=__span-13-3><a href=#__codelineno-13-3 id=__codelineno-13-3 name=__codelineno-13-3></a>Dumping<span class=w> </span>TLS<span class=w> </span>Store<span class=w> </span>contents...
</span><span id=__span-13-4><a href=#__codelineno-13-4 id=__codelineno-13-4 name=__codelineno-13-4></a>TLS<span class=w> </span>Certificate<span class=w> </span>Store<span class=w> </span>Loaded<span class=w> </span>Successfully<span class=w> </span>From:<span class=w> </span>Flash
</span><span id=__span-13-5><a href=#__codelineno-13-5 id=__codelineno-13-5 name=__codelineno-13-5></a>Found<span class=w> </span><span class=m>3</span><span class=w> </span>entries...
</span><span id=__span-13-6><a href=#__codelineno-13-6 id=__codelineno-13-6 name=__codelineno-13-6></a>-<span class=w> </span>RSA<span class=w> </span>Certificate<span class=w> </span>Chain<span class=w> </span>File<span class=w> </span>List
</span><span id=__span-13-7><a href=#__codelineno-13-7 id=__codelineno-13-7 name=__codelineno-13-7></a><span class=w>  </span>NAME<span class=w>                                             </span>SIZE<span class=w> </span>TYPE<span class=w>         </span>INFO
</span><span id=__span-13-8><a href=#__codelineno-13-8 id=__codelineno-13-8 name=__codelineno-13-8></a><span class=w>  </span>PRIV_62a1f32e421df7f65e2290155189f76dbd6953bd<span class=w>    </span><span class=m>1208</span><span class=w> </span>PRIVATE<span class=w> </span>KEY
</span><span id=__span-13-9><a href=#__codelineno-13-9 id=__codelineno-13-9 name=__codelineno-13-9></a><span class=w>  </span>CERT_62a1f32e421df7f65e2290155189f76dbd6953bd<span class=w>     </span><span class=m>861</span><span class=w> </span>CERTIFICATE<span class=w>  </span>AWS<span class=w> </span>IoT<span class=w> </span>Certificate
</span><span id=__span-13-10><a href=#__codelineno-13-10 id=__codelineno-13-10 name=__codelineno-13-10></a>-<span class=w> </span>Private<span class=w> </span>Key<span class=w> </span>Details:
</span><span id=__span-13-11><a href=#__codelineno-13-11 id=__codelineno-13-11 name=__codelineno-13-11></a><span class=w>  </span>Modulus<span class=w> </span><span class=o>(</span>N<span class=o>)</span><span class=w> </span>:<span class=o>(</span>00B7440C<span class=o>)(</span><span class=m>256</span><span class=o>)</span>
</span><span id=__span-13-12><a href=#__codelineno-13-12 id=__codelineno-13-12 name=__codelineno-13-12></a><span class=w>        </span>A9<span class=w> </span><span class=m>34</span><span class=w> </span>C5<span class=w> </span>DD<span class=w> </span>7F<span class=w> </span><span class=m>50</span><span class=w> </span>C2<span class=w> </span><span class=m>23</span><span class=w> </span><span class=m>90</span><span class=w> </span>AA<span class=w> </span><span class=m>85</span><span class=w> </span>5B<span class=w> </span>DA<span class=w> </span>EC<span class=w> </span><span class=m>23</span><span class=w> </span><span class=m>80</span>
</span><span id=__span-13-13><a href=#__codelineno-13-13 id=__codelineno-13-13 name=__codelineno-13-13></a><span class=w>        </span><span class=m>09</span><span class=w> </span>AB<span class=w> </span>E7<span class=w> </span>B8<span class=w> </span>1E<span class=w> </span>1F<span class=w> </span><span class=m>66</span><span class=w> </span>1C<span class=w> </span><span class=m>37</span><span class=w> </span>9E<span class=w> </span>3A<span class=w> </span><span class=m>28</span><span class=w> </span>BB<span class=w> </span>9D<span class=w> </span><span class=m>07</span><span class=w> </span>6C
</span><span id=__span-13-14><a href=#__codelineno-13-14 id=__codelineno-13-14 name=__codelineno-13-14></a><span class=w>        </span>AE<span class=w> </span>D9<span class=w> </span><span class=m>50</span><span class=w> </span>5C<span class=w> </span><span class=m>45</span><span class=w> </span>D8<span class=w> </span>F1<span class=w> </span>5A<span class=w> </span><span class=m>09</span><span class=w> </span>4A<span class=w> </span><span class=m>44</span><span class=w> </span>A1<span class=w> </span><span class=m>56</span><span class=w> </span>1F<span class=w> </span>A6<span class=w> </span><span class=m>41</span>
</span><span id=__span-13-15><a href=#__codelineno-13-15 id=__codelineno-13-15 name=__codelineno-13-15></a><span class=w>        </span>4C<span class=w> </span>B4<span class=w> </span><span class=m>20</span><span class=w> </span>2D<span class=w> </span>D9<span class=w> </span>0F<span class=w> </span><span class=m>78</span><span class=w> </span><span class=m>68</span><span class=w> </span>E7<span class=w> </span>6E<span class=w> </span><span class=m>11</span><span class=w> </span><span class=m>61</span><span class=w> </span><span class=m>94</span><span class=w> </span><span class=m>54</span><span class=w> </span><span class=m>70</span><span class=w> </span><span class=m>13</span>
</span><span id=__span-13-16><a href=#__codelineno-13-16 id=__codelineno-13-16 name=__codelineno-13-16></a><span class=w>        </span>DF<span class=w> </span>A0<span class=w> </span><span class=m>86</span><span class=w> </span><span class=m>38</span><span class=w> </span>BC<span class=w> </span>0F<span class=w> </span>9E<span class=w> </span><span class=m>09</span><span class=w> </span>B0<span class=w> </span><span class=m>04</span><span class=w> </span><span class=m>39</span><span class=w> </span><span class=m>53</span><span class=w> </span>F2<span class=w> </span><span class=m>29</span><span class=w> </span><span class=m>35</span><span class=w> </span>BF
</span><span id=__span-13-17><a href=#__codelineno-13-17 id=__codelineno-13-17 name=__codelineno-13-17></a><span class=w>        </span>8E<span class=w> </span>FA<span class=w> </span><span class=m>19</span><span class=w> </span><span class=m>97</span><span class=w> </span><span class=m>86</span><span class=w> </span><span class=m>40</span><span class=w> </span><span class=m>74</span><span class=w> </span>3C<span class=w> </span><span class=m>20</span><span class=w> </span><span class=m>79</span><span class=w> </span>B9<span class=w> </span>0F<span class=w> </span>2A<span class=w> </span>1E<span class=w> </span>7A<span class=w> </span><span class=m>01</span>
</span><span id=__span-13-18><a href=#__codelineno-13-18 id=__codelineno-13-18 name=__codelineno-13-18></a><span class=w>        </span>F5<span class=w> </span><span class=m>55</span><span class=w> </span>C2<span class=w> </span>BB<span class=w> </span>CE<span class=w> </span>F6<span class=w> </span>7A<span class=w> </span>AA<span class=w> </span><span class=m>14</span><span class=w> </span><span class=m>48</span><span class=w> </span>BB<span class=w> </span><span class=m>77</span><span class=w> </span><span class=m>92</span><span class=w> </span>AB<span class=w> </span>0E<span class=w> </span>6D
</span><span id=__span-13-19><a href=#__codelineno-13-19 id=__codelineno-13-19 name=__codelineno-13-19></a><span class=w>        </span>C2<span class=w> </span>FE<span class=w> </span>6C<span class=w> </span><span class=m>62</span><span class=w> </span>F6<span class=w> </span>DD<span class=w> </span><span class=m>76</span><span class=w> </span><span class=m>90</span><span class=w> </span><span class=m>63</span><span class=w> </span><span class=m>40</span><span class=w> </span>C8<span class=w> </span><span class=m>58</span><span class=w> </span>2F<span class=w> </span>4F<span class=w> </span>D6<span class=w> </span>B1
</span><span id=__span-13-20><a href=#__codelineno-13-20 id=__codelineno-13-20 name=__codelineno-13-20></a><span class=w>        </span><span class=m>87</span><span class=w> </span><span class=m>09</span><span class=w> </span>CF<span class=w> </span>C7<span class=w> </span><span class=m>40</span><span class=w> </span><span class=m>34</span><span class=w> </span><span class=m>24</span><span class=w> </span>E7<span class=w> </span><span class=m>26</span><span class=w> </span>C1<span class=w> </span>BB<span class=w> </span><span class=m>29</span><span class=w> </span>F5<span class=w> </span><span class=m>45</span><span class=w> </span>C1<span class=w> </span>7D
</span><span id=__span-13-21><a href=#__codelineno-13-21 id=__codelineno-13-21 name=__codelineno-13-21></a><span class=w>        </span><span class=m>75</span><span class=w> </span>4D<span class=w> </span><span class=m>79</span><span class=w> </span>4A<span class=w> </span>C0<span class=w> </span>F7<span class=w> </span><span class=m>78</span><span class=w> </span>FA<span class=w> </span>EA<span class=w> </span>7F<span class=w> </span>3F<span class=w> </span><span class=m>44</span><span class=w> </span>DA<span class=w> </span>F8<span class=w> </span>BE<span class=w> </span>D0
</span><span id=__span-13-22><a href=#__codelineno-13-22 id=__codelineno-13-22 name=__codelineno-13-22></a><span class=w>        </span><span class=m>17</span><span class=w> </span>3D<span class=w> </span>9E<span class=w> </span>FF<span class=w> </span>0C<span class=w> </span>BF<span class=w> </span>F9<span class=w> </span>B6<span class=w> </span>C4<span class=w> </span><span class=m>06</span><span class=w> </span>5F<span class=w> </span><span class=m>12</span><span class=w> </span><span class=m>88</span><span class=w> </span>7C<span class=w> </span>C2<span class=w> </span>9F
</span><span id=__span-13-23><a href=#__codelineno-13-23 id=__codelineno-13-23 name=__codelineno-13-23></a><span class=w>        </span>B8<span class=w> </span><span class=m>82</span><span class=w> </span>D3<span class=w> </span>E2<span class=w> </span><span class=m>21</span><span class=w> </span>A9<span class=w> </span><span class=m>73</span><span class=w> </span><span class=m>72</span><span class=w> </span>AC<span class=w> </span><span class=m>09</span><span class=w> </span>9B<span class=w> </span>2B<span class=w> </span>4F<span class=w> </span><span class=m>91</span><span class=w> </span>8A<span class=w> </span>2D
</span><span id=__span-13-24><a href=#__codelineno-13-24 id=__codelineno-13-24 name=__codelineno-13-24></a><span class=w>        </span>E6<span class=w> </span>5F<span class=w> </span>A0<span class=w> </span><span class=m>83</span><span class=w> </span><span class=m>73</span><span class=w> </span><span class=m>82</span><span class=w> </span><span class=m>56</span><span class=w> </span>5D<span class=w> </span>4E<span class=w> </span>6C<span class=w> </span><span class=m>85</span><span class=w> </span>A9<span class=w> </span><span class=m>43</span><span class=w> </span><span class=m>87</span><span class=w> </span><span class=m>74</span><span class=w> </span><span class=m>81</span>
</span><span id=__span-13-25><a href=#__codelineno-13-25 id=__codelineno-13-25 name=__codelineno-13-25></a><span class=w>        </span>2A<span class=w> </span>B3<span class=w> </span><span class=m>47</span><span class=w> </span>D5<span class=w> </span>E2<span class=w> </span><span class=m>18</span><span class=w> </span>F8<span class=w> </span><span class=m>39</span><span class=w> </span>FC<span class=w> </span><span class=m>66</span><span class=w> </span>1A<span class=w> </span>5B<span class=w> </span>D2<span class=w> </span>C4<span class=w> </span><span class=m>06</span><span class=w> </span><span class=m>24</span>
</span><span id=__span-13-26><a href=#__codelineno-13-26 id=__codelineno-13-26 name=__codelineno-13-26></a><span class=w>        </span>CC<span class=w> </span>4C<span class=w> </span>0E<span class=w> </span>BF<span class=w> </span><span class=m>49</span><span class=w> </span>2A<span class=w> </span><span class=m>90</span><span class=w> </span>3D<span class=w> </span>0F<span class=w> </span><span class=m>47</span><span class=w> </span><span class=m>12</span><span class=w> </span><span class=m>16</span><span class=w> </span><span class=m>52</span><span class=w> </span>F0<span class=w> </span>5E<span class=w> </span>B7
</span><span id=__span-13-27><a href=#__codelineno-13-27 id=__codelineno-13-27 name=__codelineno-13-27></a><span class=w>        </span>4A<span class=w> </span>3E<span class=w> </span>F4<span class=w> </span><span class=m>76</span><span class=w> </span><span class=m>02</span><span class=w> </span>6E<span class=w> </span><span class=m>64</span><span class=w> </span>C0<span class=w> </span><span class=m>16</span><span class=w> </span>0B<span class=w> </span><span class=m>14</span><span class=w> </span>A7<span class=w> </span><span class=m>93</span><span class=w> </span><span class=m>90</span><span class=w> </span><span class=m>58</span><span class=w> </span><span class=m>99</span>
</span><span id=__span-13-28><a href=#__codelineno-13-28 id=__codelineno-13-28 name=__codelineno-13-28></a>
</span><span id=__span-13-29><a href=#__codelineno-13-29 id=__codelineno-13-29 name=__codelineno-13-29></a>-<span class=w> </span>TLS<span class=w> </span>Certificate<span class=w> </span>Details:
</span><span id=__span-13-30><a href=#__codelineno-13-30 id=__codelineno-13-30 name=__codelineno-13-30></a><span class=w>    </span>Subject<span class=w> </span>&lt;AWS<span class=w> </span>IoT<span class=w> </span>Certificate&gt;
</span><span id=__span-13-31><a href=#__codelineno-13-31 id=__codelineno-13-31 name=__codelineno-13-31></a><span class=w>    </span>Issuer<span class=w>  </span>&lt;<span class=w> </span>&gt;
</span><span id=__span-13-32><a href=#__codelineno-13-32 id=__codelineno-13-32 name=__codelineno-13-32></a><span class=w>    </span>&lt;<span class=m>2023</span>-03-23<span class=w> </span><span class=m>12</span>:47:18&gt;<span class=w> </span>to<span class=w> </span>&lt;<span class=m>2049</span>-12-31<span class=w> </span><span class=m>23</span>:59:59&gt;
</span><span id=__span-13-33><a href=#__codelineno-13-33 id=__codelineno-13-33 name=__codelineno-13-33></a>
</span><span id=__span-13-34><a href=#__codelineno-13-34 id=__codelineno-13-34 name=__codelineno-13-34></a>Dumping<span class=w> </span>Root<span class=w> </span>Cert<span class=w> </span>Store<span class=w> </span>contents...
</span><span id=__span-13-35><a href=#__codelineno-13-35 id=__codelineno-13-35 name=__codelineno-13-35></a>Root<span class=w> </span>Certificate<span class=w> </span>Store<span class=w> </span>Loaded<span class=w> </span>Successfully<span class=w> </span>From:<span class=w> </span>Flash
</span><span id=__span-13-36><a href=#__codelineno-13-36 id=__codelineno-13-36 name=__codelineno-13-36></a>Found<span class=w> </span><span class=m>1</span><span class=w> </span>entries:
</span><span id=__span-13-37><a href=#__codelineno-13-37 id=__codelineno-13-37 name=__codelineno-13-37></a><span class=m>1</span><span class=o>)</span><span class=w> </span>RSA<span class=w> </span>Certificate:<span class=w> </span><span class=m>5</span>/26/2015<span class=w> </span><span class=o>[</span><span class=m>00</span>:00:00<span class=o>]</span><span class=w> </span>to<span class=w> </span><span class=m>1</span>/17/2038<span class=w> </span><span class=o>[</span><span class=m>00</span>:00:00<span class=o>]</span>
</span><span id=__span-13-38><a href=#__codelineno-13-38 id=__codelineno-13-38 name=__codelineno-13-38></a><span class=w>   </span>Name<span class=w> </span>Hash<span class=w> </span><span class=o>(</span>SHA1<span class=o>)</span>:<span class=w> </span>A8<span class=w> </span><span class=m>66</span><span class=w> </span><span class=m>80</span><span class=w> </span>C4<span class=w> </span><span class=m>56</span><span class=w> </span><span class=m>27</span><span class=w> </span>2E<span class=w> </span>AF<span class=w> </span>E3<span class=w> </span>A7<span class=w> </span>CE<span class=w> </span>2E<span class=w> </span><span class=m>49</span><span class=w> </span>D1<span class=w> </span><span class=m>31</span><span class=w> </span>DC<span class=w> </span><span class=m>65</span><span class=w> </span>BB<span class=w> </span>B1<span class=w> </span>ED
</span></code></pre></div> <hr> <h4 id=upload-sketch_1>Upload Sketch<a class=headerlink href=#upload-sketch_1 title="Permanent link">¶</a></h4> <p>The <code>Arduino Cloud Provider Examples</code> Library includes the <code>AWS_IoT_WiFi</code> sketch, which can be used to connect to the AWS IoT Gateway.</p> <p>Install it by opening the Library Manager and search for "Arduino Cloud":</p> <p>Now, open the <code>AWS_IoT_WiFi</code> sketch:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230321175304.png><img alt="Pasted image 20230321175304.png" src=../../../assets/images/pasted-image-20230321175304.png width=600></a></p> <p>Alternatively, use the PlatformIO code here: <a href=https://github.com/peddamat/AWS_IoT_WiFi>peddamat/AWS_IoT_WiFi</a></p> <p>Compiling and uploading the sketch results in:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230324223401.png><img alt="Pasted image 20230324223401.png" src=../../../assets/images/pasted-image-20230324223401.png width=500></a></p> <p>Voila!</p> <p>You should see this in the "MQTT test client" console:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../../assets/images/pasted-image-20230324223523.png><img alt="Pasted image 20230324223523.png" src=../../../assets/images/pasted-image-20230324223523.png width=400></a></p> <hr> <h2 id=next-steps>Next Steps<a class=headerlink href=#next-steps title="Permanent link">¶</a></h2> <p>Ok, as usual, things have gone way longer than expected, so we'll leave the grand finale to the next part, here: <a href=../hands-on-iot-mitm-part-2/index.html>Hands On IoT MitM (Part 2)</a>.</p> <hr> <h2 id=troubleshooting_2>Troubleshooting<a class=headerlink href=#troubleshooting_2 title="Permanent link">¶</a></h2> <details class=info> <summary>Having issues connecting to IOXY from MQTT Explorer?</summary> <p>You can check to see if your firewall is blocking connections between your machine and your WSL container by launching a Python web server on each port, and checking accessibility via a web browser.</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-14-1><a href=#__codelineno-14-1 id=__codelineno-14-1 name=__codelineno-14-1></a><span class=o>[</span>I<span class=o>]</span><span class=w> </span>❯<span class=w> </span>python3<span class=w> </span>-m<span class=w> </span>http.server
</span><span id=__span-14-2><a href=#__codelineno-14-2 id=__codelineno-14-2 name=__codelineno-14-2></a>Serving<span class=w> </span>HTTP<span class=w> </span>on<span class=w> </span><span class=m>0</span>.0.0.0<span class=w> </span>port<span class=w> </span><span class=m>8000</span><span class=w> </span><span class=o>(</span>http://0.0.0.0:8000/<span class=o>)</span><span class=w> </span>...
</span><span id=__span-14-3><a href=#__codelineno-14-3 id=__codelineno-14-3 name=__codelineno-14-3></a><span class=m>127</span>.0.0.1<span class=w> </span>-<span class=w> </span>-<span class=w> </span><span class=o>[</span><span class=m>23</span>/Mar/2023<span class=w> </span><span class=m>16</span>:23:33<span class=o>]</span><span class=w> </span><span class=s2>"GET / HTTP/1.1"</span><span class=w> </span><span class=m>200</span><span class=w> </span>-
</span><span id=__span-14-4><a href=#__codelineno-14-4 id=__codelineno-14-4 name=__codelineno-14-4></a><span class=m>127</span>.0.0.1<span class=w> </span>-<span class=w> </span>-<span class=w> </span><span class=o>[</span><span class=m>23</span>/Mar/2023<span class=w> </span><span class=m>16</span>:23:33<span class=o>]</span><span class=w> </span>code<span class=w> </span><span class=m>404</span>,<span class=w> </span>message<span class=w> </span>File<span class=w> </span>not<span class=w> </span>found
</span><span id=__span-14-5><a href=#__codelineno-14-5 id=__codelineno-14-5 name=__codelineno-14-5></a><span class=m>127</span>.0.0.1<span class=w> </span>-<span class=w> </span>-<span class=w> </span><span class=o>[</span><span class=m>23</span>/Mar/2023<span class=w> </span><span class=m>16</span>:23:33<span class=o>]</span><span class=w> </span><span class=s2>"GET /favicon.ico HTTP/1.1"</span><span class=w> </span><span class=m>404</span><span class=w> </span>-
</span></code></pre></div> <div class="language-bash highlight"><pre><span></span><code><span id=__span-15-1><a href=#__codelineno-15-1 id=__codelineno-15-1 name=__codelineno-15-1></a><span class=o>[</span>I<span class=o>]</span><span class=w> </span>❯<span class=w> </span>python3<span class=w> </span>-m<span class=w> </span>http.server<span class=w> </span><span class=m>8883</span>
</span><span id=__span-15-2><a href=#__codelineno-15-2 id=__codelineno-15-2 name=__codelineno-15-2></a>Serving<span class=w> </span>HTTP<span class=w> </span>on<span class=w> </span><span class=m>0</span>.0.0.0<span class=w> </span>port<span class=w> </span><span class=m>8883</span><span class=w> </span><span class=o>(</span>http://0.0.0.0:8883/<span class=o>)</span><span class=w> </span>...
</span></code></pre></div> </details> <details class=info> <summary>Having issues with the atwinc1500_fwtool update command?</summary> <p>You can debug the atwinc1500_fwtool.exe binary by opening the solution in Visual Studio 2022 and:</p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../.trash/Pasted%20image%2020230323020936.png><img alt="Pasted image 20230323020936.png" src=../../.trash/Pasted%20image%2020230323020936.png width=300></a></p> <p><a class=glightbox data-desc-position=bottom data-height=auto data-type=image data-width=100% href=../../.trash/Pasted%20image%2020230323020835.png><img alt="Pasted image 20230323020835.png" src=../../.trash/Pasted%20image%2020230323020835.png width=700></a></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-16-1><a href=#__codelineno-16-1 id=__codelineno-16-1 name=__codelineno-16-1></a>update --key=..\aws-iot-certs\adafeathermqtt.private.key -p12 --cert=..\aws-iot-certs\adafeathermqtt.cert.pem --ca_dir=..\aws-iot-certs\RootCA
</span></code></pre></div> </details> <hr> <h2 id=links>Links<a class=headerlink href=#links title="Permanent link">¶</a></h2> <ul> <li><a href=https://docs.aws.amazon.com/iot/latest/developerguide/sdk-tutorials.html>Connecting a device to AWS IoT Core by using the AWS IoT Device SDK</a></li> <li><a href=https://learn.adafruit.com/aws-iot-and-adafruit-wiced-feather/setup>AWS IoT and Adafruit WICED Feather</a></li> <li><a href=https://aws.amazon.com/blogs/compute/building-an-aws-iot-core-device-using-aws-serverless-and-an-esp32/ >Building an AWS IoT Core device using AWS Serverless and an ESP32</a></li> <li><a href=https://docs.arduino.cc/tutorials/mkr-wifi-1010/securely-connecting-an-arduino-mkr-wifi-1010-to-aws-iot-core>Securely Connecting an Arduino MKR WiFi 1010 to AWS IoT Core</a></li> <li><a href=https://github.com/MicrochipTech/aws-iot-winc1500-secure-wifi-board-included-source-files%7B%7D>MicrochipTech/aws-iot-winc1500-secure-wifi-board-included-source-files</a></li> <li><a href=https://github.com/peddamat/winc>https://github.com/peddamat/winc</a> <br></li> </ul> <div class=blogging-tags-grid> <a class=blogging-tag href=https://samrambles.com/tags#microchip><code>#microchip</code></a> <a class=blogging-tag href=https://samrambles.com/tags#firmware><code>#firmware</code></a> <a class=blogging-tag href=https://samrambles.com/tags#analysis><code>#analysis</code></a> <a class=blogging-tag href=https://samrambles.com/tags#iot><code>#iot</code></a> <a class=blogging-tag href=https://samrambles.com/tags#mitm><code>#mitm</code></a> </div> <style>
    .md-typeset .blogging-tags-grid {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 5px;
    }

    .md-typeset .blogging-tag {
        color: var(--md-typeset-color);
        background-color: var(--md-typeset-code-color);
    }

    .md-typeset .blogging-tag code {
        border-radius: 5px;
    }
</style></div> <hr> <div class=md-source-file> <small> Last update: 2023-03-28 </small> </div> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> </div> <a class="md-top md-icon" data-md-component=top hidden href=#> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg> Back to top </a> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Made with ❤️ by Sam. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ rel=noopener target=_blank> Material for MkDocs </a> </div> <div class=md-social> <a class=md-social__link href=https://github.com/peddamat rel=noopener target=_blank title=github.com> <svg viewbox="0 0 480 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"></path></svg> </a> <a class=md-social__link href=https://twitter.com/peddamat rel=noopener target=_blank title=twitter.com> <svg viewbox="0 0 512 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg> </a> <a class=md-social__link href=https://www.instagram.com/speddamat rel=noopener target=_blank title=www.instagram.com> <svg viewbox="0 0 448 512" xmlns=http://www.w3.org/2000/svg><!-- Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"></path></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["header.autohide", "search.share", "search.highlight", "search.suggest", "content.code.copy", "content.code.select", "content.code.annotate", "content.tabs.link", "navigation.tracking", "navigation.top", "navigation.sections", "navigation.tabs", "navigation.indexes"], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.2a6f1dda.min.js></script> <script src=../../../assests/scripts/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": false, "openEffect": "none", "closeEffect": "none", "slideEffect": "none"});})</script></body> </html>